<?xml version="1.0" ?>
<!--
////////////////////////////////////////////////////////////////////////////////
//
// Copyright (c) 2010 ESRI
//
// All rights reserved under the copyright laws of the United States.
// You may freely redistribute and use this software, with or
// without modification, provided you include the original copyright
// and use restrictions.  See use restrictions in the file:
// <install location>/License.txt
//
// operationallayers: Note: Displays in reverse order. The top level layers or groups will display in a separate
        dialog widget. When you click on one of these it will open a new dialog widget.
        feature service or map service with groups and layers 
            tag: layer
            attributes:
                label: service display name
                opensublayer: comma delimited list of group layer names under this service to expand at the start.
                visible: true or false
                alpha: opacity 0.8. Must be set or data will be invisible. Set to 1 to allow service defaults to show.
                url: MapServer or FeatureServer URL
                transparency_control: Should a transparency control slider be added next to Visibility? Values: "true" or "false". Defaults to false.
                filter=SQL where filter. For example: "type &lt;&gt; 'Road'". For not equal <> use &lt;&gt;
                symbol_icon=Picture marker symbol image file for point layer. Can be png or svg (but needs height and width).
                    For example: "./assets/images/file.png".  SVG file must include a definition for width and height to load properly in Firefox.
                symbol_icon_size=Picture marker symbol size. For example: "15px" Default size is 20px if not specified.
                minScale="144448" layer turns on below this scale. 1:100k="144448" 1:50k="72224"
                maxScale="144448" layer turns off above this scale
                listMode="show" or "hide" default is "show". Should this service be included in the layer list?
                legendEnabled="true" or "false" default is "true". Should this service be include in the legend?

        group layer
            tag: layer
            attributes:
                group: group name
                open: true or false, is this group open? Top level groups should not use open. If radio is true, this is ignored.
                opensublayer: comma delimited list of group layer names under this service to expand at the start.
                visible: true or false
                alpha: opacity 0.8
                radio: true or false, uses a drop down list for children (only one set is visible at a time). 
                    For exmple: Game Species drop down with Elk, Bighorn, etc in the drop down. The selected species displays
                    it's children at the top level in the layer list.
                transparency_control: Should a transparency control slider be added next to Visibility? Values: "true" or "false". Defaults to false.
        

        sub layer in parent group
            tag: layer
            attributes:
                label: service display name
                parentGroup: group name
                NOTE: if the parentGroup is the same as the label, it will not put it in a group, but will
                    put the layers at the top level. The parentGroup will be in the first dialog widget.
                visible: true or false
                opensublayer: comma delimited list of group layer names under this service to expand at the start.
                alpha: opacity 0.8 (optional)
                url=a FeatureService 
                minScale="144448" layer turns on below this scale. 1:100k="144448" 1:50k="72224"
                maxScale="144448" layer turns off above this scale
                filter=SQL where filter. For example: "type &lt;&gt; 'Road'". For not equal <> use &lt;&gt;
                symbol_icon=Picture marker symbol image file for point layer. Can be png or svg (but needs height and width). 
                    For example: "./assets/images/file.png". SVG file must include a definition for width and height to load properly in Firefox.
                symbol_icon_size=Picture marker symbol size. For example: "15px" Default size is 20px if not specified.
                listMode=Should this service be included in the layer list?
                legendEnabled="true" or "false" default is "true". Should this service be include in the legend?
        
        sub group under the parent group with or without layers under it.
            tag: layer
            attributes:
                group=label
                parentGroup=parent group name
                open=true or false, is this group open?
                opensublayer: comma delimited list of group layer names under this service to expand at the start.
                alpha=opacity for the group
                visible=true or false, is this group visible?
                url=a FeatureService to add layers to this group. If this is missing, it will just add the group and the rest of the attributes are ignored.
                layerIds=FeatureService ids in display order, and can use 3-6,9,11 format.
                minScale=can be 1 value for all layer ids, or comma delimited min scales for each layerIDs.
                maxScale=can be 1 value for all layer ids, or comma delimited min scales for each layerIDs.
                filter=SQL where filter. Comma delimited, one for each layerIDs above. For example: ",type &lt;&gt; 'Road'". For not equal <> use &lt;&gt;
                symbol_icon=Picture marker symbol image file for point layer. Can be png or svg (but needs height and width).
                    Comma delimited, one for each layerIDs above. For example: "./assets/images/file.png,".  SVG file must include a definition for width and height to load properly in Firefox.
                symbol_icon_size=Picture marker symbol size. Comma delimited one for each layerIDs above. For example: "20px,15px" Default size is 20px if not specified.
                layerVis=visibility of each layer in display order.
                layerNames=optional display name. If missing, it will use names from FeatureService. Format="layer1 name,layer2 name,..." in display order.
                listMode=Should this service be included in the layer list?
                legendEnabled="true" or "false" default is "true". Should this service be include in the legend?

    hideGroupSublayers: do not show sublayers in a group. If a mapservice url has the id with it, you will need to add it to this tag.
////////////////////////////////////////////////////////////////////////////////
-->
<configuration xmlns:xsi="https://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../xsd/config.xsd">
    <title>Colorado Fishing Atlas</title>
    <app>fishingatlas</app>
    <!-- logo in header bar-->
    <logo>./assets/images/logo.svg</logo>
	<httpproxy>/proxy/DotNet/proxy.ashx</httpproxy>

    <style>
		<font name="Helvetica" size="11"/>    	
    </style>
    
    <!-- REST endpoint to a GeometryService. This should be a service published by CPW and not pointing at an ESRI service.  Use to convert points to new projections. -->
    <geometryservice url="https://ndismaps.nrel.colostate.edu/arcgis/rest/services/Utilities/Geometry/GeometryServer"/>
    
    <!-- FishingAtas Letter Landscape, etc geopdf files do not exist on ndis-flex-2. Old note: Mobile download printservicegeo needs to be from same domain or it will not be able to rename the file with a download. This did not work on the Android app so this is no longer the case. -->
	<printservicegeo>https://ndismaps.nrel.colostate.edu/arcgis/rest/services/PrintTemplate/georefPrinting/GPServer/georefPrinting</printservicegeo>
    <printservice>https://ndismaps.nrel.colostate.edu/arcgis/rest/services/PrintTemplate/ExportWebMap/GPServer/Export%20Web%20Map</printservice>
	
	<!-- Colorado Places Service GNIS -->
	<findplaceservice url="https://ndismaps.nrel.colostate.edu/ArcGIS/rest/services/GNIS_Loc/GeocodeServer"/>
	
	<!-- Address Service -->
	<!--addressservice url="https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer/findAddressCandidates"/-->
    <!-- 6/17/25 now using hard code address service in mySearch.js
    "https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer/"-->
	
    <!-- Key to allow Bing Map background layers to work.  Do not change. NOT USED-->
	<!--bing key="Ak1eor2ZBWpGcsTkRL8PjLwDpPda-_tK9v-PS-5IbeiOpKm0Eq6n4Xdf26hFbAN6"/-->

    <!-- wkid is required.  This is the spatial reference number.-->
    <map wkid="102100"
    	 initialextent="-12350000 4250000 -11150000 5250000">
         <!-- Set open=true if you want this group layer expanded at the start. -->
         <!-- Set opensublayer=comma delimited list of layer names under the mapservice checkbox to expand at the start. open must be true. -->
         <!--     example: open="true" opensublayer="Places of Interest,Township Range Sections" --> 
        <!-- operationallayers:  Note: Displays in reverse order. -->
        <operationallayers>
            <!-- Note: if parentGroup is the same as the label it will put the layers at the top level instead of in an expandable block -->
            <!--Land and Access   <layer ... opensublayer="CPW Public Access Properties" -->
            <layer label="Land and Access" visible="true" transparency_control="true" alpha="1"
                    url="https://ndismaps.nrel.colostate.edu/arcgis/rest/services/FishingAtlas2025/LandAccess2025/MapServer"/>
            <layer group="Transportation" visible="false" alpha="1" radio="false"/>
                <layer  parentGroup="Transportation" label="Motor Vehicle Use Map" visible="true" alpha="1"  minScale="144448"
					url="https://apps.fs.usda.gov/arcx/rest/services/EDW/EDW_MVUM_02/MapServer/1"/>
                <layer  parentGroup="Transportation" label="BLM Colorado Routes" visible="true" alpha="1" minScale="144448"
                    url="https://gis.blm.gov/coarcgis/rest/services/transportation/BLM_CO_GTLF/FeatureServer/5" />
                <layer parentGroup="Transportation" label="Colorado State Parks Roads" visible="false" minScale="144448"
                    url="https://services5.arcgis.com/ttNGmDvKQA7oeDQ3/arcgis/rest/services/CPWAdminData/FeatureServer/1" />
                <!-- use &lt;&gt; for not equal in SQL Expression filter for <> -->
                <!--For picture marker symbols for point layers use: 
                    symbol_icon="./assets/images/file.svg,./assets/images/file.png"
                    symbol_icon_size="20px,15px" Default size is 20px if not specified-->
                <layer parentGroup="Transportation" group="Trails" visible="true" open="false"
                    url="https://services5.arcgis.com/ttNGmDvKQA7oeDQ3/arcgis/rest/services/CPWAdminData/FeatureServer/"
                    layerIds="14,15"
                    layerVis="true,true"
                    filter=",type &lt;&gt; 'Road'"
                    layerNames="Trailheads,Trails"
                    minScale="36112,144448"/>
            <layer group="Fishing Info" visible="true"/>
                <layer parentGroup="Fishing Info" label="Watercraft Inspection Stations" visible="true" alpha="1" minScale="144448"
                    symbol_icon="./assets/images/ANSBoat_sm.svg"
                    url="https://services5.arcgis.com/ttNGmDvKQA7oeDQ3/ArcGIS/rest/services/PublicWID/FeatureServer/0"/>
			    <layer parentGroup="Fishing Info" label="Stream Guage" visible="true" alpha="1"
                    symbol_icon="./assets/images/stream_gauge_sm.svg"
                    symbol_icon_size="15px" minScale="144448" filter="governing_location = 'CO, USA'"
                    url="https://services9.arcgis.com/RHVPKKiFTONKtxq3/ArcGIS/rest/services/Live_Stream_Gauges_v1/FeatureServer/0"/>
                <layer parentGroup="Fishing Info" label="Fishing Info" visible="true" alpha="0.9"
            		url="https://ndismaps.nrel.colostate.edu/arcgis/rest/services/FishingAtlas2025/FishingInfo2025/MapServer"/>
            <!--layer group="Wildfire" label="Wildfire" visible="false" alpha="0.8"/>
			    <layer parentGroup="Wildfire" label="Wildfire Perimeters"visible="true" alpha="0.8" url="https://services9.arcgis.com/RHVPKKiFTONKtxq3/ArcGIS/rest/services/USA_Wildfires_v1/FeatureServer/1"/>
			    <layer parentGroup="Wildfire" label="Wildfire Incidents" visible="true" alpha="0.8" url="https://services9.arcgis.com/RHVPKKiFTONKtxq3/ArcGIS/rest/services/USA_Wildfires_v1/FeatureServer/0"/-->
            <layer label="Base Data" visible="true" alpha="1.0" listMode="hide"
                url="https://ndismaps.nrel.colostate.edu/arcgis/rest/services/FishingAtlas2025/BaseData2025/MapServer"/>
       </operationallayers>
		
		<hideGroupSublayers>Motor Vehicle Use Map,Township Range Sections,Gold Medal Water,Trails,Fishing License Agent,Family friendly,More remote fly fishing,Ice fishing,Special Fishing Regulations,Fishing Information Point,Stocked with catchables (~10 inches),Emergency,Field Office,Chamber of Commerce or Welcome Center,Campgrounds and SWA Facilities</hideGroupSublayers>
    </map>

    <links>
        <iconsize>30px</iconsize>
        <!--helplink label="Use case #1"
            text="Video showing how to..."
            url = "https://"
            icon="./assets/images/star.png"/-->
        <!--helplink label="Getting Started"
            text="A video highlighting the features of our map atlas"
            url="https://"
            icon="./assets/images/compass3.png"/-->
        <link label="CPW Website"
            url="https://cpw.state.co.us"
            icon="./assets/images/logo.svg"/>
        <link label="HuntingAtlas"
            url="./index.html?app=HuntingAtlas"
            icon="./assets/images/logo.svg"
            extent="true"/>
		<link label="Buy License!"
    		url="https://cpw.state.co.us/BuyApply/pages/fishing.aspx"
    		icon="assets/images/i_buylicense.png"/>
		<link label="Fishing Brochure"
    		url="http://case.epaperflip.com/Colorado/fishing"
    		icon="assets/images/i_documentadd.png"/>
		<link label="Stocking Report"
    		url="https://cpw.state.co.us/thingstodo/Pages/StockingReport.aspx"
    		icon="assets/images/i_documentadd2.png"/>
        <link label="Send us Your Feedback" text="Please send your questions, comments, or problems with the Colorado FishingAtlas to ndisadmin@nrel.colostate.edu."
            url="mailto:ndisadmin@nrel.colostate.edu"
            icon="./assets/images/i_mail.png"/>
    </links>
    <extra_widgets>
        <widget name="filter" title="Fishing Opportunities" icon="OppAll_Icon.svg">
            <!--buttons in filter dropdown. Filters a layer in the map.
            title = label for button
            icon = picture in front of title
            layer-title = name of the operational layer
            layer-id = the operational layer id, it can be a comma delimited list if it has different zoom levels
            active = true or false if the button is active. Only one button can be active!
            where = SQL expression to run on the operational layer when selected from dropdown list
            Next attributes are optional. A dropdown without a database call
                dropdown = true, should this button have a drop down list
                list = comma delimited list of dropdown display labels
                where = comma delimited list of SQL expressions
                    For example:
                        <button title="Boating"
                            icon="OppFishSpx_Icon.svg"
                            layer-title="Fishing Info"
                            layer-id="3,5,7"
                            active="false"
                            dropdown="true"
                            list=",Non-motorized,Motor boats,Electric,Belly boats"
                            where=",BOATING='Non-motorized',BOATING='Motor boats',BOATING='Electric',BOATING='Belly boats'"/>
            Next attributes are optional. A dropdown with a database call
                dropdown = "true"  Should this button have a drop down list?
                lookupsearchvalues = The name of an aspx file containing SQL to generate a list to use to fill the drop down list.
			    lookupfilename = Used if lookupsearchvalues are used.  The name of the database table used in the above SQL.
			    lookupfield = Used if lookupsearchvalues are used.  The name of the field in the above database table containing the values for the drop down list.
                    For example:
            			lookupsearchvalues="SearchGetDropDownListDB.aspx"
			            lookupfilename="LUT_AtlasFishList"
			            lookupfield="AtlasFish"
                 **** Next tags are used to lookup the user selected value from the dropdown, in a database.  Build a where
        		expression from the returned matches based on a field (database_field) that is common to the mapservice and database file.
                The where expression is used to filter data when selected. It is stored in the value of the HTML select option.
                **** all must be filled in *****
			    database=The name of a .net file to call a database to lookup the user selected value from the "Search For:" text box.
               		Edit this file and modify database filename, SQL, and table name. 
			    where=SQL  expression to run on the operational layer when selected from dropdown list. [value] gets replaced with dropdown selection
                filename=The name of the table used in the above database call.
		        database_field=The field that links the database to the mapservice.  Used to build the expression to query mapservice from url tag above.
            		Will build a where expression like:  WATERCODE='13209' OR WATERCODE='14681' ...
		        database_field_type=string or number, type of the above field in the mapservice from url tag above. Used to add or not add quotes in the where expression.
                    For example:
                        database="./fishingatlas/SearchFishingSpeciesTextDB.aspx"
                        where="UPPER(FA_NAME2) LIKE UPPER('%[value]%')"
                        filename="tblMasterSpecies"
                        database_field="WATERCODE"
                        database_field_type="string"

            Was occasionally getting an error in Chrome, net::ERR_HTTP2_PROTOCOL_ERROR. For posible fixes see https://stackoverflow.com/questions/58215104/whats-the-neterr-http2-protocol-error-about
            -->
            <button title="All fishing opportunities"
                icon="OppAll_Icon.svg"
                layer-title="Fishing Info"
                layer-id="3,5,7"
                active="true"
                where=""/>
            <button title="Family friendly opportunities"
                icon="OppFamily_Icon.svg"
                layer-title="Fishing Info"
                layer-id="3,5,7"
                active="false"
                where="OPP_FAMILY = 'Yes'"/>
            <button title="More remote fly fishing opportunities"
                icon="OppFly_Icon.svg"
                layer-title="Fishing Info"
                layer-id="3,5,7"
                active="false"
                where="OPP_RUSTIC = 'Yes'"/>
            <button title="Ice fishing opportunities"
                icon="Opplce_Icon.svg"
                layer-title="Fishing Info"
                layer-id="3,5,7"
                active="false"
                where="OPP_ICE = 'Yes'"/>
            <button title="Stocked with 10 inch catchables"
                icon="OppStocked_Icon.svg"
                layer-title="Fishing Info"
                layer-id="3,5,7"
                active="false"
                where="STOCKED like '%Catchable%'"/>
            <!-- Example drop down without a database call -->
            <!--button title="Boating"
                icon="OppFishSpx_Icon.svg"
                layer-title="Fishing Info"
                layer-id="3,5,7"
                active="false"
                dropdown="true"
                list=",Non-motorized,Motor boats,Electric,Belly boats"
                where=",BOATING='Non-motorized',BOATING='Motor boats',BOATING='Electric',BOATING='Belly boats'"/-->
            <button title="Fish species"
                icon="OppFishSpx_Icon.svg"
                layer-id="3,5,7"
                layer-title="Fishing Info"
                active="false"
                dropdown="true"
			    where="UPPER(FA_NAME2) LIKE UPPER('%[value]%')"
                lookupsearchvalues="SearchGetDropDownListDB.aspx"
			    lookupfilename="LUT_AtlasFishList"
			    lookupfield="AtlasFish"
			    database="./fishingatlas/SearchFishingSpeciesTextDB.aspx"
			    filename="tblMasterSpecies"
		        database_field="WATERCODE"
		        database_field_type="string"/>
        </widget>
    </extra_widgets> 
</configuration>