function printInit(){var e=createXMLhttpRequest(),t=app+"/PrintPdfWidget.xml?v="+ndisVer;e.onreadystatechange=function(){if(4===e.readyState&&200===e.status){var t=createXMLdoc(e);t.getElementsByTagName("disclaimer")[0]?prtDisclaimer=t.getElementsByTagName("disclaimer")[0].firstChild.nodeValue:alert("Missing tag, disclaimer, in "+app+"/PrintPdfWidget.xml file.","Data Error"),t.getElementsByTagName("helpvideo")[0]&&(document.getElementById("printVideo").innerHTML="<a target='help' href="+t.getElementsByTagName("helpvideo")[0].firstChild.nodeValue+">Click here to view help video.</a><br/><br/>")}else 404===e.status?(alert("Error: Missing PrintPdfWidget.aspx file in "+app+" directory.","Data Error"),hideLoading()):4===e.readyState&&500===e.status&&(alert("Missing PrintPdfWidget.aspx file. app="+app,"Data Error"),hideLoading())},e.open("GET",t,!0),e.send()}function grayOutLegend(e){require(["dojo/dom"],function(t){document.getElementById("printMapLink").innerHTML="",document.getElementById("printLegendLink").innerHTML="","geopdf"!=e.value&&"pdf"!=e.value&&t.byId("printLegend")?t.byId("printLegendCB").style.display="none":t.byId("printLegendCB").style.display="inline-block"})}function printMap(){require(["esri/rest/print","esri/rest/support/PrintTemplate","esri/rest/support/PrintParameters","esri/Graphic","esri/geometry/Point","esri/rest/support/LegendLayer","esri/layers/GraphicsLayer","esri/renderers/visualVariables/support/visualVariableUtils","esri/arcade","dojo/dom","dijit/registry"],function(e,t,n,i,r,a,l,s,d,o,p){function u(e){var t,n,i=o.byId("format"),r=Date.now()-startTim,a=view.scale;a<9028?n="10k":a<36112?n="24k":a<72224?n="50k":a<144448?n="100k":a<288896?n="250k":a<577791?n="500k":a<1155582?n="1M":a<2311163?n="2M":a<4622325?n="4M":a<9244649&&(n="9M");var l=i.options[i.selectedIndex].value,s=o.byId("size").options[o.byId("size").selectedIndex].innerHTML+" "+l+" ";b&&document.getElementById("printLegend").checked&&(s+="legend ");var d=o.byId("size").options[o.byId("size").selectedIndex].innerHTML,u=Math.floor(r/1e3),m="";for(t=0;t<map.layers.items.length;t++)switch(map.layers.items[t].id){case"Motor Vehicle Use Map":m+="M";break;case"Hunter Reference":m+="R";break;case"Game Species":m+="G";break;case"Fishing Info":m+="F";break;case"Reference":m+="R"}if(s+=m,console.log("Time to create map = "+u+" seconds for "+s+" "+n),"function"==typeof gtag&&gtag("event","print",{seconds:u,page_size:d,map_services:m,map_scale:n,map_type:l,basemap:mapBasemap}),console.log("printing to "+e.url),e.url.indexOf("tif")>-1||e.url.indexOf("svgz")>-1)document.getElementById("printMapLink").innerHTML="<a href='"+e.url+"' title='exported map file' target='_blank'> map."+G.format.toLowerCase()+"</a>";else{try{window.open(e.url,"_blank")}catch(e){console.log("Can't open printout in new window. Use link provided.")}document.getElementById("printMapLink").innerHTML="<a href='"+e.url+"' title='exported map file' target='_blank'><span class='esri-icon-launch-link-external'></span> map."+G.format.toLowerCase()+"</a>"}for(t=0;t<I;t++)removeDrawItem();f&&(p.byId("print_button").set("label","Print"),document.getElementById("printLoading").style.display="none"),f=!0}function m(e){p.byId("print_button").set("label","Print"),document.getElementById("printLoading").style.display="none",alert("Error printing with basemap, "+mapBasemap+". Error Code: "+e,"Code Error",e),document.getElementById("printMapLink").innerHTML="",document.getElementById("printLegendLink").innerHTML="";for(var t=0;t<I;t++)removeDrawItem()}function y(e){console.log("printing legend to "+e.url);try{window.open(e.url,"_blank")}catch(e){console.log("Can't open printout in new window. Use link provided.")}f&&(p.byId("print_button").set("label","Print"),document.getElementById("printLoading").style.display="none"),document.getElementById("printLegendLink").innerHTML="<a href='"+e.url+"' target='_blank'><span class='esri-icon-launch-link-external'></span> legend."+G.format.toLowerCase()+"</a>",f=!0}function c(e){p.byId("print_button").set("label","Print"),document.getElementById("printLoading").style.display="none",document.getElementById("printLegendLink").innerHTML="",document.getElementById("printMapLink").innerHTML="",e.details?alert("Error printing the legend: "+e+e.details,"Code Error"):alert("Error printing the legend","Code Error")}var g,I=0,f=!1,b="inline-block"==o.byId("printLegendCB").style.display;b||(f=!0),p.byId("print_button").set("label","Creating..."),document.getElementById("printLoading").style.display="inline-block",document.getElementById("printMapLink").innerHTML="<span class='esri-icon-loading-indicator esri-rotating'></span> map.pdf",document.getElementById("printLegendLink").innerHTML="",document.getElementById("printDiv").scrollIntoView({behavior:"smooth",block:"end"});var L,h,v,E,w,k=map.layers.items,x=[],T=0;for(g=0;g<k.length;g++)if(k[g].visible&&"topo"!=k[g].id&&"streets"!=k[g].id&&"hybrid"!=k[g].id){if(k[g].id.indexOf("drawgraphics")>0){if(k[g].graphics.length>1&&"point"==k[g].graphics[0].geometry.type&&!k[g].graphics[0].symbol.text){I++;var B=new r(k[g].graphics[0].geometry.x,k[g].graphics[0].geometry.y,map.spatialReference),M=new i(B),P=new l;P.id="drawgraphics"+drawGraphicsCounter,drawGraphicsCount.push(P.id),drawGraphicsCounter++,addLabel(M,k[g].graphics[1].symbol.text,P,"11pt")}continue}if(k[g].sublayers||k[g].layers){L=new a({title:k[g].title,layerId:k[g].id,subLayerIds:[]}),k[g].layerId&&(L.layerId=k[g].layerId);var C,H,_,D,S=k[g];for(C=void 0!==S.sublayers?S.sublayers.items:S.layers.items,h=0;h<C.length;h++)if(C[h].visible)if(C[h].sublayers||C[h].layers){for(C[h].sublayers?H=C[h].sublayers.items:C[h].layers&&(H=C[h].layers.items),v=0;v<H.length;v++)if(H[v].visible)if(H[v].sublayers||H[v].layers){for(H[v].sublayers?_=H[v].sublayers.items:H[v].layers&&(_=H[v].layers.items),E=0;E<_.length;E++)if(_[E].visible)if(_[E].sublayers||_[E].layers)for(D=_[E].sublayers?_[E].sublayers.items:_[E].layers.items,w=0;w<D.length;w++)D[w].visible&&(D[w].sublayers||D[w].layers?alert("add one more group layer traversal in print.js to handle nested groups."):void 0!==D[w].layerId?(L.title=D[w].title,L.layerId=D[w].layerId,L.subLayerIds.push(D[w].layerId)):L.subLayerIds.push(D[w].id));else void 0!==_[E].layerId?(L=null,x.push(new a({layerId:_[E].id,title:_[E].title}))):L.subLayerIds.push(_[E].id)}else void 0!==H[v].layerId?(L=null,x.push(new a({layerId:H[v].id,title:H[v].title}))):L.subLayerIds.push(H[v].id)}else void 0!==C[h].layerId?(L=null,x.push(new a({layerId:C[h].id,title:C[h].title}))):L.subLayerIds.push(C[h].id);L&&x.push(L),L=null,T++}else L=new a({title:k[g].title,layerId:k[g].id,subLayerIds:[]}),k[g].layerId&&(L.layerId=k[g].layerId),x.push(L),L=null,T++}var O=new n,G=new t,V=o.byId("orient"),z=o.byId("format");index=V.selectedIndex;var U=V.options[index].value,N=o.byId("size");index=N.selectedIndex;var R=N.options[index].value;if(G.exportOptions={dpi:dpi},"pdf"!=z.options[z.selectedIndex].value){var F;if(G.layout=app+" "+R+U,G.preserveScale=!0,f=!0,G.format=z.options[z.selectedIndex].value,"geopdf"!=G.format)F="none",G.exportOptions={dpi:dpi};else if("geopdf"!=G.format||document.getElementById("printLegend").checked)F="Legend Letter "+U,G.format="pdf";else if(F="none",G.format="pdf",0==T)return alert("Printing of basemaps alone does not work. Please add map layers. From the menu, select 'Map Layers & Legend.'","Warning"),p.byId("print_button").set("label","Print"),document.getElementById("printLoading").style.display="none",document.getElementById("printMapLink").innerHTML="",void(document.getElementById("printLegendLink").innerHTML="");O.extraParameters={Georef_Info:"True",Legend_Template:F}}else b&&!document.getElementById("printLegend").checked&&(f=!0),G.preserveScale=!0,G.format=z.options[z.selectedIndex].value.toUpperCase(),R.indexOf("Letter")>-1?G.layout=R+"ANSI A "+U:G.layout=R+"ANSI B "+U;G.showAttribution=!1;var W=document.getElementById("printTitle").value;if("geopdf"==z.options[z.selectedIndex].value&&(W+=" (Geo PDF)"),b&&document.getElementById("printLegend").checked?G.layoutOptions={titleText:W,authorText:prtDisclaimer,legendLayers:x,customTextElements:[{Subtitle:document.getElementById("printSubTitle").value},{Legend:x}]}:G.layoutOptions={titleText:W,authorText:prtDisclaimer,legendLayers:[],customTextElements:[{Subtitle:document.getElementById("printSubTitle").value}]},W=null,O.view=view,O.template=G,e.execute(printServiceUrl,O).then(u).catch(m),startTim=Date.now(),"pdf"==z.options[z.selectedIndex].value&&b&&document.getElementById("printLegend").checked){document.getElementById("printLegendLink").innerHTML="<span class='esri-icon-loading-indicator esri-rotating'></span> legend.pdf";var j=new n,A=new t;A.exportOptions={dpi:dpi},A.layout="Legend Letter "+U,A.format="PDF",A.layoutOptions={titleText:document.getElementById("printTitle").value,authorText:prtDisclaimer,legendLayers:x,customTextElements:[{Subtitle:document.getElementById("printSubTitle").value},{Legend:x}]},j.view=view,j.template=A,e.execute(printServiceUrl,j).then(y).catch(c)}})}var startTim,prtDisclaimer="",dpi=300;