function reportInit(){require(["dojo/dom","dijit/registry","dojo/sniff","dijit/form/Select","esri/toolbars/draw","dojo/i18n!esri/nls/jsapi","esri/layers/GraphicsLayer","esri/geometry/Circle","esri/symbols/SimpleMarkerSymbol","esri/symbols/SimpleLineSymbol","esri/symbols/SimpleFillSymbol","dojo/_base/Color","esri/graphic","dijit/Dialog","esri/map","dijit/form/Button","esri/graphicsUtils","esri/layers/ArcGISDynamicMapServiceLayer","esri/tasks/PrintTask","esri/tasks/PrintTemplate","esri/tasks/PrintParameters","esri/urlUtils","esri/geometry/webMercatorUtils","esri/tasks/query","esri/tasks/QueryTask","dojo/promise/all"],function(e,t,r,a,n,s,i,o,l,d,p,u,g,f,m,c,y,b,h,B,R,v,E,w,M,L){function T(e){return Math.round(e/se*72)}function F(){ne=ae,ie=792-2*ae,oe=612-ne,J=3060,Z=2175,mapWidthPts=T(J),mapHeightPts=T(Z);new f({id:"reportPreviewDialog",style:{width:528*J/Z+14+"px",height:"666px",overflow:"none"},title:"Resource Report Preview",content:"<div data-dojo-type='dijit/layout/ContentPane'><button id='openReportBtn1' data-dojo-type='dijit/form/Button' role='presentation' type='button'>Open Report</button><button id='saveReportBtn1' data-dojo-type='dijit/form/Button' role='presentation' type='button'>Save Report</button><button id='cancelBtn1' data-dojo-type='dijit/form/Button' role='presentation' type='button'>Cancel</button><span id='reportMsg1'></span></div><div id='reportPreview' style='width:100%;height:100%;'></div><div><button id='openReportBtn2' data-dojo-type='dijit/form/Button' role='presentation' type='button'>Open Report</button><button id='saveReportBtn2' data-dojo-type='dijit/form/Button' role='presentation' type='button'>Save Report</button><button id='cancelBtn2' data-dojo-type='dijit/form/Button' role='presentation' type='button'>Cancel</button><span id='reportMsg2'></span></div>"});var s=[{level:6,resolution:2445.98490512499,scale:9244648.868618},{level:7,resolution:1222.992452562495,scale:4622324.434309},{level:8,resolution:611.4962262813797,scale:2311162.217155},{level:9,resolution:305.74811314055756,scale:1155581.108577},{level:10,resolution:152.87405657041106,scale:577790.554289},{level:11,resolution:76.43702828507324,scale:288895.277144},{level:12,resolution:38.21851414253662,scale:144447.638572},{level:13,resolution:19.10925707126831,scale:72223.819286},{level:14,resolution:9.554628535634155,scale:36111.909643},{level:15,resolution:4.77731426794937,scale:18055.954822},{level:16,resolution:2.388657133974685,scale:9027.977411},{level:17,resolution:1.1943285668550503,scale:4513.988705},{level:18,resolution:.5971642835598172,scale:2256.994353},{level:19,resolution:.29858214164761665,scale:1128.497176}];Q=new m("reportPreview",{showAttribution:!1,style:{width:J+"px",height:Z+"px",overflow:"auto"},autoResize:!0,logo:!1,isRubberBandZoom:!0,isScrollWheelZoom:!0,isShiftDoubleClick:!0,displayGraphicsOnPan:!r("ie"),sliderStyle:"large",basemap:H,minScale:9244649,lods:s}),K=new i,K.id="reportPreviewGraphicsLayer1",Q.on("load",function(){try{var e=new b(W,{opacity:1,id:"reportserviceurl",visible:!0});Q.addLayers([e]),Q.addLayer(K)}catch(e){alert("Error loading layers from "+app+"/ResourceReportWidget.xml. "+e.message,"Data Error")}}),Q.on("layers-add-result",function(e){try{for(var t=0;t<e.layers.length;t++)e.layers[t].error&&(!0,alert("Problem loading layer: "+e.layers[t].layer.url+". "+e.layers[t].error.message+" in javascript/resourceReport.js. Check "+app+"/ResourceReportWidget.xml","Data Error"))}catch(e){alert("Resource Report Error in reportMap.on(layers-add-result): "+e.message,"Code Error",e)}});for(var o=[],l=0;l<D.length;l++)o.push({label:D[l],value:parseInt(D[l])});new a({id:"distCombo",value:_,sortByLabel:!1,labelAttr:"label",style:{width:"50px"},onChange:function(){_=this.get("value"),N()},options:o},"reportDistCbo"),document.getElementById("reportDistLabel").innerHTML=" "+j+" buffer radius",o=null,G=new n(map,{showTooltips:!0}),G.on("draw-end",O),document.getElementById("reportLocBtn").addEventListener("click",function(e){S()}),t.byId("reportPrintBtn").on("click",A),t.byId("reportPrintBtn").set("disabled",!0),t.byId("reportCancelBtn").on("click",x),t.byId("reportCancelBtn").set("disabled",!0),t.byId("openReportBtn1").on("click",P("open")),t.byId("saveReportBtn1").on("click",P("save")),t.byId("openReportBtn2").on("click",P("open")),t.byId("saveReportBtn2").on("click",P("save")),t.byId("cancelBtn1").on("click",I),t.byId("cancelBtn2").on("click",I),e.byId("reportDiv").addEventListener("click",function(e){t.byId("reportDiv").open||x()})}function C(e){alert("WARNING: In "+app+"/ResourceReportWidget.xml file, required value missing for the "+e+".","Data Error")}function N(){if(re){pe.clear(),K.clear(),X=new o({center:re,geodesic:!0,radius:t.byId("distCombo").get("value"),radiusUnit:"esriMiles"});var e=new d(d.STYLE_SOLID,new u([0,0,0]),2),r=new p(p.STYLE_SOLID,e,new u([255,255,0,.1])),a=new p(p.STYLE_NULL,e),n=new g(X,r),s=new g(X,a);pe.add(n),K.add(s);var i=new l(l.STYLE_CROSS,20,e,new u([0,0,0,1])),f=new g(re,i);pe.add(f),n=null,e=null,r=null,i=null,f=null,s=null}}function O(e){document.getElementById("reportLocBtn").className="graphBtn",drawing=!1,G.deactivate(),re=e.geometry,N(),t.byId("reportPrintBtn").set("disabled",!1),t.byId("reportCancelBtn").set("disabled",!1)}function x(){document.getElementById("reportLocBtn").className="graphBtn",drawing=!1,G.deactivate(),pe.clear(),K.clear(),t.byId("openReportBtn1").set("disabled",!1),t.byId("saveReportBtn1").set("disabled",!1),t.byId("openReportBtn2").set("disabled",!1),t.byId("saveReportBtn2").set("disabled",!1)}function S(){t.byId("reportPrintBtn").set("disabled",!0),t.byId("reportCancelBtn").set("disabled",!0),"graphBtnSelected"!=document.getElementById("reportLocBtn").className?(pe.clear(),K.clear(),document.getElementById("reportLocBtn").className="graphBtnSelected",drawing=!0,s.toolbars.draw.addPoint="Click on location",G.activate(n.POINT)):x()}function A(){"function"==typeof ga&&ga("send","event","resource_report","click","Resource Report","1"),document.getElementById("reportMsg1").innerHTML=de,document.getElementById("reportMsg2").innerHTML=de,t.byId("openReportBtn1").set("disabled",!1),t.byId("saveReportBtn1").set("disabled",!1),t.byId("openReportBtn2").set("disabled",!1),t.byId("saveReportBtn2").set("disabled",!1);Q.setExtent(y.graphicsExtent(K.graphics),!0);Q.centerAt(re),t.byId("reportPreviewDialog").set("title","Resource Report Preview ("+t.byId("distCombo").get("value")+" "+j+" buffer radius)"),t.byId("reportPreviewDialog").show()}function I(){t.byId("reportPreviewDialog").hide()}function P(e){return function(r){function a(e){var t,r,a,s;if($.gameBoundaries&&(p+=g,le.setFontSize(16),le.setFont(c,"bold"),le.text(ae,p,"Location & Contact Information:"),p+=g,le.setFont(c,"normal"),le.setFontSize(f),le.text(ae,p,"County:"),le.text(m,p,e[C].features[0].attributes.COUNTY),p+=g,le.text(ae,p,"Game Mgt. Unit (GMU):"),le.text(m,p,e[C].features[0].attributes.GMUID.toString())),$.contactBoundaries&&(p+=g,le.text(ae,p,"Sheriff Phone:"),le.text(m,p,e[F].features[0].attributes.Sheriff_FOPhone),p+=2*g,le.setFont(c,"bold"),le.text(ae,p,"CPW"),le.setLineWidth(.5),le.line(ae,p+1,ae+27,p+1),p+=g,le.setFont(c,"normal"),le.setFontSize(f),le.text(ae,p,"CPW Area:"),le.text(m,p,e[F].features[0].attributes.CDOW_Area),p+=g,le.text(ae,p,"CPW District:"),le.text(m,p,e[F].features[0].attributes.CDOW_District),p+=g,le.text(ae,p,"CPW Field Office:"),le.text(m,p,e[F].features[0].attributes.CDOW_FOName),p+=g,le.text(ae,p,"CPW Field Office Address:"),le.text(m,p,e[F].features[0].attributes.CDOW_FOAddress),p+=g,le.text(ae,p,"CPW Field Office City, Zip:"),le.text(m,p,e[F].features[0].attributes.CDOW_FOCity+", CO "+e[F].features[0].attributes.CDOW_FOZipcode),p+=g,le.text(ae,p,"CPW Field Office Phone:"),le.text(m,p,e[F].features[0].attributes.CDOW_FOPhone),p+=2*g,le.setFont(c,"bold"),le.text(ae,p,"BLM"),le.setLineWidth(.5),le.line(ae,p+1,ae+27,p+1),p+=g,le.setFont(c,"normal"),le.setFontSize(f),le.text(ae,p,"BLM District:"),le.text(m,p,e[F].features[0].attributes.BLM_District),p+=g,le.text(ae,p,"BLM Field Office:"),le.text(m,p,e[F].features[0].attributes.BLM_FOName),p+=g,le.text(ae,p,"BLM Field Office Address:"),le.text(m,p,e[F].features[0].attributes.BLM_FOAddress),p+=g,le.text(ae,p,"BLM Field Office City, Zip:"),le.text(m,p,e[F].features[0].attributes.BLM_FOCity+", CO "+e[F].features[0].attributes.BLM_FOZipcode),p+=g,le.text(ae,p,"BLM Field Office Phone:"),le.text(m,p,e[F].features[0].attributes.BLM_FOPhone),p+=2*g,le.setFont(c,"bold"),le.text(ae,p,"USFS"),le.setLineWidth(.5),le.line(ae,p+1,ae+34,p+1),e[F].features[0].attributes.USFS_FOName)){p+=g,le.setFont(c,"normal"),le.setFontSize(f),le.text(ae,p,"Forest:"),le.text(m,p,e[F].features[0].attributes.NF_NG_NAME),p+=g,le.text(ae,p,"Forest Field Office:");var l=le.setFontSize(f).splitTextToSize(e[F].features[0].attributes.USFS_FOName,390,{fontName:"arial",fontStyle:"normal"});le.text(m,p,l),l.length>1&&(p+=g),p+=g,le.text(ae,p,"Forest Field Office Address:"),le.text(m,p,e[F].features[0].attributes.USFS_FOAddress),p+=g,le.text(ae,p,"Forest Field Office City, Zip:"),le.text(m,p,e[F].features[0].attributes.USFS_FOCity+", CO "+e[F].features[0].attributes.USFS_FOZipcode),p+=g,le.text(ae,p,"Forest Field Office Phone:"),le.text(m,p,e[F].features[0].attributes.USFS_FOPhone)}if($.pointsOfInterest){t=[],r=[],a=[],s=[],ResMed=[],ResSheriff=[],ResLicAg=[],ResStPatrol=[],ResBLMOff=[],ResForOff=[],ResCPWOff=[],ResChamber=[],ResWelcome=[];for(var u=0;u<e[T].features.length;u++)feature=e[T].features[u],attr=e[T].features[u].attributes,X.contains(feature.geometry)&&("campground"==attr.Type.toLowerCase()?"BLM"==attr.Manager?t.push({property:attr.CGPropertyName?attr.CGPropertyName:attr.CGPropertyName2,name:attr.Name,website:attr.URL1}):"CPW"==attr.Manager||"CDOW"==attr.Manager?r.push({property:attr.CGPropertyName?attr.CGPropertyName:attr.CGPropertyName2,name:attr.Name,website:attr.URL1}):"State Parks"==attr.Manager?a.push({property:attr.CGPropertyName?attr.CGPropertyName:attr.CGPropertyName2,name:attr.Name,website:attr.URL1}):"USFS"==attr.Manager&&s.push({property:attr.CGPropertyName?attr.CGPropertyName:attr.CGPropertyName2,name:attr.Name,website:attr.URL1}):"license agent"==attr.Type.toLowerCase()?ResLicAg.push({name:attr.Name,address:attr.Address,city:attr.City,phone:attr.Phone}):"medical"==attr.Type.toLowerCase()?ResMed.push({name:attr.Name,address:attr.Address,city:attr.City,phone:attr.Phone}):"sheriff"==attr.Type.toLowerCase()?ResSheriff.push({name:attr.Name,address:attr.Address,city:attr.City,phone:attr.Phone}):"state patrol"==attr.Type.toLowerCase()?ResStPatrol.push({name:attr.Name,address:attr.Address,city:attr.City,phone:attr.Phone}):"blm field office"==attr.Type.toLowerCase()?ResBLMOff.push({name:attr.Name,address:attr.Address,city:attr.City,phone:attr.Phone}):"forest service office"==attr.Type.toLowerCase()?ResForOff.push({name:attr.Name,address:attr.Address,city:attr.City,phone:attr.Phone}):"cdow office"==attr.Type.toLowerCase()||"cpw office"==attr.Type.toLowerCase()?ResCPWOff.push({name:attr.Name,address:attr.Address,city:attr.City,phone:attr.Phone}):"chamber of commerce"==attr.Type.toLowerCase()?ResChamber.push({name:attr.Name,address:attr.Address,city:attr.City,phone:attr.Phone}):"welcome center"==attr.Type.toLowerCase()&&ResWelcome.push({name:attr.Name,address:attr.Address,city:attr.City,phone:attr.Phone}));var y;(t.length>0||r.length>0||a.length>0||s.length>0)&&(t.sort(sortMultipleArryOfObj("property","name")),r.sort(sortMultipleArryOfObj("property","name")),a.sort(sortMultipleArryOfObj("property","name")),s.sort(sortMultipleArryOfObj("property","name")),o(),p=ne+14,le.addPage(),le.setFontSize(16),le.setFont(c,"bold"),le.text(ae,p,"Campsites within "+_+" miles of map click:"),le.setFontSize(f),p+=2*g,y=[],y.push({displayname:"Property",field:"property",width:200}),y.push({displayname:"Name",field:"name",width:200}),y.push({displayname:"Website",field:"website",width:ie-400}),i("BLM",t,y),i("CPW",r,y),i("State Parks",a,y),i("USFS",s,y)),(ResChamber.length>0||ResBLMOff.length>0||ResCPWOff.length>0||ResForOff.length>0||ResLicAg.length>0||ResMed.length>0||ResSheriff.length>0||ResStPatrol.length>0||ResWelcome.length>0)&&(ResMed.sort(sortMultipleArryOfObj("city","name")),ResSheriff.sort(sortMultipleArryOfObj("city","name")),ResLicAg.sort(sortMultipleArryOfObj("city","name")),ResStPatrol.sort(sortMultipleArryOfObj("city","name")),ResBLMOff.sort(sortMultipleArryOfObj("city","name")),ResForOff.sort(sortMultipleArryOfObj("city","name")),ResCPWOff.sort(sortMultipleArryOfObj("city","name")),ResChamber.sort(sortMultipleArryOfObj("city","name")),ResWelcome.sort(sortMultipleArryOfObj("city","name")),o(),p=ne+14,le.addPage(),le.setFontSize(16),le.setFont(c,"bold"),le.text(ae,p,"Information resources within "+_+" miles of map click:"),p+=2*g,y=null,y=[],y.push({displayname:"Name",field:"name",width:(ie-220)/2}),y.push({displayname:"Address",field:"address",width:(ie-220)/2}),y.push({displayname:"City",field:"city",width:120}),y.push({displayname:"Phone",field:"phone",width:100}),i("Chamber of Commerce",ResChamber,y),i("BLM Office",ResBLMOff,y),i("CPW Office",ResCPWOff,y),i("Forest Service Office",ResForOff,y),i("License Agent",ResLicAg,y),i("Medical",ResMed,y),i("Sheriff",ResSheriff,y),i("State Patrol",ResStPatrol,y),i("Welcome Center",ResWelcome,y))}ee.length>0?($.gameBoundaries||$.contactBoundaries||$.pointsOfInterest?(o(),p=ne+14,le.addPage()):p+=g,n(e)):(o(),d())}function n(e){function t(e){var t=0;$.gameBoundaries&&t++,$.contactBoundaries&&t++,$.pointsOfInterest&&t++,k=0;for(var a=0;a<ee.length;a++){if(ee[a].database&&""!=ee[a].database){createMultiXMLhttpRequest();for(var n=ee[a].keyField,s="",i=0;i<e[t].features.length;i++)e[t].features[i].attributes[n]&&""!=e[t].features[0].attributes[n]&&(0==i?s=e[t].features[i].attributes[n]:s+=","+e[t].features[i].attributes[n]);if(""==s){if(k++,te==k)return void r(e);t++;continue}var o=ee[a].database+"?v="+ndisVer+"&key="+s;XMLHttpRequestObjects[index].open("POST",o,!0),XMLHttpRequestObjects[index].onreadystatechange=function(t){return function(){if(4==XMLHttpRequestObjects[t].readyState)if(200==XMLHttpRequestObjects[t].status){for(var a,n=createXMLdoc(XMLHttpRequestObjects[t]),s=-1,i=0;i<ee.length;i++){var l=!1;if(e[i].features.length==n.getElementsByTagName("NewDataSet").length&&n.getElementsByTagName(ee[i].keyField).length>0){for(var d=[],p=0;p<e[i].features.length;p++)n.getElementsByTagName("NewDataSet")[p].getElementsByTagName(ee[i].keyField)[0]?d.push(n.getElementsByTagName("NewDataSet")[p].getElementsByTagName(ee[i].keyField)[0].childNodes[0].nodeValue):d.push("undefined");for(l=!0,p=0;p<e[i].features.length;p++)if("undefined"!=d[p]&&d[p]!=e[i].features[p].attributes[ee[i].keyField]){l=!1;break}}if(l){s=i;break}}if(-1==s)return void alert("Cannot find index for the XMLHttpRequest in javascript/resourceReport.js tableQuery(). ","Code Error");if(k++,n.childNodes[0].innerHTML&&n.childNodes[0].innerHTML.indexOf("error")>-1)return alert("Resource report error in database lookup. URL="+o+". "+n.childNodes[0].innerHTML,"Data Error"),void(k==te&&r(e));if(n.childNodes[0].textContent&&n.childNodes[0].textContent.indexOf("error")>-1)return alert("Resource report error in database lookup. URL="+o+". "+n.childNodes[0].textContent,"Data Error"),void(k==te&&r(e));for(i=0;i<n.getElementsByTagName("NewDataSet").length;i++){var u=n.getElementsByTagName("NewDataSet")[i];if(0!=u.getElementsByTagName(ee[s].keyField).length){if(u.getElementsByTagName(ee[s].keyField)[0].childNodes[0].nodeValue!=e[s].features[i].attributes[ee[s].keyField]&&alert("Resource report error in database lookup. Key fields do not match. "+u.getElementsByTagName(ee[s].keyField)[0].childNodes[0].nodeValue+" != "+e[s].features[i].attributes[ee[s].keyField],"Data Error"),ee[s].one2one_fields&&""!=ee[s].one2one_fields)for(a=0;a<ee[s].one2one_fields.length;a++)u.getElementsByTagName(ee[s].one2one_fields[a])[0]&&u.getElementsByTagName(ee[s].one2one_fields[a])[0].childNodes[0]&&""!=u.getElementsByTagName(ee[s].one2one_fields[a])[0].childNodes[0].nodeValue&&(e[s].features[i].attributes[ee[s].one2one_fields[a]]=u.getElementsByTagName(ee[s].one2one_fields[a])[0].childNodes[0].nodeValue.toString());if(ee[s].one2many_fields&&""!=ee[s].one2many_fields)for(a=0;a<ee[s].one2many_fields.length;a++){for(var g=[],f=0;f<u.getElementsByTagName(ee[s].filename).length;f++){var m=u.getElementsByTagName(ee[s].filename)[f];m.getElementsByTagName(ee[s].one2many_fields[a])[0]&&m.getElementsByTagName(ee[s].one2many_fields[a])[0].childNodes[0]&&""!=m.getElementsByTagName(ee[s].one2many_fields[a])[0].childNodes[0].nodeValue&&g.push(m.getElementsByTagName(ee[s].one2many_fields[a])[0].childNodes[0].nodeValue.toString())}g.sort();for(var c=0;c<g.length;c++)0==c?e[s].features[i].attributes[ee[s].one2many_fields[a]]="* "+g[c]:e[s].features[i].attributes[ee[s].one2many_fields[a]]+="\n* "+g[c];g=null}}}te==k&&r(e)}else 404==XMLHttpRequestObjects[t].status?(alert("Resource Report database lookup failed. Too many resources found. Try a smaller area. Status 404: file not found or not able to process.","Warning"),k==te&&r(e),hideLoading()):(alert("Resource Report database lookup failed for URL="+XMLHttpRequestObjects[t].responseURL+". (Note IE does not report the URL please use Chrome or Firefox.) Make sure it exists and does not have errors. Must be on the same machine. Edit "+app+"/ResourceReportWidget.xml.","Data Error"),k==te&&r(e),hideLoading())}}(index),XMLHttpRequestObjects[index].send()}t++}}function r(e){var t=0;$.gameBoundaries&&t++,$.contactBoundaries&&t++,$.pointsOfInterest&&t++;for(var r=0;r<ee.length;r++){ee[t].title&&""!=ee[t].title&&(o(),p=ne+14,le.addPage(),le.setFontSize(16),le.setFont(c,"bold"),le.text(ae,p,ee[t].title.replace("_distance_",_)),le.setFontSize(f),le.setFont(c,"normal"),p+=2*g);for(var a=[],n=[],s=0;s<ee[t].displayfields.length;s++)n[s]=ee[t].displayfields[s];for(var l=0;l<e[t].features.length;l++)if(feature=e[t].features[l],attr=feature.attributes,"point"==feature.geometry.type&&X.contains(feature.geometry)||"point"!=feature.geometry.type){var u={};for(s=0;s<ee[t].displayfields.length;s++)if(!n[s]&&attr[ee[t].fields[s]]||attr[ee[t].fields[s]]&&n[s].length<attr[ee[t].fields[s]].toString().length)if(attr[ee[t].fields[s]].toString().indexOf("\n")>-1)for(var m=attr[ee[t].fields[s]].toString().split("\n"),y=0;y<m.length;y++)(!n[s]||n[s].length<m[y].length)&&(n[s]=m[y]);else n[s]=attr[ee[t].fields[s]].toString();if(ee[t].where_field&&""!=ee[t].where_field){var b,h;switch("number"==ee[t].where_type.toLowerCase()?(b=parseFloat(ee[t].where_value),h=parseFloat(attr[ee[t].where_field])):(b=ee[t].where_value.toLowerCase(),h=attr[ee[t].where_field].toLowerCase()),ee[t].where_inequality){case"equal":if(h==b){for(s=0;s<ee[t].displayfields.length;s++)u[ee[t].fields[s]]=attr[ee[t].fields[s]];a.push(u),u=null}break;case"not_equal":if(h!=b){for(s=0;s<ee[t].displayfields.length;s++)u[ee[t].fields[s]]=attr[ee[t].fields[s]];a.push(u),u=null}break;case"less_than":if(h<b){for(s=0;s<ee[t].displayfields.length;s++)u[ee[t].fields[s]]=attr[ee[t].fields[s]];a.push(u),u=null}break;case"greater_than":if(h>b){for(s=0;s<ee[t].displayfields.length;s++)u[ee[t].fields[s]]=attr[ee[t].fields[s]];a.push(u),u=null}break;default:alert("Error in "+app+"/ResourceReportWidget.xml file in report tag, id="+ee[t].id+" where_inequality must be: equal, not_equal, less_than, or greater_than.","Data Error")}}else{for(s=0;s<ee[t].displayfields.length;s++)u[ee[t].fields[s]]=attr[ee[t].fields[s]];a.push(u),u=null}}var B=0,R=200;for(s=0;s<n.length;s++)n[s]=10+Math.round(le.getStringUnitWidth(n[s])*f/le.internal.scaleFactor),n[s]>R&&(n[s]=R),B+=n[s];var v=0;if(ie>B){var E=Math.round((ie-B)/n.length);for(s=0;s<n.length;s++)n[s]+=E,v+=n[s];v!=ie&&(n[0]+=ie-v)}else if(ie<B){var w=ie-B;for(s=0;s<n.length;s++)n[s]+=Math.round(n[s]/B*w),v+=n[s];v!=ie&&(n[0]+=ie-v)}var M=[];for(s=0;s<ee[t].displayfields.length;s++)M.push({displayname:ee[t].displayfields[s],field:ee[t].fields[s],width:n[s]});a.length>0&&(a.sort(sortMultipleArryOfObj(ee[t].sortfields)),i(ee[t].subtitle,a,M)),t++,n=null,M=null}o(),d()}if(le.setFontSize(16),le.setFont(c,"bold"),le.text(ae,p,ee[0].title.replace("_distance_",_)),le.setFontSize(f),le.setFont(c,"normal"),ee[0].title="",p+=2*g,te>0){for(index=0;XMLHttpRequestObjects.length>0;)XMLHttpRequestObjects.pop();t(e)}else r(e)}function s(e){alert("Error message: "+e.message+" in ResourceReportWidget.xml at resourceReport.js, queryFaultHandler"),document.getElementById("reportMsg1").innerHTML="",document.getElementById("reportMsg2").innerHTML=""}function i(e,r,a){function n(){le.setFont(c,"bold"),le.setFontSize(f),le.myText(ae,p,e,{underline:!0}),p+=5,le.setFillColor(204,204,204),le.setDrawColor(0),le.rect(ae,p,ie,l,"FD");var t=ae+4;le.setFont(c,"normal"),p+=g;for(var r=0;r<a.length;r++)a[r].displayname&&le.text(t,p,a[r].displayname),t+=a[r].width,r<a.length-1&&le.line(t-4,p-g,t-4,p+6);p+=l}try{var s,i;if(0==r.length)return;var l=20,d=[],u=[],m=[];for(m[0]=ae,s=0;s<r.length;s++)for(d[s]=[],u[s]=1,i=0;i<a.length;i++)r[s][a[i].field]?(""!=r[s][a[i].field]?d[s][i]=le.setFontSize(f).splitTextToSize(r[s][a[i].field].toString(),a[i].width-8,{fontName:"arial",fontStyle:"normal"}):d[s][i]="",d[s][i].length>u[s]&&(u[s]=d[s][i].length)):d[s][i]="",0==s&&i+1<a.length&&(m[i+1]=m[i]+a[i].width);for(p+5+l+g*u[0]+l>oe-g&&(o(),p=ne+14,le.addPage()),n(),s=0;s<r.length;s++){for(i=0;i<a.length;i++)0==i&&le.line(m[i],p-g,m[i],p+g*(u[s]-1)+l-g),le.text(m[i]+4,p,d[s][i]),le.line(m[i]+a[i].width,p-g,m[i]+a[i].width,p+g*(u[s]-1)+l-g);le.line(ae,p+g*(u[s]-1)+l-g,ie+ae,p+g*(u[s]-1)+l-g),p+=g*u[s]+l-g,s<r.length-1&&p+g*u[s+1]+l-g>=oe-g&&(o(),p=ne+14,le.addPage(),-1==e.indexOf("Continued")&&(e+=" - Continued"),n())}p+=g,d=null,m=null,u=null}catch(r){alert("Resource report error while creating table for "+e+". "+r.message,"Code Error",r),t.byId("openReportBtn1").set("disabled",!1),t.byId("saveReportBtn1").set("disabled",!1),t.byId("openReportBtn2").set("disabled",!1),t.byId("saveReportBtn2").set("disabled",!1)}}function o(){le.setFontSize(10),le.setFont(c,"normal"),le.text(368,oe-g,"page "+u),u++,le.setFontSize(f)}function l(){le.setFontSize(5),le.setFont(c,"normal"),le.text(ie+ae-30,oe-7,"page "+u),le.setFontSize(f)}function d(){function e(e){function r(){for(var e=le.output(),r=new ArrayBuffer(e.length),a=new Uint8Array(r),n=0;n<e.length;n++)a[n]=e.charCodeAt(n);var s=new Blob([a],{type:"application/pdf",encoding:"raw"});saveAs(s,"AtlasReport.pdf"),s=null,r=null,a=null,e=null,t.byId("openReportBtn1").set("disabled",!1),t.byId("saveReportBtn1").set("disabled",!1),t.byId("openReportBtn2").set("disabled",!1),t.byId("saveReportBtn2").set("disabled",!1)}function a(){var e=le.output("datauristring"),r="<iframe width='100%' height='100%' referrerPolicy='origin' src='"+e+"'></iframe>",a=window.open();if(!a)return alert("Failed to open PDF. Make sure popups are allowed.","Warning"),t.byId("openReportBtn1").set("disabled",!1),t.byId("saveReportBtn1").set("disabled",!1),t.byId("openReportBtn2").set("disabled",!1),t.byId("saveReportBtn2").set("disabled",!1),document.getElementById("reportMsg1").innerHTML="",void(document.getElementById("reportMsg2").innerHTML="");a.document.open(),a.document.write(r),a.document.title="Atlas Report",a.document.close(),t.byId("openReportBtn1").set("disabled",!1),t.byId("saveReportBtn1").set("disabled",!1),t.byId("openReportBtn2").set("disabled",!1),t.byId("saveReportBtn2").set("disabled",!1),document.getElementById("reportMsg1").innerHTML="",document.getElementById("reportMsg2").innerHTML=""}var n=new Image;n.onerror=function(){document.getElementById("reportMsg1").innerHTML=de,document.getElementById("reportMsg2").innerHTML=de,alert("Resource report cannot load image: "+n.src,"Code Error"),n=null,t.byId("openReportBtn1").set("disabled",!1),t.byId("saveReportBtn1").set("disabled",!1),t.byId("openReportBtn2").set("disabled",!1),t.byId("saveReportBtn2").set("disabled",!1)},n.onload=function(){try{le.addImage(n,"JPEG",0,0,792,612),n=null,l(),"save"==ge?(r(),document.getElementById("reportMsg1").innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Downloaded PDF",document.getElementById("reportMsg2").innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Downloaded PDF"):navigator.sayswho.indexOf("IE")>-1|navigator.sayswho.indexOf("Edge")>-1?(r(),document.getElementById("reportMsg1").innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Download or Open PDF in pop-up. Make sure pop-ups are enabled.",document.getElementById("reportMsg2").innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Download or Open PDF in pop-up. Make sure pop-ups are enabled."):(a(),document.getElementById("reportMsg1").innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Opening PDF in pop-up. Make sure pop-ups are enabled.",document.getElementById("reportMsg2").innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Opening PDF in pop-up. Make sure pop-ups are enabled.")}catch(e){document.getElementById("reportMsg1").innerHTML=de,document.getElementById("reportMsg2").innerHTML=de,alert("Resource report generation Error in javascript/resourceReport.js printResult() img.onload. "+e.message,"Code Error",e)}},n.src=e.url,window.location.hostname.indexOf("ndis-2020-dev")>-1&&(n.src="assets/images/testmap.jpg",alert("The image in the pdf is a placeholder. <a href='"+e.url+"' target='pdf_image'>Here is a link to the true image.</a>","Note for Test Site"))}function r(e){document.getElementById("reportMsg1").innerHTML=de,document.getElementById("reportMsg2").innerHTML=de,e.details?alert("Error creating resource report map: "+e+" Details: "+e.details,"Code Error",e):alert("Error printing resource report: "+e,"Code Error",e)}try{document.getElementById("reportMsg1").innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src='assets/images/loading.gif' width='20px' height='20px'/> Generating map image for report",document.getElementById("reportMsg2").innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src='assets/images/loading.gif' width='20px' height='20px'/> Generating map image for report",le.addPage();var a=new h(Y),n=new R,s=new B;s.exportOptions={dpi:se,outputSize:[3150,2400]},s.layout="Letter ANSI A Landscape",s.format="JPG",s.preserveScale=!0,s.showAttribution=!1,s.layoutOptions={legendLayers:[],titleText:q,authorText:V,customTextElements:[{Subtitle:z}]},n.map=Q,n.template=s,a.execute(n,e,r)}catch(e){alert("Error creating map for resource report. "+e.message,"Code Error",e)}}if(re){t.byId("openReportBtn1").set("disabled",!0),t.byId("saveReportBtn1").set("disabled",!0),t.byId("openReportBtn2").set("disabled",!0),t.byId("saveReportBtn2").set("disabled",!0),document.getElementById("reportMsg1").innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src='assets/images/loading.gif' width='20px' height='20px'/> Generating tables for report...",document.getElementById("reportMsg2").innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src='assets/images/loading.gif' width='20px' height='20px'/> Generating tables for report...",ge=e,oe=612-ne,le=null,le=new jsPDF("landscape","pt","letter"),le.onerror=function(){document.getElementById("reportMsg1").innerHTML=de,document.getElementById("reportMsg2").innerHTML=de,alert("Error generating PDF for resource report.","Code Error"),t.byId("openReportBtn1").set("disabled",!1),t.byId("saveReportBtn1").set("disabled",!1),t.byId("openReportBtn2").set("disabled",!1),t.byId("saveReportBtn2").set("disabled",!1)};var p=ne+20,u=1,g=14,f=12,m=300,c="arial";le.setProperties({title:U,author:"Colorado Parks and Wildlife",keywords:"hunting, fishing, atlas, ndis"}),le.setFontSize(22),le.setFont(c,"bold"),le.text(ae,p,U),p+=22,le.setFont(c,"normal"),le.setFontSize(f);var y={Jan:"January",Feb:"February",Mar:"March",Apr:"April",May:"May",Jun:"June",Jul:"July",Aug:"August",Sep:"September",Oct:"October",Nov:"November",Dec:"December"};ue=new Date,ue=ue.toDateString(),ue="0"==ue.substr[8]?y[ue.substr(4,3)]+" "+ue.substr(9,1)+","+ue.substr(ue.length-5,ue.length):y[ue.substr(4,3)]+" "+ue.substr(8,2)+","+ue.substr(ue.length-5,ue.length),le.text(ae,p,ue),p+=g,le.text(ae,p,"X/Y at map click:");var b=E.webMercatorToGeographic(re);le.text(m,p,b.y.toFixed(5)+" N, "+-1*b.x.toFixed(5)+" W"),p+=g;var v,T,F,C,N=[],O=[],x=[],S=0;$.pointsOfInterest&&(O[S]=new M($.pointsOfInterest.url),N[S]=new w,N[S].geometry=X.getExtent(),N[S].returnGeometry=!0,N[S].spatialRelationship=w.SPATIAL_REL_INTERSECTS,N[S].outFields=["*"],x.push(O[S].execute(N[S])),T=S,S++),$.contactBoundaries&&(N[S]=new w,O[S]=new M($.contactBoundaries.url),N[S].geometry=X.getExtent(),N[S].returnGeometry=!0,N[S].spatialRelationship=w.SPATIAL_REL_INTERSECTS,N[S].outFields=["*"],N[S].geometry=re,x.push(O[S].execute(N[S])),F=S,S++),$.gameBoundaries&&(N[S]=new w,O[S]=new M($.gameBoundaries.url),N[S].geometry=X.getExtent(),N[S].returnGeometry=!0,N[S].spatialRelationship=w.SPATIAL_REL_INTERSECTS,N[S].outFields=["*"],N[S].geometry=re,x.push(O[S].execute(N[S])),C=S,S++);for(var A=0;A<$.layers.length;A++)S,O[S]=new M($.layers[A].url),N[S]=new w,N[S].geometry=X.getExtent(),N[S].returnGeometry=!0,N[S].spatialRelationship=w.SPATIAL_REL_INTERSECTS,N[S].outFields=["*"],x.push(O[S].execute(N[S])),S++;x.length>0&&(v=L(x),v.then(a),v.otherwise(s))}}}try{var _,D,j,k,W,H,G,U,q,z,V,X,J,Z,Y,Q,K,$={pointsOfInterest:null,contactBoundaries:null,gameBoundaries:null,layers:[]},ee=[],te=0,re=null,ae=18,ne=18,se=300,ie=792-2*ae,oe=612-ne,le=new jsPDF("landscape","pt","letter"),de="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Adjust map boundaries. Click Open/Save Report when ready.",pe=new i;pe.id="reportGraphicsLayer1",map.addLayer(pe);var ue,ge,fe=createXMLhttpRequest(),me=app+"/ResourceReportWidget.xml?v="+ndisVer;fe.onerror=function(){alert("Error loading "+app+"/ResourceReportWidget.xml","Data Error")},fe.onreadystatechange=function(){if(4==fe.readyState)if(200==fe.status){var e=createXMLdoc(fe);e||alert("Missing "+app+"/ResourceReportWidget.xml file.","Data Error");var t=e.getElementsByTagName("buffer")[0]?e.getElementsByTagName("buffer")[0]:C("buffer tag");_=t.getAttribute("default")?t.getAttribute("default"):C("default attribute of the buffer tag"),D=t.getAttribute("list")?t.getAttribute("list").split(","):C("list attribute of the buffer tag"),j=t.getAttribute("unitslabel")?t.getAttribute("unitslabel"):C("unitslabel attribute of the buffer tag");var r=e.getElementsByTagName("querylayers")[0].getElementsByTagName("layers")?e.getElementsByTagName("querylayers")[0].getElementsByTagName("layers"):null,a=e.getElementsByTagName("reports")[0]&&e.getElementsByTagName("reports")[0].getElementsByTagName("report")?e.getElementsByTagName("reports")[0].getElementsByTagName("report"):null;if(W=e.getElementsByTagName("reportserviceurl")[0]?e.getElementsByTagName("reportserviceurl")[0].firstChild.nodeValue:C("reportserviceurl tag"),Y=e.getElementsByTagName("printserviceurl")[0]?e.getElementsByTagName("printserviceurl")[0].firstChild.nodeValue:C("printserviceurl tag"),H=e.getElementsByTagName("basemapurl")[0]?e.getElementsByTagName("basemapurl")[0].firstChild.nodeValue:C("basemapurl tag"),U=e.getElementsByTagName("reporttitle")[0]?e.getElementsByTagName("reporttitle")[0].firstChild.nodeValue:C("reporttitle tag"),e.getElementsByTagName("pointsofinterest")[0]&&e.getElementsByTagName("contactinfo"[0])&&e.getElementsByTagName("gameunits")[0]&&($.pointsOfInterest={url:e.getElementsByTagName("pointsofinterest")[0].getAttribute("url"),name:e.getElementsByTagName("pointsofinterest")[0].getAttribute("name")},$.contactBoundaries={url:e.getElementsByTagName("contactinfo")[0].getAttribute("url"),name:e.getElementsByTagName("contactinfo")[0].getAttribute("name")},$.gameBoundaries={url:e.getElementsByTagName("gameunits")[0].getAttribute("url"),name:e.getElementsByTagName("gameunits")[0].getAttribute("name")}),r){for(var n=0;n<r.length;n++)r[n].getAttribute("type")||alert("Missing type parameter in layer tag in "+app+"/ResourceReportWidget.xml file","Data Error"),
r[n].getAttribute("name")||alert("Missing name parameter in layer tag in "+app+"/ResourceReportWidget.xml file","Data Error"),r[n].getAttribute("url")||alert("Missing url parameter in layer tag in "+app+"/ResourceReportWidget.xml file","Data Error"),$.layers.push({type:r[n].getAttribute("type"),name:r[n].getAttribute("name"),url:r[n].getAttribute("url")});if(a)for(n=0;n<a.length;n++){var s={id:a[n].getAttribute("id")?a[n].getAttribute("id"):C("reports tag, id attribute"),type:a[n].getAttribute("type")?a[n].getAttribute("type"):C("reports tag, type attribute"),title:a[n].getAttribute("title")?a[n].getAttribute("title"):"",subtitle:a[n].getAttribute("subtitle")?a[n].getAttribute("subtitle"):C("reports tag, subtitle attribute"),displayfields:a[n].getAttribute("displayfields")?a[n].getAttribute("displayfields").split(","):C("reports tag, displayfields attribute"),fields:a[n].getAttribute("fields")?a[n].getAttribute("fields").split(","):C("reports tag, fields attribute"),where_field:a[n].getAttribute("where_field")?a[n].getAttribute("where_field"):"",where_inequality:a[n].getAttribute("where_inequality")?a[n].getAttribute("where_inequality"):"",where_value:a[n].getAttribute("where_value")?a[n].getAttribute("where_value"):"",where_type:a[n].getAttribute("where_type")?a[n].getAttribute("where_type"):"",sortfields:a[n].getAttribute("sortfields")?a[n].getAttribute("sortfields").split(","):a[n].getAttribute("fields").split(","),keyField:a[n].getAttribute("key")?a[n].getAttribute("key"):null,database:a[n].getAttribute("database")?a[n].getAttribute("database"):null,filename:a[n].getAttribute("filename")?a[n].getAttribute("filename"):null,one2one_fields:a[n].getAttribute("one2one_fields")?a[n].getAttribute("one2one_fields").split(","):null,one2one_display:a[n].getAttribute("one2one_display")?a[n].getAttribute("one2one_display").split(","):a[n].getAttribute("one2one_fields")?a[n].getAttribute("one2one_fields").split(","):null,one2many_fields:a[n].getAttribute("one2many_fields")?a[n].getAttribute("one2many_fields").split(","):null,one2many_display:a[n].getAttribute("one2many_display")?a[n].getAttribute("one2many_display").split(","):a[n].getAttribute("one2many_fields")?a[n].getAttribute("one2many_fields").split(","):null};ee.push(s),s.database&&""!=s.database&&te++,s=null}}q=e.getElementsByTagName("title")[0]?e.getElementsByTagName("title")[0].firstChild.nodeValue:C("title tag"),z=e.getElementsByTagName("subtitle")[0]?e.getElementsByTagName("subtitle")[0].firstChild.nodeValue:C("subtitle tag"),V=e.getElementsByTagName("disclaimer")[0]?e.getElementsByTagName("disclaimer")[0].firstChild.nodeValue:C("disclaimer tag"),F()}else 404===fe.status&&alert("File: "+app+"/ResourceReportWidget.xml not found.","Data Error")},fe.open("GET",me,!0),fe.send(null),ce=jsPDF.API,ce.myText=function(e,t,r,a,n){a=a||{};var s,i=this.internal.getFontSize();s=n||this.internal.pageSize.width,txtWidth=this.getStringUnitWidth(r)*i/this.internal.scaleFactor,"center"==a.align?(e+=(s-txtWidth)/2,this.text(r,e,t)):"right"==a.align?(e+=s-(txtWidth+3),this.text(r,e,t)):1==a.underline&&(this.text(r,e,t),this.line(e,t+1,e+1.15*txtWidth,t+1))}}catch(e){alert(e.message+" in javascript/resourceReport.js reportInit.","Code Error",e)}var ce})}