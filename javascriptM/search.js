var searchHelp=null;function searchInit(){try{var usingCounty;var fishSpeciesGraphicalName="Fish species in known fishing spots";document.getElementById("searchLoadingImg").style.display="block";require(["dojo/_base/window","javascript/HelpWin"],function(win,HelpWin){searchHelp=new HelpWin({label:"Feature Search Help",content:'Search for a named location by feature type. Allows searching for <b>township, range, and section</b>. The Fishing Atlas '+'will highlight water bodies where certain <b>fish species</b> can be found. Select feature type and enter search text.  As you '+'type, matches will be suggested. To remove the highlighted features from the map, press the Clear button on the main menu. '+'<br/><br/>'});win.body().appendChild(searchHelp.domNode);searchHelp.startup();});var configFile=app+"/SearchWidget.xml?v="+ndisVer;var xmlhttp=createXMLhttpRequest();xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4&&xmlhttp.status===200){var xmlDoc=createXMLdoc(xmlhttp);try{require(["dojo/dom","dijit/registry","dojo/_base/lang","dojo/mouse","dojo/_base/Color","dojo/store/Memory","dijit/form/ComboBox","dijit/form/Select","esri/toolbars/draw","esri/request","esri/tasks/query","esri/tasks/QueryTask","esri/graphic","esri/layers/GraphicsLayer","esri/urlUtils","esri/geometry/Point","esri/symbols/PictureMarkerSymbol","esri/symbols/SimpleLineSymbol","esri/symbols/SimpleFillSymbol","dojo/_base/declare","dgrid/OnDemandGrid","dgrid/extensions/DijitRegistry","dojo/domReady!"],function(dom,registry,lang,mouse,Color,Memory,ComboBox,Select,Draw,esriRequest,Query,QueryTask,Graphic,GraphicsLayer,urlUtils,Point,PictureMarkerSymbol,SimpleLineSymbol,SimpleFillSymbol,declare,OnDemandGrid,DijitRegistry){try{var graphicAC;var tabHeight="300px";var tabWithGridHeight="510px";var displayNames;var queryLayer;var queryFields;var queryTitleField;var queryLinkField;var queryLinkText;var widgetIcon="assets/images/i_pin.png";var graphicsLayer=new GraphicsLayer();var graphicsHLLayer=new GraphicsLayer();var graphicPointSym=new PictureMarkerSymbol(widgetIcon,40,40);graphicPointSym.setOffset(15,17);graphicsLayer.symbol=graphicPointSym;map.addLayer(graphicsLayer);var graphicPointHLSym=new PictureMarkerSymbol(widgetIcon,50,50);graphicsHLLayer.symbol=graphicPointHLSym;var graphicLineSym=new SimpleLineSymbol(SimpleLineSymbol.STYLE_SOLID,new Color([255,0,0,0.8]),2);var graphicPolySym=new SimpleFillSymbol(SimpleLineSymbol.STYLE_SOLID,graphicLineSym,new Color([255,0,0,0.1]));var graphicLineHLSym=new SimpleLineSymbol(SimpleLineSymbol.STYLE_SOLID,new Color([255,255,0,0.8]),2);var graphicPolyHLSym=new SimpleFillSymbol(SimpleLineSymbol.STYLE_SOLID,graphicLineSym,new Color([255,255,0,0.5]));map.addLayer(graphicsHLLayer);var recAC;var layers=xmlDoc.getElementsByTagName("layer");var searchObj=[];var data=[];var fsGrid;var featureStore=new Memory({data:[]});var graphicFeatureStore=new Memory({data:[]});var zoomScale=72224;if(xmlDoc.getElementsByTagName("zoomscale")[0]&&xmlDoc.getElementsByTagName("zoomscale")[0].childNodes[0].nodeValue)
zoomScale=xmlDoc.getElementsByTagName("zoomscale")[0].childNodes[0].nodeValue;for(var i=0;i<layers.length;i++){var n="unknown";if(layers[i].getElementsByTagName("name")[0]&&layers[i].getElementsByTagName("name")[0].childNodes[0].nodeValue)
n=layers[i].getElementsByTagName("name")[0].childNodes[0].nodeValue;else{showWarning("name");}
searchObj[n]={name:n,url:layers[i].getElementsByTagName("url")[0].childNodes[0]?layers[i].getElementsByTagName("url")[0].childNodes[0].nodeValue:showWarning("url"),expression:layers[i].getElementsByTagName("expression")[0].childNodes[0]?layers[i].getElementsByTagName("expression")[0].childNodes[0].nodeValue:showWarning("expression"),searchfield:layers[i].getElementsByTagName("searchfield")[0].childNodes[0]?layers[i].getElementsByTagName("searchfield")[0].childNodes[0].nodeValue:showWarning("searchfield"),textsearchlabel:layers[i].getElementsByTagName("textsearchlabel")[0].childNodes[0]?layers[i].getElementsByTagName("textsearchlabel")[0].childNodes[0].nodeValue:showWarning("textsearchlabel"),fields:layers[i].getElementsByTagName("fields")[0].childNodes[0]?layers[i].getElementsByTagName("fields")[0].childNodes[0].nodeValue:showWarning("fields"),displayfields:layers[i].getElementsByTagName("displayfields")[0].childNodes[0]?layers[i].getElementsByTagName("displayfields")[0].childNodes[0].nodeValue:showWarning("displayfields"),sortfield:layers[i].getElementsByTagName("sortfield")[0]&&layers[i].getElementsByTagName("sortfield")[0].childNodes[0]?layers[i].getElementsByTagName("sortfield")[0].childNodes[0].nodeValue:"none",numericsort:layers[i].getElementsByTagName("numericsort")[0]&&layers[i].getElementsByTagName("numericsort")[0].childNodes[0]?layers[i].getElementsByTagName("numericsort")[0].childNodes[0].nodeValue:"false",titlefield:layers[i].getElementsByTagName("titlefield")[0]&&layers[i].getElementsByTagName("titlefield")[0].childNodes[0]?layers[i].getElementsByTagName("titlefield")[0].childNodes[0].nodeValue:showWarning("titlefield"),linkfield:layers[i].getElementsByTagName("linkfield")[0]&&layers[i].getElementsByTagName("linkfield")[0].childNodes[0]?layers[i].getElementsByTagName("linkfield")[0].childNodes[0].nodeValue:"",linktext:layers[i].getElementsByTagName("linktext")[0]&&layers[i].getElementsByTagName("linktext")[0].childNodes[0]?layers[i].getElementsByTagName("linktext")[0].childNodes[0].nodeValue:"unknown link",searchvalues:layers[i].getElementsByTagName("searchvalues")[0]&&layers[i].getElementsByTagName("searchvalues")[0].childNodes[0]?layers[i].getElementsByTagName("searchvalues")[0].childNodes[0].nodeValue:"",lookupsearchvalues:layers[i].getElementsByTagName("lookupsearchvalues")[0]&&layers[i].getElementsByTagName("lookupsearchvalues")[0].childNodes[0]?layers[i].getElementsByTagName("lookupsearchvalues")[0].childNodes[0].nodeValue:"",lookupfilename:layers[i].getElementsByTagName("lookupsearchvalues")[0]&&layers[i].getElementsByTagName("lookupsearchvalues")[0].childNodes[0]?layers[i].getElementsByTagName("lookupfilename")[0].childNodes[0]?layers[i].getElementsByTagName("lookupfilename")[0].childNodes[0].nodeValue:showWarning("lookupfilename"):null,lookupfield:layers[i].getElementsByTagName("lookupsearchvalues")[0]&&layers[i].getElementsByTagName("lookupsearchvalues")[0].childNodes[0]?layers[i].getElementsByTagName("lookupfield")[0].childNodes[0]?layers[i].getElementsByTagName("lookupfield")[0].childNodes[0].nodeValue:showWarning("lookupfield"):null,database:layers[i].getElementsByTagName("database")[0]&&layers[i].getElementsByTagName("database")[0].childNodes[0]?layers[i].getElementsByTagName("database")[0].childNodes[0].nodeValue:null,filename:layers[i].getElementsByTagName("database")[0]&&layers[i].getElementsByTagName("database")[0].childNodes[0]?layers[i].getElementsByTagName("filename")[0].childNodes[0]?layers[i].getElementsByTagName("filename")[0].childNodes[0].nodeValue:showWarning("filename"):null,database_field:layers[i].getElementsByTagName("database")[0]&&layers[i].getElementsByTagName("database")[0].childNodes[0]?layers[i].getElementsByTagName("database_field")[0].childNodes[0]?layers[i].getElementsByTagName("database_field")[0].childNodes[0].nodeValue:showWarning("database_field"):null,database_field_type:layers[i].getElementsByTagName("database")[0]&&layers[i].getElementsByTagName("database")[0].childNodes[0]?layers[i].getElementsByTagName("database_field_type")[0].childNodes[0]?layers[i].getElementsByTagName("database_field_type")[0].childNodes[0].nodeValue:showWarning("database_field_type"):null,graphical_database:layers[i].getElementsByTagName("database")[0]&&layers[i].getElementsByTagName("database")[0].childNodes[0]?layers[i].getElementsByTagName("graphical_database")[0].childNodes[0]?layers[i].getElementsByTagName("graphical_database")[0].childNodes[0].nodeValue:null:null,graphical_filename:layers[i].getElementsByTagName("graphical_database")[0]&&layers[i].getElementsByTagName("graphical_database")[0].childNodes[0]?layers[i].getElementsByTagName("graphical_filename")[0].childNodes[0]?layers[i].getElementsByTagName("graphical_filename")[0].childNodes[0].nodeValue:showWarning("graphical_filename"):null,graphical_db_fields:layers[i].getElementsByTagName("graphical_database")[0]&&layers[i].getElementsByTagName("graphical_database")[0].childNodes[0]?layers[i].getElementsByTagName("graphical_db_fields")[0].childNodes[0]?layers[i].getElementsByTagName("graphical_db_fields")[0].childNodes[0].nodeValue:showWarning("graphical_db_fields"):null,graphical_db_displayfields:layers[i].getElementsByTagName("graphical_database")[0]&&layers[i].getElementsByTagName("graphical_database")[0].childNodes[0]?layers[i].getElementsByTagName("graphical_db_displayfields")[0].childNodes[0]?layers[i].getElementsByTagName("graphical_db_displayfields")[0].childNodes[0].nodeValue:showWarning("graphical_db_displayfields"):null,graphical_db_sort:layers[i].getElementsByTagName("graphical_database")[0]&&layers[i].getElementsByTagName("graphical_database")[0].childNodes[0]?layers[i].getElementsByTagName("graphical_db_sort")[0].childNodes[0]?layers[i].getElementsByTagName("graphical_db_sort")[0].childNodes[0].nodeValue:showWarning("graphical_db_sort"):null};function showWarning(tag){var layerName=layers[i].getElementsByTagName("name")[0]&&layers[i].getElementsByTagName("name")[0].childNodes[0]?layers[i].getElementsByTagName("name")[0].childNodes[0].nodeValue:"undefined";alert("WARNING: In SearchWidget.xml file required value missing for tag: "+tag+", in layer: "+layerName+".","Data Error")}
featureStore.data.push({name:searchObj[n].name,id:i});}
var searchTextStore=new Memory({data:[{name:"Loading..."}]});var featureTypeCombo=new Select({id:"featureType",name:"feature",store:featureStore,value:featureStore.data[0].name,sortByLabel:false,labelAttr:"name",maxHeight:-1,style:{width:"250px"},onChange:function(){updateSearchTextStore(this.attr("displayedValue"));registry.byId("searchText").reset();}},"featureType");featureTypeCombo.startup();var searchTextCombo=new ComboBox({id:"searchText",store:searchTextStore,autoComplete:false,searchAttr:searchObj[featureStore.data[0].name].searchfield,style:{width:"250px"},hasDownArrow:true,maxHeight:195,onClick:function(){if(featureTypeCombo.attr("displayedValue")=="GMUs"&&settings.useGMUs){if((gmu=="Big Game GMU"&&searchObj["GMUs"].titlefield!=settings.elkField)||(gmu=="Bighorn GMU"&&searchObj["GMUs"].titlefield!=settings.sheepField)||(gmu=="Goat GMU"&&searchObj["GMUs"].titlefield!=settings.goatField)){this.loadAndOpenDropDown();updateSearchTextStore("GMUs");}}},onKeyUp:function(value){if([27,33,34,37,38,39,40].indexOf(value.keyCode)>-1)return;updateSearchTextStore(registry.byId("featureType").attr("displayedValue"));}},"searchText").startup();var sectionStore=new Memory({idProperty:"id",data:[]});for(i=0;i<37;i++){if(i==0)sectionStore.data.push({id:"",name:""});else if(i<10)sectionStore.data.push({id:"00"+i,name:"00"+i});else sectionStore.data.push({id:"0"+i,name:"0"+i});}
var sectionCombo=new Select({id:"searchSec",labelAttr:"name",style:{width:"50px",position:"absolute",left:"77px"},maxHeight:158,store:sectionStore},"searchSec");sectionCombo.startup();function updateSearchTextStore(id){try{registry.byId("searchText").set("placeHolder","");if(id==="Township Range"){document.getElementById("searchInput1").style.display="none";document.getElementById("searchInput2").style.display="block";document.getElementById("searchTwn").value="";document.getElementById("searchRng").value="";registry.byId("searchSec").attr("value","");return;}
if(id=="GMUs"&&settings.useGMUs){if(gmu=="Big Game GMU"){searchObj[id].fields=settings.elkField+",COUNTY";searchObj[id].displayfields="GMU,County";searchObj[id].titlefield=settings.elkField;searchObj[id].searchfield=settings.elkField;searchObj[id].expression=settings.elkField+" = [value]";searchObj[id].url=settings.elkUrl;}
else if(gmu=="Bighorn GMU"){searchObj[id].fields=settings.sheepField;searchObj[id].displayfields="Bighorn Sheep GMU";searchObj[id].titlefield=settings.sheepField;searchObj[id].searchfield=settings.sheepField;searchObj[id].expression=settings.sheepField+" = UPPER('[value]')";searchObj[id].url=settings.sheepUrl;}
else{searchObj[id].fields=settings.goatField;searchObj[id].displayfields="Mountain Goat GMU";searchObj[id].titlefield=settings.goatField;searchObj[id].searchfield=settings.goatField;searchObj[id].expression=settings.goatField+" = UPPER('[value]')";searchObj[id].url=settings.goatUrl;}}
document.getElementById("searchInput1").style.display="block";document.getElementById("searchInput2").style.display="none";document.getElementById("searchLabel").innerHTML=searchObj[id].textsearchlabel+" ";if(searchObj[id].searchvalues!=""){fillSearchValues(id);return;}
else if(searchObj[id].lookupsearchvalues!=""){fillLookupSearchValues(id);return;}
var attr=id;document.getElementById("searchLoadingImg").style.display="block";esri.config.defaults.io.proxyUrl="/proxy/DotNet/proxy.ashx";var expr;var userText=registry.byId("searchText").attr("displayedValue");if(searchObj[id].expression.indexOf("= UPPER('[value]')",0)>0)
{expr=searchObj[id].expression.replace("= UPPER('[value]')","LIKE UPPER('"+userText+"%')");}
else if(searchObj[id].expression.indexOf("LIKE UPPER('%[value]%')",0)>0)
{expr=searchObj[id].expression.replace("LIKE UPPER('%[value]%')","LIKE UPPER('"+userText+"%')");}
else
{expr=searchObj[id].expression.replace("= [value]","<> -1");}
var outfield=searchObj[id].searchfield;usingCounty=false;if(searchObj[id].fields.indexOf("COUNTYNAME")>-1){outfield=searchObj[id].searchfield+",COUNTYNAME";usingCounty=true;}
if(attr=="GMUs"&&(searchObj[attr].displayfields=="Mountain Goat GMU"||searchObj[attr].displayfields=="Bighorn Sheep GMU")){outfield+=",HUNTING";}
esriRequest({url:searchObj[id].url+"/query",content:{where:expr,returnGeometry:false,outFields:outfield,f:"json",returnDistinctValues:true,orderByFields:searchObj[id].searchfield},handleAs:'json'}).then(function(response){try{var dataArr=[];for(var i=0;i<response.features.length;i++){if(attr=="GMUs"&&(searchObj[attr].displayfields=="Mountain Goat GMU"||searchObj[attr].displayfields=="Bighorn Sheep GMU")){if(response.features[i].attributes["HUNTING"]!="YES")continue;}
var obj={};if(response.features[i].attributes["COUNTYNAME"])obj[searchObj[attr].searchfield]=response.features[i].attributes[searchObj[attr].searchfield]+" ("+
response.features[i].attributes["COUNTYNAME"]+")";else
obj[searchObj[attr].searchfield]=response.features[i].attributes[searchObj[attr].searchfield];obj["value"]=response.features[i].attributes[searchObj[attr].searchfield];dataArr.push(obj);}
if(attr=="GMUs"&&(searchObj[attr].displayfields=="Mountain Goat GMU"||searchObj[attr].displayfields=="Bighorn Sheep GMU")){var result=[];var letter="S";if(searchObj[attr].displayfields=="Mountain Goat GMU")letter="G";dataArr.forEach(function(item){if(item[searchObj[attr].searchfield]!="OUT")
result.push(item[searchObj[attr].searchfield].substring(1));});result.sort(function(a,b){return a-b});var gmuArr=[];dataArr=null;dataArr=[];var obj;result.forEach(function(item){obj=new Object();obj[searchObj[attr].searchfield]=letter+item;dataArr.push(obj);obj=null;});result=null;gmuArr=null;obj=null;}
else
dataArr.sort(sortArrayOfObj(searchObj[attr].searchfield));var searchTextStore=new Memory({data:dataArr});var searchTextCombo=registry.byId("searchText");searchTextCombo.set("store",searchTextStore);searchTextCombo.set("searchAttr",searchObj[attr].searchfield);dataArr=null;document.getElementById("searchLoadingImg").style.display="none";}
catch(e){alert("Feature Search query error: "+e.message+" in search.js/updateSearchTextStore query response. field="+searchObj[attr].searchfield,"Code Error",e);document.getElementById("searchLoadingImg").style.display="none";}},function(err){document.getElementById("searchLoadingImg").style.display="none";alert("Feature Search query error in javascript/search.js updateSearchTextStore(). Query="+
searchObj[attr].url+"/query?where="+expr+"&outfields="+searchObj[attr].searchfield
+" "+err.message,"Data Error",err);});}
catch(e){document.getElementById("searchLoadingImg").style.display="none";alert("Feature Search error: "+e.message+" in search.js/updateSearchTextStore.","Code Error",e);}}
function fillSearchValues(attr){document.getElementById("searchLoadingImg").style.display="block";var items=searchObj[attr].searchvalues.split(",");var dataArr=[];items.forEach(function(item){var obj={};obj[searchObj[attr].searchfield]=item.trim();dataArr.push(obj);});var searchTextStore=new Memory({data:dataArr});var searchTextCombo=registry.byId("searchText");searchTextCombo.set("store",searchTextStore);searchTextCombo.reset();searchTextCombo.set("searchAttr",searchObj[attr].searchfield);searchTextCombo.set("placeHolder","Select a "+searchObj[id].name);obj=null;dataArr=null;attr=null;items=null;document.getElementById("searchLoadingImg").style.display="none";}
function fillLookupSearchValues(id){document.getElementById("searchLoadingImg").style.display="block";var xmlhttp=createXMLhttpRequest();xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4&&xmlhttp.status===200){var xmlData=createXMLparser(xmlhttp.responseText.substr(xmlhttp.response.indexOf("?>")+2));var elements=xmlData.getElementsByTagName(searchObj[id].lookupfield);var dataArr=[];for(var i=0;i<elements.length;i++){var obj={};obj[searchObj[id].searchfield]=elements[i].childNodes[0].nodeValue;dataArr.push(obj);}
var searchTextStore=new Memory({data:dataArr});var searchTextCombo=registry.byId("searchText");searchTextCombo.set("store",searchTextStore);searchTextCombo.set("searchAttr",searchObj[id].searchfield);searchTextCombo.set("placeHolder","Select a "+searchObj[id].name);dataArr=null;document.getElementById("searchLoadingImg").style.display="none";}
else if(xmlhttp.status===404){alert("File: "+app+"/"+searchObj[id].lookupsearchvalues+" not found.","Data Error");document.getElementById("searchLoadingImg").style.display="none";}
else if(xmlhttp.readyState===4&&xmlhttp.status===500){alert("File: "+app+"/"+searchObj[id].lookupsearchvalues+" not found.","Data Error");document.getElementById("searchLoadingImg").style.display="none";}}
xmlhttp.open("GET",app+"/"+searchObj[id].lookupsearchvalues+"?v="+ndisVer,true);xmlhttp.send(null);}
function setSelection(event){try{if(event){event.stopImmediatePropagation();event.preventDefault();}
if(registry.byId("featureType").attr("displayedValue")=="Township Range"){document.getElementById("searchTwn").blur();document.getElementById("searchRng").blur();}
else
document.getElementById("searchText").blur();document.body.focus();window.scrollTo(0,0);var userTypedTxt;var queryTask,query;if(usingCounty&&registry.byId("searchText").get("value").lastIndexOf(" (")>-1)
userTypedTxt=registry.byId("searchText").get("value").substr(0,registry.byId("searchText").get("value").lastIndexOf(" ("));else
userTypedTxt=registry.byId("searchText").get("value");var attr=registry.byId("featureType").attr("displayedValue");if(userTypedTxt==""&&attr!="Township Range")return;clearSelection();var expr;document.getElementById("searchLoadingImg").style.display="block";if(searchObj[attr].database){document.getElementById("searchLoadingImg").style.display="block";var xmlhttp=createXMLhttpRequest();xmlhttp.open("POST",searchObj[attr].database+"?v="+ndisVer+"&key="+userTypedTxt,true);xmlhttp.send(null);xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState===4&&xmlhttp.status===200){var xmlData=createXMLparser(xmlhttp.responseText.substr(xmlhttp.response.indexOf("?>")+2));var elements=xmlData.getElementsByTagName(searchObj[attr].filename);if(elements.length==0){alert("No features found with that name. Please try again.","Warning");document.getElementById("searchLoadingImg").style.display="none";return;}
expr=searchObj[attr].database_field+" IN (";for(var i=0;i<elements.length;i++){if(i>0)expr+=",";if(searchObj[attr].database_field_type.toUpperCase()=="STRING"){expr+="'"+elements[i].getElementsByTagName(searchObj[attr].database_field)[0].childNodes[0].nodeValue+"'";}
else
{expr+=elements[i].getElementsByTagName(searchObj[attr].database_field)[0].childNodes[0].nodeValue;}}
expr+=")";queryLayer=searchObj[attr].url;queryFields=searchObj[attr].fields;displayNames=searchObj[attr].displayfields.split(",");queryTitleField=searchObj[attr].titlefield;queryLinkField=searchObj[attr].linkfield.split(",");queryLinkText=searchObj[attr].linktext.split(",");queryTask=new QueryTask(searchObj[attr].url);query=new Query();query.where=expr;query.outFields=searchObj[attr].fields.split(",");query.returnGeometry=true;query.outSpatialReference=map.spatialReference;queryTask.execute(query,function(results){recAC=createRecordData(results,registry.byId("featureType").attr("displayedValue"));},function(error){alert("Error in javascript/search.js/setSelect/queryTask.execute "+error.message,"Code Error",error);document.getElementById("searchLoadingImg").style.display="none";});}}
xmlhttp.onerror=function(){alert('There was an error looking up the data from '+searchObj[attr].database+'?key='+userTypedTxt,"Code Error");document.getElementById("searchLoadingImg").style.display="none";}}
else{var queryExpr=searchObj[attr].expression;var expr;if(attr=="Township Range")
{document.getElementById("searchLoadingImg").style.display="block";expr=queryExpr.replace("[value1]",parseInt(document.getElementById("searchTwn").value));if(registry.byId("nsSw").get("value")=="on")
expr=expr.replace("[value2]","N");else
expr=expr.replace("[value2]","S");expr=expr.replace("[value3]",parseInt(document.getElementById("searchRng").value));if(registry.byId("ewSw").get("value")=="on")
expr=expr.replace("[value4]","W");else
expr=expr.replace("[value4]","E");if(registry.byId("searchSec").get("value"))
expr=expr.replace("[value5]",parseInt(registry.byId("searchSec").get("value")));else
{var pos=expr.indexOf("AND SECTION");expr=expr.substring(0,pos);}
if(expr.indexOf("NaN")>-1){alert("You must enter a value for Township and Range.","");document.getElementById("searchLoadingImg").style.display="none";return;}
userTypedTxt=document.getElementById("searchTwn").value;if(registry.byId("nsSw").get("value")=="on")userTypedTxt+="N";else userTypedTxt+="S";userTypedTxt+=document.getElementById("searchRng").value;if(registry.byId("ewSw").get("value")=="on")userTypedTxt+="W";else userTypedTxt+="E";if(registry.byId("searchSec").get("value"))userTypedTxt+=" Sec "+registry.byId("searchSec").get("value");document.getElementById("searchTwn").value="";document.getElementById("searchRng").value="";registry.byId("searchSec").attr("value","");}
else
{if(isNaN(Number(userTypedTxt))&&queryExpr.indexOf("= [value]")!=-1)
{registry.byId("searchText").set("value","");updatedList=false;var msg="Your search for "+userTypedTxt+" failed.  Only numbers are allowed.  Please try again.";alert(msg,"Warning");userTypedTxt="";document.getElementById("searchLoadingImg").style.display="none";return;}
else
{document.getElementById("searchLoadingImg").style.display="block";var quote=/'/g;userTypedTxt=userTypedTxt.replace(quote,"''");if(queryExpr.indexOf("LIKE UPPER('%[value]%')")>0)
queryExpr=queryExpr.replace("LIKE UPPER('%[value]%')","= UPPER('[value]')");if(usingCounty&&registry.byId("searchText").get("value").lastIndexOf(" (")>-1)
expr=queryExpr.replace("[value]",userTypedTxt)+" AND COUNTYNAME = '"+
registry.byId("searchText").get("value").substring(registry.byId("searchText").get("value").lastIndexOf(" (")+2,registry.byId("searchText").get("value").length-1)+"'";else
expr=queryExpr.replace("[value]",userTypedTxt);registry.byId("searchText").set("value","");}}
queryLayer=searchObj[attr].url;queryFields=searchObj[attr].fields;var strDisplayNames=searchObj[attr].displayfields;if(strDisplayNames!=null)
displayNames=searchObj[attr].displayfields.split(",");queryTitleField=searchObj[attr].titlefield;queryLinkField=searchObj[attr].linkfield.split(",");queryLinkText=searchObj[attr].linktext.split(",");if(queryLayer)
{queryTask=new QueryTask(queryLayer);var query=new Query();query.where=expr;var outflds=queryFields.split(",");if(attr=="GMUs"&&(searchObj[attr].displayfields=="Mountain Goat GMU"||searchObj[attr].displayfields=="Bighorn Sheep GMU")){outflds.push("HUNTING");}
query.outFields=outflds;query.returnGeometry=true;query.outSpatialReference=map.spatialReference;queryTask.execute(query,function(featureSet){if(featureSet.features.length==0){alert("No features found with that name. Please try again.","Warning");document.getElementById("searchLoadingImg").style.display="none";return;}
createRecordData(featureSet,registry.byId("featureType").attr("displayedValue"));},function(error){alert("Error in javascript/search.js/setSelect/queryTask.execute, url="+queryLayer+". Where "+expr+". Error message: "+error.message,"Code Error",error);document.getElementById("searchLoadingImg").style.display="none";});}}}
catch(e){alert(e.message+" in javascript/search.js/setSelection","Code Error",e);document.getElementById("searchLoadingImg").style.display="none";}}
function makeLink(data){return data;}
function createRecordData(featureSet,attr){if(attr==fishSpeciesGraphicalName)attr="Fish species";var displayFields=queryFields.split(",");var ave_char_width=6;var width={};for(var j=0;j<displayFields.length;j++)
width[displayFields[j]]=0;recAC=[];graphicAC=null;graphicAC=[];if(!queryTitleField)
queryTitleField=featureSet.displayFieldName;var itemList=[];var index=0;featureSet.features.forEach(function(gra)
{try{var obj=gra.attributes;if(attr!="GMUs"||gmu=="Big Game GMU"||obj["HUNTING"]=="YES"){var value;var title;var point=getGeomCenter(gra);var cols=new Array();var graInfoData={icon:widgetIcon,point:point,geometry:gra.geometry};var infoData={icon:widgetIcon,point:point,geometry:gra.geometry};for(j=0;j<displayNames.length;j++)
{try{value=obj[displayFields[j]].toString();}catch(error){value="";}
if(displayFields[j].toUpperCase()==queryTitleField.toUpperCase())
{graInfoData.title=value;infoData.title=value;}}
recAC.push(infoData);gra.attributes=graInfoData;switch(gra.geometry.type)
{case"point":{gra.symbol=graphicPointSym;break;}
case"polyline":{gra.symbol=graphicLineSym;break;}
case"polygon":{gra.symbol=graphicPointSym;break;}}
graphicsLayer.add(gra);document.getElementById("searchRemoveBtn").style.visibility="visible";graphicAC.push(gra);}
else{featureSet.features=null;}}
catch(e){alert("Error in createRecordData search.js "+e.message,"Code Error",e);document.getElementById("searchLoadingImg").style.display="none";}});if(!featureSet.features){alert("No features found. Please try again.","Warning");document.getElementById("searchLoadingImg").style.display="none";return;}
graphicsLayer.id="searchLayer0";document.getElementById("searchLoadingImg").style.display="none";if(recAC&&recAC.length==1)
{var polyExt=recAC[0].geometry.getExtent();if(polyExt!=null)
{require(["esri/geometry/Extent"],function(Extent){var ext=new Extent({"xmin":polyExt.xmin,"ymin":polyExt.ymin,"xmax":polyExt.xmax,"ymax":polyExt.ymax,"spatialReference":{"wkid":wkid}});map.setExtent(ext,true);});}
else
{map.setScale(zoomScale);map.centerAt(recAC[0].point);}}
else if(displayNames[0]=="Township"){map.setScale(zoomScale);map.centerAt(recAC[0].point);}
else{require(["esri/graphicsUtils"],function(graphicsUtils){map.setExtent(graphicsUtils.graphicsExtent(featureSet.features),true);});}
closeMenu();document.getElementById("searchPane").style.display="none";}
function getGeomCenter(gra){var pt;switch(gra.geometry.type)
{case"point":{pt=new Point(gra.geometry.x,gra.geometry.y,map.spatialReference);break;}
case"polyline":{var pl=gra.geometry;var pathCount=pl.paths.length;var pathIndex=parseInt((pathCount/2)-1);var midPath=new Array();midPath=pl.paths[pathIndex];var ptCount=midPath.length;var ptIndex=parseInt((ptCount/2)-1);pt=pl.getPoint(pathIndex,ptIndex);break;}
case"polygon":{pt=gra.geometry.getCentroid();break;}}
return pt;}
function clearSelection(){graphicsLayer.clear();graphicsHLLayer.clear();document.getElementById("searchRemoveBtn").style.visibility="hidden";}
function clearAndClose(){clearSelection();closeMenu();}
document.getElementById("searchBtn").addEventListener("click",setSelection);document.getElementById("searchRemoveBtn").addEventListener("click",clearAndClose);updateSearchTextStore(featureStore.data[0].name);document.getElementById("searchLabel").innerHTML=searchObj[featureStore.data[0].name].textsearchlabel+" ";}
catch(e){alert("Error in javascript/search.js searchInit. "+e.message,"Code Error",e);document.getElementById("searchLoadingImg").style.display="none";}});}
catch(e){alert("Error in javascript/search.js searchInit. "+e.message,"Code Error",e);document.getElementById("searchLoadingImg").style.display="none";}}
else if(xmlhttp.status===404){alert("Error: Missing config.xml file in "+app+" directory.","Data Error");hideLoading();}
else if(xmlhttp.readyState===4&&xmlhttp.status===500){alert("Make sure your application name is correct on the URL. app="+app,"Warning");hideLoading();}};xmlhttp.open("GET",configFile,true);xmlhttp.send(null);}
catch(e){alert(e.message+" in javascript/search.js trying to read "+app+"/SearchWidget.xml file.","Code Error",e);document.getElementById("searchLoadingImg").style.display="none";}}