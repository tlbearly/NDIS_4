function createMap(){require(["dojo/dom","dijit/registry","dojo/_base/lang","esri/map","esri/dijit/PopupMobile","esri/symbols/SimpleLineSymbol","esri/symbols/SimpleMarkerSymbol","esri/tasks/GeometryService","esri/Color","dojo/dom-construct","esri/SpatialReference","esri/geometry/Extent","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/FeatureLayer"],function(e,r,a,t,i,l,s,n,o,y,p,u,d,m){function c(){try{queryObj.point&&""!=queryObj.point&&(require(["javascript/graphicFuncs"],function(e){e.addPoints(queryObj.point)}),queryObj.hb1298&&""!=queryObj.hb1298&&addHB1298Points(queryObj.hb1298))}catch(e){alert("Error loading way points from the URL. In javascript/addPoints() "+e.message+"\npoints="+queryObj.point,"URL Graphics Error",e)}}function g(){require(["dojo/promise/all","dojo/Deferred","dojo/json"],function(e,r,a){function t(e){0==e.status&&e.abort()}function i(e){var i=new r,l=new XMLHttpRequest;try{l.open("get",e.url+"?f=json");setTimeout(t.bind(null,l),3e3)}catch(r){return console.error(r),i.resolve({layer:e,resolution:!1}),i.promise}return l.onloadend=function(){if(200!==this.status)i.resolve({layer:e,resolution:!1});else{var r=a.parse(this.response);r.error?i.resolve({layer:e,resolution:!1}):i.resolve({layer:e,resolution:!0})}},l.send(),i.promise}for(var l,s=[],n=[],o=w.getElementsByTagName("operationallayers")[0].getElementsByTagName("layer"),y=-1,p=0;p<o.length;p++)n[p]={id:o[p].getAttribute("label"),url:o[p].getAttribute("url")},n[p].id.indexOf("Motor Vehicle")>-1&&(y=p);y>-1&&(l=n.length,n[n.length]={id:"Motor Vehicle Use Map",url:"https://ndismaps.nrel.colostate.edu/ArcGIS/rest/services/mvum/MapServer"}),n.forEach(function(e){s.push(i(e))});var u=new e(s);u.then(function(e){for(var r=!1,a=!1,t=[],i=0;i<e.length;i++)a=e[i].layer.id.indexOf("Motor Vehicle")>-1,e[i].resolution?1==a&&(y==i?e.pop():l==i&&(console.log("Layer loaded: "+e[i].layer.id+" "+e[i].layer.url),e[y].layer.url=e[i].layer.url,e[y].resolution=!0,e.pop(),r=!0,ourMVUM=!0)):(console.log("Layer failed to load: "+e[i].layer.id+" "+e[i].layer.url),-1==e[i].layer.id.indexOf("Motor Vehicle")&&(e[i].layer.id.indexOf("Wildfire")>-1?alert("The external map service that provides "+e[i].layer.id+" is experiencing problems.  This issue is out of CPW control.  We will make the National Interagency Fire Center aware of the issue.  We apologize for any inconvenience.","External (Non-CPW) Map Service Error"):e[i].layer.id.indexOf("BLM")>-1?alert("The external map service that provides "+e[i].layer.id+" is experiencing problems.  This issue is out of CPW control.  We will make the BLM aware of the issue.  We apologize for any inconvenience.","External (Non-CPW) Map Service Error"):alert(e[i].layer.id+" service is busy or not responding. Please try reloading this page.","Data Error"),t.push(e[i].layer.id)));if(t.length>0)for(r=!0,j=0;j<t.length;j++)for(i=0;i<e.length;i++)if(t[j]==e[i].layer.id){e.splice(i,1);break}b(e,r,ourMVUM)})})}function b(r,t,i){function l(e){try{var r,a,t=new Array(0,1,2,3,4,5,6,7,8,9);if(layerObj[e.layer.id]){if(a=[],a=e.layer.layerInfos,"Hunter Reference"==e.layer.id){for(r=0;r<layerObj[e.layer.id].visLayers.length;r++)if(a[layerObj[e.layer.id].visLayers[r]].name.substr(a[layerObj[e.layer.id].visLayers[r]].name.length-3,3).indexOf("GMU")>-1){gmu=a[layerObj[e.layer.id].visLayers[r]].name;break}}else if("Game Species"==e.layer.id)for(r=0;r<layerObj[e.layer.id].visLayers.length;r++){if("Bighorn Sheep"===a[layerObj[e.layer.id].visLayers[r]].name){gmu="Bighorn GMU";break}if("Mountain Goat"===a[layerObj[e.layer.id].visLayers[r]].name){gmu="Goat GMU";break}}if(!i){for(r=0;r<a.length;r++)-1!=layerObj[e.layer.id].visLayers.indexOf(a[r].id)?a[r].defaultVisibility=!0:-1==a[r].parentLayerId||a[r].subLayerIds?a[r].defaultVisibility=!1:a[r].name.substr(a[r].name.length-3,3).indexOf("GMU")>-1||1==a[r].defaultVisibility&&-1===layerObj[e.layer.id].visLayers.indexOf(a[r].parentLayerId)&&(layerObj[e.layer.id].visLayers.push(r),t.indexOf(parseInt(a[a[r].parentLayerId].name.substr(0,1)))>-1&&(layerObj[e.layer.id].visLayers.push(a[r].parentLayerId),a[a[r].parentLayerId].defaultVisibility=!0));e.layer.setVisibleLayers(layerObj[e.layer.id].visLayers.sort(function(e,r){return e-r})),e.layer.refresh()}}if(y=!0,e.layer.visible&&(y=!1),legendLayers.push({layer:e.layer,title:e.layer.id,autoToggle:!0,slider:!0,slider_ticks:3,slider_labels:["transparent","50%","opaque"],hideGroupSublayers:hideGroupSublayers,radioLayers:radioLayers,noLegend:!1,openSubLayers:[],collapsed:y}),mapLayers.push(e.layer),mapLayers.length==w.getElementsByTagName("operationallayers")[0].getElementsByTagName("layer").length){var l=[E.length],s=0;for(r=E.length-1;r>-1;r--)for(n=0;n<E.length;n++)if(legendLayers[n].title===E[r].getAttribute("label")){l[s++]=legendLayers[n];break}legendLayers=l;for(var n=0;n<mapLayers.length;n++)if("Hunter Reference"==mapLayers[n].id&&layerObj["Hunter Reference"]){for(a=null,a=mapLayers[n].layerInfos,r=0;r<a.length;r++)a[r].name.substr(a[r].name.length-3,3).indexOf("GMU")>-1&&(a[r].name==gmu?(-1==layerObj["Hunter Reference"].visLayers.indexOf(r)&&layerObj["Hunter Reference"].visLayers.push(r),a[r].defaultVisibility=!0,t.indexOf(parseInt(a[a[r].parentLayerId].name.substr(0,1)))>-1&&-1==layerObj["Hunter Reference"].visLayers.indexOf(a[r].parentLayerId)&&(layerObj["Hunter Reference"].visLayers.push(a[r].parentLayerId),a[a[r].parentLayerId].defaultVisibility=!0)):a[r].defaultVisibility=!1);mapLayers[n].setVisibleLayers(layerObj["Hunter Reference"].visLayers.sort(function(e,r){return e-r}))}map.addLayers(mapLayers),tocFlag=!0,initTOC()}}catch(e){alert("Error in readConfig.js/layerLoadHandler "+e.message,"Code Error",e)}}try{var s,n,o,y;if(queryObj.layer&&""!=queryObj.layer){var p=queryObj.layer.substring(queryObj.layer.indexOf("|")+1).split(",");for(layerObj={},n=0;n<p.length;n++){var u=p[n].split("|");if(""!=u[0])for(u[0]=u[0].replace(/~/g," "),3==u.length&&u.push(!0),-1==u[2]?layerObj[u[0]]={opacity:u[1],visLayers:[],visible:!0}:layerObj[u[0]]={opacity:u[1],visLayers:u[2].split("-"),visible:"1"==u[3]},o=0;o<layerObj[u[0]].visLayers.length;o++)layerObj[u[0]].visLayers[o]=0|layerObj[u[0]].visLayers[o]}}if(t){var g=[];for(n=0;n<w.getElementsByTagName("operationallayers")[0].getElementsByTagName("layer").length;n++){var b=!1;for(o=0;o<r.length;o++)if(r[o].layer.id==w.getElementsByTagName("operationallayers")[0].getElementsByTagName("layer")[n].getAttribute("label")){b=!0,w.getElementsByTagName("operationallayers")[0].getElementsByTagName("layer")[n].setAttribute("url",r[o].layer.url);break}b||g.push(n)}for(n=g.length-1;n>=0;n--){var f=w.getElementsByTagName("operationallayers")[0].getElementsByTagName("layer")[g[n]];f.parentNode.removeChild(f)}if(i){var h=w.getElementsByTagName("operationallayers")[0].getElementsByTagName("layer")[0],v=w.getElementsByTagName("operationallayers")[0].getElementsByTagName("layer")[w.getElementsByTagName("operationallayers")[0].getElementsByTagName("layer").length-1];v.parentNode.insertBefore(v,h),w.getElementsByTagName("operationallayers")[0].getElementsByTagName("layer")[0].setAttribute("open",!1),w.getElementsByTagName("operationallayers")[0].getElementsByTagName("layer")[0].setAttribute("alpha",.85)}}var j,E=w.getElementsByTagName("operationallayers")[0].getElementsByTagName("layer");for(n=0;n<E.length;n++){loadedFromCfg=!0;var O=E[n].getAttribute("label");if(queryObj.layer&&""!=queryObj.layer){if(E[n].getAttribute("url").toLowerCase().indexOf("mapserver")>-1)s=layerObj[O]?new d(E[n].getAttribute("url"),{opacity:layerObj[O].opacity,id:O,visible:layerObj[O].visible,visibleLayers:layerObj[O].visLayers}):new d(E[n].getAttribute("url"),{opacity:Number(E[n].getAttribute("alpha")),id:O,visible:!1});else{if(!(E[n].getAttribute("url").toLowerCase().indexOf("featureserver")>-1))return void alert("Unknown operational layer type. It must be of type MapServer or FeatureServer. Or edit readConfig.js line 600 to add new type.");s=layerObj[O]?new m(E[n].getAttribute("url"),{opacity:Number(E[n].getAttribute("alpha")),id:O,visible:layerObj[O].visible,visibleLayers:layerObj[O].visLayers}):new m(E[n].getAttribute("url"),{opacity:Number(E[n].getAttribute("alpha")),id:O,visible:!1})}loadedFromCfg=!1,j=E[n].getAttribute("opensublayer"),s.loaded?l({layer:s}):s.on("load",l)}else if(E[n].getAttribute("url").toLowerCase().indexOf("mapserver")>-1)s="false"==E[n].getAttribute("visible")?new d(E[n].getAttribute("url"),{opacity:Number(E[n].getAttribute("alpha")),id:O,visible:!1}):new d(E[n].getAttribute("url"),{opacity:Number(E[n].getAttribute("alpha")),id:O,visible:!0});else{if(!(E[n].getAttribute("url").toLowerCase().indexOf("featureserver")>-1))return void alert("Unknown operational layer type. It must be of type MapServer or FeatureServer. Or edit readConfig.js line 600 to add new type.");s="false"==E[n].getAttribute("visible")?new m(E[n].getAttribute("url"),{opacity:Number(E[n].getAttribute("alpha")),id:O,visible:!1}):new m(E[n].getAttribute("url"),{opacity:Number(E[n].getAttribute("alpha")),id:O,visible:!0})}if(loadedFromCfg){y=!1,"false"==E[n].getAttribute("open")&&(y=!0);var k=[];j=E[n].getAttribute("opensublayer"),j&&(k=j.split(",")),legendLayers.push({layer:s,title:E[n].getAttribute("label"),autoToggle:!0,slider:!0,slider_ticks:3,slider_labels:["transparent","50%","opaque"],hideGroupSublayers:hideGroupSublayers,radioLayers:radioLayers,noLegend:!1,openSubLayers:k,collapsed:y}),mapLayers.push(s),k=null,j=null}}loadedFromCfg&&(map.addLayers(mapLayers),legendLayers.reverse(),tocFlag=!0,initTOC()),c(),L&&map.setLevel(L),require(["dojox/mobile/ListItem"],a.hitch(this,function(r){for(var a=0;a<w.getElementsByTagName("widget").length;a++){var t=w.getElementsByTagName("widget")[a].getAttribute("label"),i=w.getElementsByTagName("widget")[a].getAttribute("icon");if("Feature Search"==t){null==i&&(i="assets/images/i_search.png");var l=i,s=new r({id:"searchLI",icon:l,label:"<a class='mblAccordionTitleAnchor' href=\"javascript:openSearch();\">Feature Search</a><span id='searchRemoveBtn' style='visibility:hidden' class='measureClear'>Clear</span>"});s.placeAt(e.byId("toolsMenu"))}else if("Draw, Label, & Measure"==t){null==i&&(i="assets/images/ptmedblue.png");var n=i,o=new r({id:"wayPtLI",icon:n,label:"<a class='mblAccordionTitleAnchor' href=\"javascript:openWayPts();\">Way Point</a>"});o.placeAt(e.byId("toolsMenu"));var y=new r({icon:"assets/images/i_measure.png",label:'<span id="lengthBtn" class="mblAccordionTitleAnchor">Measure</span><span id="removeLengthBtn" style="visibility:hidden" class="measureClear">Clear</span>'});y.placeAt(e.byId("toolsMenu")),drawInit()}else if("Bookmark"==t){null==i&&(i="assets/images/i_bookmark.png");var p=i,u=new r({icon:p,label:"<a class='mblAccordionTitleAnchor' href=\"javascript:openBookmark();\">Bookmark</a>"});u.placeAt(e.byId("toolsMenu")),require(["javascript/Bookmark"],function(){})}else if("HB1298 Report"==t){null==i&&(i="assets/images/i_bookmark3.png");var d=i,m=new r({id:"showHB1298",icon:d,label:"<a class='mblAccordionTitleAnchor' href=\"javascript:openHB1298();\">HB1298 Report</a>"});m.placeAt(e.byId("toolsMenu"))}else if("Settings"==t){var c=new r({icon:"assets/images/i_link.png",label:"<a class='mblAccordionTitleAnchor' href=\"javascript:openLinks();\">Links</a>"});c.placeAt(e.byId("toolsMenu"))}}})),linkStr='<p class="link"><a href="../'+app+'/help.html" target="help"><img src="assets/images/i_help.png"/>Help</a></p>',linkStr+='<p class="link"><a href="../'+app+'/definitions.html" target="help"><img src="assets/images/i_layers.png"/>Map Descriptions</a></p>';var x=w.getElementsByTagName("links")[0].getElementsByTagName("link"),B="";for(n=0;n<x.length;n++)"Go Mobile"==x[n].getAttribute("label")?linkStr+='<p class="link"><a href="'+window.location.href.replace("indexM","index")+'" target="_top"><img src="'+x[n].getAttribute("icon")+'"/>Load Desktop Site</a></p>':"Buy License!"==x[n].getAttribute("label")?(B=x[n].getAttribute("url").replace("%3F","?").replace("%26","&"),linkStr+='<p class="link"><a id="licenseLink"><img src="'+x[n].getAttribute("icon")+'"/>'+x[n].getAttribute("label")+"</a></p>"):linkStr+='<p class="link"><a href="'+x[n].getAttribute("url").replace("%3F","?").replace("%26","&")+'" target="_new"><img src="'+x[n].getAttribute("icon")+'"/>'+x[n].getAttribute("label")+"</a></p>";linkStr+='<span id="emaillink"></span>',e.byId("links").innerHTML=linkStr,document.getElementById("licenseLink")&&"function"==typeof ga&&document.getElementById("licenseLink").addEventListener("click",function(){ga("send","event","buy_license","click","Buy License","1"),window.open(B,"_new")})}catch(e){alert("Error in readConfig.js/addMapLayers "+e.message,"Code Error",e)}}function f(){h()}function h(){require(["esri/geometry/Extent"],function(e){try{initExtent=new e({xmin:parseFloat(cfgExtent[0]),ymin:parseFloat(cfgExtent[1]),xmax:parseFloat(cfgExtent[2]),ymax:parseFloat(cfgExtent[3]),spatialReference:{wkid:wkid}}),v()}catch(e){alert("Could not read initial extent in "+app+"/config.xml.","Warning")}})}function v(){try{if(mapBasemap="streets",E)return;E=!0;var r=[{level:6,resolution:2445.98490512499,scale:9244648.868618},{level:7,resolution:1222.992452562495,scale:4622324.434309},{level:8,resolution:611.4962262813797,scale:2311162.217155},{level:9,resolution:305.74811314055756,scale:1155581.108577},{level:10,resolution:152.87405657041106,scale:577790.554289},{level:11,resolution:76.43702828507324,scale:288895.277144},{level:12,resolution:38.21851414253662,scale:144447.638572},{level:13,resolution:19.10925707126831,scale:72223.819286},{level:14,resolution:9.554628535634155,scale:36111.909643},{level:15,resolution:4.77731426794937,scale:18055.954822},{level:16,resolution:2.388657133974685,scale:9027.977411},{level:17,resolution:1.1943285668550503,scale:4513.988705},{level:18,resolution:.5971642835598172,scale:2256.994353},{level:19,resolution:.29858214164761665,scale:1128.497176}];if(map=new t(mapDiv,{autoResize:!0,extent:initExtent,showAttribution:!1,logo:!1,basemap:"streets",sliderStyle:"small",infoWindow:infoWindowPopup,minScale:9244649,lods:r}),previewMap=new t("printPreviewMap",{extent:initExtent,autoResize:!0,showAttribution:!1,logo:!1,basemap:"streets",sliderStyle:"small",minScale:9244649,navigationMode:"classic",isPan:!1,isClickRecenter:!0,showInfoWindowOnClick:!1,lods:r}),document.getElementById("LocateButton").addEventListener("click",init_geo),queryObj.layer&&"streets"!=queryObj.layer.substring(0,queryObj.layer.indexOf("|")).split(",")[0]){if(queryObj.layer&&""!=queryObj.layer){var a=queryObj.layer.substring(0,queryObj.layer.indexOf("|")).split(",");0==a[0]?mapBasemap="streets":1==a[0]?mapBasemap="hybrid":2==a[0]?mapBasemap="topo":mapBasemap=a[0],a=null}basemapFlag=!0,initBasemaps()}if(map.on("layers-add-result",function(e){try{for(var r=0;r<e.layers.length;r++)if(e.layers[r].error)!0,alert("Problem loading layer: "+e.layers[r].layer.url+". "+e.layers[r].error.message+". At javascript/readConfig.js");else if(e.layers[r].layer.url.indexOf("MVUM")>-1)for(j=0;j<e.layers[r].layer.layerInfos.length;j++)"Visitor Map Symbology"==e.layers[r].layer.layerInfos[j].name?e.layers[r].layer.layerInfos[j].defaultVisibility=!1:"Status"==e.layers[r].layer.layerInfos[j].name&&(e.layers[r].layer.layerInfos[j].defaultVisibility=!1)}catch(e){alert("Error loading Map Layers: "+e.message+" in javascript/readConfig.js")}}),map.on("load",function(){try{readSettingsWidget(),map.on("click",doIdentify),-1!=navigator.userAgent.indexOf("Android")&&dojo.connect(e.byId("mapDiv_layers"),"click",function(e){var r;e.target?r=e.target:e.srcElement&&(r=e.srcElement),3==r.nodeType&&(r=r.parentNode),-1!=r.id.indexOf("map")&&map.onClick(e)}),g(),queryObj.extent||queryObj.place||queryObj.keyword||queryObj.map||!navigator.geolocation||init_geo(),O&&queryObj.label&&""!=queryObj.label&&require(["esri/geometry/Point","esri/graphicsUtils","esri/geometry/Extent","esri/layers/GraphicsLayer","esri/graphic","esri/symbols/PictureMarkerSymbol"],function(e,r,a,t,i,l){var s=new t;s.id="searchgraphics"+searchGraphicsCounter,searchGraphicsCount.push(s.id),searchGraphicsCounter++,addLabel(new i(O),queryObj.label,s,"11pt");var n=new l("assets/images/yellowdot.png",30,30);s.add(new i(O,n)),document.getElementById("findClear").style.opacity=1,document.getElementById("findClear").style.filter="alpha(opacity=100)"})}catch(e){alert("Could not load map. "+e.message,"Warning",e)}}),queryObj.keyword&&""!=queryObj.keyword)queryObj.value&&""!=queryObj.value?require(["esri/request","esri/tasks/QueryTask","esri/tasks/query"],function(e,r,a){var t=app+"/url.xml?v="+ndisVer,i=createXMLhttpRequest();i.onreadystatechange=function(){if(4==i.readyState&&200===i.status){for(var e=createXMLdoc(i),t=e.getElementsByTagName("layer"),l=0;l<t.length&&(t[l].getElementsByTagName("keyword")[0]&&t[l].getElementsByTagName("keyword")[0].firstChild||(alert("Missing tag keyword or blank, in "+app+"/url.xml file.","Data Error"),h()),queryObj.keyword!=t[l].getElementsByTagName("keyword")[0].firstChild.nodeValue);l++);if(l==t.length)alert("Keyword ["+queryObj.keyword+"] is not defined in "+app+"/url.xml file.","Data Error"),h();else if(t[l].getElementsByTagName("url")[0]&&t[l].getElementsByTagName("url")[0].firstChild)if(t[l].getElementsByTagName("expression")[0]&&t[l].getElementsByTagName("expression")[0].firstChild){var s=t[l].getElementsByTagName("expression")[0].firstChild.nodeValue.replace("[value]",queryObj.value),n=new r(t[l].getElementsByTagName("url")[0].firstChild.nodeValue),o=new a;o.where=s,o.returnGeometry=!0,n.execute(o,function(e){0==e.features.length?gotoLocation(queryObj.value,!0):require(["esri/geometry/Point","esri/graphicsUtils","esri/geometry/Extent","esri/layers/GraphicsLayer","esri/graphic","esri/symbols/PictureMarkerSymbol"],function(r,a,i,s,n,o){var y;if("esriGeometryPoint"==e.geometryType){L=8,t[l].getElementsByTagName("mapscale")[0]&&t[l].getElementsByTagName("mapscale")[0].firstChild&&(L=parseInt(t[l].getElementsByTagName("mapscale")[0].firstChild.nodeValue)),L>11&&(alert("Illegal mapscale value, "+L+", in "+app+"/url.xml file for keyword: "+queryObj.keyword+". Must be less than 20. It is now a map level instead of map scale.","Data Error"),L=8);var p=2e3;if(initExtent=new i(e.features[0].geometry.x-p,e.features[0].geometry.y-p,e.features[0].geometry.x+p,e.features[0].geometry.y+p,e.spatialReference),O=new r(e.features[0].geometry.x,e.features[0].geometry.y,e.spatialReference),queryObj.label&&""!=queryObj.label){y=new s,y.id="searchgraphics"+searchGraphicsCounter,searchGraphicsCount.push(y.id),searchGraphicsCounter++,addLabel(new n(O),queryObj.label,y,"11pt");var u=new o("assets/images/yellowdot.png",30,30);y.add(new n(O,u)),document.getElementById("findClear").style.opacity=1,document.getElementById("findClear").style.filter="alpha(opacity=100)"}}else{var d=!1;if(t[l].getElementsByTagName("union")[0]&&t[l].getElementsByTagName("union")[0].firstChild&&"true"===t[l].getElementsByTagName("union")[0].firstChild.nodeValue.toLowerCase()&&(d=!0),d){for(var m=new i(e.features[0].geometry.getExtent()),c=0;c<e.features.length;c++){var g=e.features[c].geometry.getExtent();m=m.union(g)}initExtent=m,O=m.getCenter()}else O=e.features[0].geometry.getCentroid(),initExtent=e.features[0].geometry.getExtent();queryObj.label&&""!=queryObj.label&&(y=new s,y.id="searchgraphics"+searchGraphicsCounter,searchGraphicsCount.push(y.id),searchGraphicsCounter++,addLabel(new n(O),queryObj.label,y,"11pt"),document.getElementById("findClear").style.opacity=1,document.getElementById("findClear").style.filter="alpha(opacity=100)")}map.setExtent(initExtent,!0)})},function(e){e.responseText?alert("Error: QueryTask failed for keyword="+queryObj.keyword+" value="+queryObj.value+" "+e.message+e.responseText,"URL Keyword/Value Error",e):alert("Error: QueryTask failed for keyword="+queryObj.keyword+" value="+queryObj.value+" "+e.message,"URL Keyword/Value Error",e),h()})}else alert("Missing tag expression, in "+app+"/url.xml file for keyword: "+queryObj.keyword,"Data Error"),h();else alert("Missing tag url or blank, in "+app+"/url.xml file for keyword: "+queryObj.keyword+".","Data Error"),h()}else 404===i.status?(alert("Missing url.xml file in "+app+" directory.","Data Error"),h()):4===i.readyState&&500===i.status&&(alert("Error: had trouble reading "+app+"/url.xml file in readConfig.js.","Data Error"),h())},i.open("GET",t,!0),i.send(null)}):(alert("When &keyword is used on the URL, there must be a &value also.","URL Keyword/Value Error"),h());else if(queryObj.place&&""!=queryObj.place){var i=queryObj.place.replace("%20"," ");queryObj.prj&&""!=queryObj.prj&&(settings={XYProjection:queryObj.prj}),gotoLocation(i,!0)}else queryObj.map&&""!=queryObj.map&&(queryObj.value&&""!=queryObj.value&&queryObj.field&&""!=queryObj.field?require(["esri/request","esri/tasks/QueryTask","esri/tasks/query"],function(e,r,a){var t=new r(queryObj.map),i=new a;Number(queryObj.value)?i.where=queryObj.field+"="+queryObj.value:i.where="UPPER("+queryObj.field+") LIKE UPPER('"+queryObj.value+"')",i.returnGeometry=!0,t.execute(i,function(e){require(["esri/geometry/Point","esri/graphicsUtils","esri/geometry/Extent"],function(r,a,t){if(0==e.features.length)alert("Cannot zoom to "+queryObj.value+". The feature was not found in "+queryObj.map+" for field "+queryObj.field,"URL Map/Value Error"),h();else{if("esriGeometryPoint"==e.geometryType){var i=65e3;initExtent=new t(e.features[0].geometry.x-i,e.features[0].geometry.y-i,e.features[0].geometry.x+i,e.features[0].geometry.y+i,e.spatialReference)}else initExtent=e.features[0].geometry.getExtent();map.setExtent(initExtent,!0)}})},function(e){e.responseText?alert("Error: QueryTask failed for map="+queryObj.map+" "+e.message+e.responseText,"URL Map/Value Error",e):alert("Error: QueryTask failed for map="+queryObj.map+" "+e.message,"URL Map/Value Error",e),h()})}):(alert("When &map is used on the URL, there must also be an &field and &value.","URL Map/Value Error"),h()))}catch(e){alert("Could not load map. "+e.message,"Warning",e)}}var w,E=!1,L=null,O=null,k=new l(l.STYLE_SOLID,new o([38,38,38,.7]),2),x=new s;x.setPath("M21.5,21.5h-18v-18h18V21.5z M12.5,3V0 M12.5,25v-3 M25,12.5h-3M3,12.5H0"),x.setSize(45),x.setOutline(k),infoWindowPopup=new i({markerSymbol:x},y.create("div"));var B=createXMLhttpRequest(),T=app+"/config.xml?v="+ndisVer;B.onreadystatechange=function(){if(4==B.readyState&&200==B.status){w=createXMLdoc(B);try{var e;try{e=w.getElementsByTagName("geometryservice")[0].getAttribute("url")}catch(r){alert('Missing tag: geometryservice in config.xml.\n\nTag should look like: &lt;geometryservice url="https://ndismaps.nrel.colostate.edu/ArcGIS/rest/services/Utilities/Geometry/GeometryServer"/&gt;\n\nWill use that url for now.',"Error in "+app+"/config.xml"),e="https://ndismaps.nrel.colostate.edu/ArcGIS/rest/services/Utilities/Geometry/GeometryServer"}geometryService=new n(e),geometryService2=new n(e);try{printGeoServiceUrl=w.getElementsByTagName("printservicegeo")[0].firstChild.nodeValue}catch(e){alert("Missing tag: printservicegeo in "+app+"/config.xml.\n\nTag should look like: &lt;printservicegeo&gt;https://ndismaps.nrel.colostate.edu/arcgis/rest/services/PrintTemplate/georefPrinting/GPServer/georefPrinting&lt;/printservice&gt;\n\nWill use that url for now.","Data Error"),printGeoServiceUrl="https://ndismaps.nrel.colostate.edu/arcgis/rest/services/PrintTemplate/georefPrinting/GPServer/georefPrinting"}var a,t,i=app;try{i=w.getElementsByTagName("mobile_title")[0]?w.getElementsByTagName("mobile_title")[0].firstChild.nodeValue:w.getElementsByTagName("title")[0].firstChild.nodeValue.replace("Colorado","CO")}catch(e){alert("Error in "+app+"/config.xml file. Missing tag: title.","Data Error")}1!=getCookie("noDisclaimer")&&loadDisclaimer(i);try{a=w.getElementsByTagName("logo")[0].firstChild.nodeValue}catch(e){alert("Error in "+app+"/config.xml file. Missing tag: logo.","Data Error")}try{t=w.getElementsByTagName("logourl")[0].firstChild.nodeValue}catch(e){alert("Error in "+app+"/config.xml file. Missing tag: logourl.","Data Error")}r.byId("webmapTitle").set("label","<a href='"+t+"'><img width='40px' src='../"+a+"' style='top: -3px;position: relative;vertical-align: middle;'/></a> "+i),document.title=i;try{w.getElementsByTagName("hideGroupSublayers")[0]&&w.getElementsByTagName("hideGroupSublayers")[0].firstChild&&(hideGroupSublayers=w.getElementsByTagName("hideGroupSublayers")[0].firstChild.nodeValue.split(","))}catch(e){alert("Warning: Missing hideGroupSublayers tag in "+app+"/config.xml file. "+e.message,"Data Error")}try{w.getElementsByTagName("radiolayers")[0]&&w.getElementsByTagName("radiolayers")[0].firstChild&&(radioLayers=w.getElementsByTagName("radiolayers")[0].firstChild.nodeValue.split(","))}catch(e){alert("Warning: Missing radiolayers tag in "+app+"/config.xml file. "+e.message,"Data Error")}try{myFindService=w.getElementsByTagName("findplaceservice")[0].getAttribute("url")}catch(e){alert("Missing tag: findplaceservice in "+app+'/config.xml.\n\nTag should look like: &lt;findplaceservice url="https://ndismaps.nrel.colostate.edu/ArcGIS/rest/services/GNIS_Loc/GeocodeServer"/&gt;\n\nWill use that url for now.',"Data Error"),myFindService="https://ndismaps.nrel.colostate.edu/ArcGIS/rest/services/GNIS_Loc/GeocodeServer"}try{findPlaceInit()}catch(e){alert("Error in javascript/readConfig.js "+e.message,"Code Error",e)}try{printInit()}catch(e){alert("Error in javascript/readConfig.js "+e.message,"Code Error",e)}wkid=parseInt(w.getElementsByTagName("map")[0].getAttribute("wkid").trim()),cfgExtent=w.getElementsByTagName("map")[0].getAttribute("initialextent").split(" "),fullExtent=new u({xmin:parseFloat(cfgExtent[0]),ymin:parseFloat(cfgExtent[1]),xmax:parseFloat(cfgExtent[2]),ymax:parseFloat(cfgExtent[3]),spatialReference:{wkid:wkid}}),queryObj.extent&&""!=queryObj.extent?require(["esri/geometry/Extent","esri/tasks/ProjectParameters","esri/SpatialReference"],function(e,r,a){try{var t,i=[];i="[object Array]"===Object.prototype.toString.call(queryObj.extent)?queryObj.extent[0].split(","):queryObj.extent.split(","),t=queryObj.prj&&""!=queryObj.prj?queryObj.prj:i[0]<0&&i[0]>-200?4326:26913;var l=new e({xmin:parseFloat(i[0]),ymin:parseFloat(i[1]),xmax:parseFloat(i[2]),ymax:parseFloat(i[3]),spatialReference:{wkid:parseInt(t)}}),s=new r;s.geometries=[l],s.outSR=new a(wkid),geometryService.project(s,function(e){initExtent=e[0],v()},function(e){alert("There was a problem converting the extent read from the URL to Web Mercator projection. extent="+i[0],", "+i[1]+", "+i[2]+", "+i[3]+"  prj="+t+"  "+e.message,"URL Extent Error",e),h()})}catch(e){alert("Could not zoom to given extent.","Warning"),h()}}):f()}catch(e){alert("Missing tag attributes initalextent or wkid for the map tag in "+app+"/config.xml file. Error message: "+e.message,"Data Error")}}else 404===B.status?(alert("Error: Missing "+app+"/config.xml file.","Data Error"),hideLoading()):4===B.readyState&&500===B.status&&(alert("Make sure your application name is correct on the URL. app="+app,"Warning"),hideLoading())},B.open("GET",T,!0),B.send()})}function openBookmark(){bmCreated?slideRight(document.getElementById("bookmarkPane")):(showLoading(),require(["dojox/mobile/ContentPane","dojo/dom","dojo/dom-construct","javascript/Bookmark","javascript/HelpWin","dojox/mobile/SimpleDialog","dojox/mobile/Heading","dojox/mobile/ToolBarButton"],function(e,r,a,t,i,l,s,n){new e({id:"bookmarkPane",class:"scrollPane",content:'<h1 data-dojo-type=\'dojox/mobile/Heading\' data-dojo-props=\'fixed:"top", label:"Bookmark"\' style="background-color: whitesmoke;color:rgb(191, 197, 203);background-image: none;"><span data-dojo-type="dojox/mobile/ToolBarButton" data-dojo-props=\'icon:"assets/images/leftarrow.png"\' onclick="slideLeft(document.getElementById(\'bookmarkPane\'));"></span><span data-dojo-type="dojox/mobile/ToolBarButton"  alt=\'help button\' style=\'float:right;\' data-dojo-props=\'icon:"assets/images/helpBtn.png"\' onclick="bmHelp.show()"></span>'+"</h1><p id='bmLoading' align='center' style='margin-top: 50px;'><img src='assets/images/loading.gif'/></p>"}).placeAt(document.body).startup();bmCreated=!0,slideRight(document.getElementById("bookmarkPane"));new e({id:"bm",class:"scrollContent",style:"padding-bottom:0px;"}).placeAt("bookmarkPane").startup();var o=new t({video:"",preload:!0});o.placeAt("bm"),document.getElementById("bmLoading").style.display="none",hideLoading(),bmHelp=new i({label:"Bookmark Help",content:o.defaultHelp}),document.body.appendChild(bmHelp.domNode),bmHelp.startup()}))}function initBasemaps(){require(["esri/dijit/BasemapGallery","esri/dijit/Basemap","esri/dijit/BasemapLayer","esri/dijit/Gallery","javascript/HelpWin"],function(e,r,a,t,l){document.getElementById("basemapLoading").style.display="block";var s,n=[];s=new a({url:"https://services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer"});var o=new r({layers:[s],title:"Streets",id:"streets",thumbnailUrl:"https://www.arcgis.com/sharing/rest/content/items/f81bc478e12c4f1691d0d7ab6361f5a6/info/thumbnail/street_thumb_b2wm.jpg"});n.push(o),layers=[];var y=new a({url:"https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer"});layers.push(y),y=new a({styleUrl:"https://www.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",type:"VectorTileLayer",opacity:1}),layers.push(y),o=new r({layers:layers,title:"Aerial Photo",id:"hybrid",thumbnailUrl:"https://www.arcgis.com/sharing/rest/content/items/2ea9c9cf54cb494187b03a5057d1a830/info/thumbnail/Jhbrid_thumb_b2.jpg"}),n.push(o),s=new a({url:"https://services.arcgisonline.com/ArcGIS/rest/services/USA_Topo_Maps/MapServer"}),o=new r({layers:[s],title:"USGS Scanned Topo",id:"topo",thumbnailUrl:"assets/images/USA_topo.png"}),n.push(o),s=new a({url:"https://basemap.nationalmap.gov/arcgis/rest/services/USGSTopo/MapServer"}),o=new r({layers:[s],title:"USGS Digital Topo",id:"natgeo",thumbnailUrl:"https://usfs.maps.arcgis.com/sharing/rest/content/items/6d9fa6d159ae4a1f80b9e296ed300767/info/thumbnail/thumbnail.jpeg"}),n.push(o),layers=[],s=new a({url:"https://basemap.nationalmap.gov/arcgis/rest/services/USGSImageryTopo/MapServer",displayLevels:[6,7,8,9,10,11,12,13,14,15,16]}),layers.push(s),s=new a({url:"https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",displayLevels:[17,18,19]}),layers.push(s),o=new r({layers:layers,title:"Aerial Photo with USGS Contours",id:"imagery_topo",thumbnailUrl:"assets/images/aerial_topo.png"}),n.push(o),s=new a({url:"https://services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer"}),o=new r({layers:[s],title:"ESRI Digital Topo",id:"topo2",thumbnailUrl:"https://www.arcgis.com/sharing/rest/content/items/588f0e0acc514c11bc7c898fed9fc651/info/thumbnail/topo_thumb_b2wm.jpg"}),n.push(o),basemapGallery=new e({map:map,basemaps:n,id:"basemapGallery",showArcGISBasemaps:!1});var p=[];basemapGallery.basemaps.forEach(function(e){p.push({thumbnailUrl:e.thumbnailUrl,id:e.id,layers:e.layers,title:e.title})});var u={};u.items=p,u.thumbnailStyle="small";var d,m=new t(u,"galleryDiv");for(i=0;i<p.length;i++)if(p[i].id==mapBasemap){d=i;break}m.select(u.items[d]),"streets"!=mapBasemap&&basemapGallery.select(p[d].id),m.on("select",function(e){basemapGallery.select(e.item.id),document.getElementById("basemapPane").style.display="none",closeMenu(),mapBasemap=e.item.id}),m.startup(),m._slideDiv.style.width="auto",document.getElementById("basemapLoading").style.display="none",basemapHelp=new l({label:"Basemaps Help",content:"Click on an image to set the basemap or background map. The selected basemap is highlighted in orange.<br/><br/>"}),document.body.appendChild(basemapHelp.domNode),basemapHelp.startup()})}function initTOC(){require(["agsjs/dijit/TOC","javascript/HelpWin"],function(e,r){try{document.getElementById("tocLoading").style.display="block";var a=new e({map:map,layerInfos:legendLayers},"tocDiv");a.startup(),
a.on("load",function(){document.getElementById("tocLoading").style.display="none"}),tocHelp=new r({label:"Layers &amp; Legend  Help",content:"Set what maps are visible. Place a check mark in the box beside the maps you would like to make visible. Note that if the group's checkbox is unchecked then no layers in this group will be visible. If the map name is greyed out, then it is not visible at this map scale.  To see a greyed out map, zoom in or out on the main map. To adjust the transparency of the grouped map layers, use the slider bar. Grouped layers will collapse, hiding their content, when unchecked.<br/><br/>"}),document.body.appendChild(tocHelp.domNode),tocHelp.startup()}catch(e){alert("Problem loading TOC: "+e.message+" in javascript/readConfig.js or toc/src/agsjs/dijit/TOC.js","Code Error")}})}var cfgExtent,geoLocate,geoLocateZoomIn=!0,bmCreated=!1,bmHelp=null,basemapHelp=null,tocHelp=null;