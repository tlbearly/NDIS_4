function printInit(){var e=createXMLhttpRequest(),t=app+"/PrintPdfWidget.xml?v="+ndisVer;e.onreadystatechange=function(){if(4===e.readyState&&200===e.status){var t=createXMLdoc(e);t.getElementsByTagName("disclaimer")[0]?prtDisclaimer=t.getElementsByTagName("disclaimer")[0].firstChild.nodeValue:alert("Missing tag, disclaimer, in "+app+"/PrintPdfWidget.xml file.","Data Error"),t.getElementsByTagName("helpvideo")[0]&&(document.getElementById("printVideo").innerHTML="<a target='help' href="+t.getElementsByTagName("helpvideo")[0].firstChild.nodeValue+">Click here to view help video.</a><br/><br/>")}else 404===e.status?(alert("Error: Missing PrintPdfWidget.aspx file in "+app+" directory.","Data Error"),hideLoading()):4===e.readyState&&500===e.status&&(alert("Missing PrintPdfWidget.aspx file. app="+app,"Data Error"),hideLoading())},e.open("GET",t,!0),e.send()}function grayOutLegend(e){require(["dojo/dom"],function(t){document.getElementById("printMapLink").innerHTML="",document.getElementById("printLegendLink").innerHTML="","geopdf"!=e.value&&"pdf"!=e.value&&t.byId("printLegend")?t.byId("printLegendCB").style.display="none":t.byId("printLegendCB").style.display="inline-block"})}function printMap(){require(["esri/rest/print","esri/rest/support/PrintTemplate","esri/rest/support/PrintParameters","esri/Graphic","esri/geometry/Point","esri/rest/support/LegendLayer","esri/layers/GraphicsLayer","dojo/dom","dijit/registry"],function(e,t,n,i,r,a,s,l,d){function o(e){var t,n,i=l.byId("format"),r=Date.now()-startTim,a=view.scale;a<9028?n="10k":a<36112?n="24k":a<72224?n="50k":a<144448?n="100k":a<288896?n="250k":a<577791?n="500k":a<1155582?n="1M":a<2311163?n="2M":a<4622325?n="4M":a<9244649&&(n="9M");var s=i.options[i.selectedIndex].value,o=l.byId("size").options[l.byId("size").selectedIndex].innerHTML+" "+s+" ";I&&document.getElementById("printLegend").checked&&(o+="legend ");var p=l.byId("size").options[l.byId("size").selectedIndex].innerHTML,y=Math.floor(r/1e3),m="";for(t=0;t<map.layers.items.length;t++)switch(map.layers.items[t]){case"Motor Vehicle Use Map":m+="M";break;case"Hunter Reference":m+="R";break;case"Game Species":m+="G";break;case"Fishing Info":m+="F";break;case"Reference":m+="R"}if(o+=m,console.log("Time to create map = "+y+" seconds for "+o+" "+n),"function"==typeof gtag&&gtag("event","print",{seconds:y,page_size:p,map_services:m,map_scale:n,map_type:s,basemap:mapBasemap}),"function"==typeof ga){var u="Print ";switch(s){case"pdf":u+="PDF";break;case"geopdf":u+="geoPDF";break;case"jpg":u+="JPG";break;case"geotiff":u+="geoTIFF";break;case"gif":u+="GIF"}var f={metric1:y,dimension2:p,dimension3:m,dimension4:n,dimension5:s},b=l.byId("size").options[l.byId("size").selectedIndex].innerHTML;ga("send","event",o,b,u,y,f)}if(console.log("printing to "+e.url),e.url.indexOf("tif")>-1||e.url.indexOf("svgz")>-1)document.getElementById("printMapLink").innerHTML="<a href='"+e.url+"' title='exported map file' target='_blank'> map."+S.format.toLowerCase()+"</a>";else{try{window.open(e.url,"_blank")}catch(e){console.log("Can't open printout in new window. Use link provided.")}document.getElementById("printMapLink").innerHTML="<a href='"+e.url+"' title='exported map file' target='_blank'><span class='esri-icon-launch-link-external'></span> map."+S.format.toLowerCase()+"</a>"}for(t=0;t<c;t++)removeDrawItem();g&&(d.byId("print_button").set("label","Print"),document.getElementById("printLoading").style.display="none"),g=!0}function p(e){d.byId("print_button").set("label","Print"),document.getElementById("printLoading").style.display="none",alert("Error printing with basemap, "+mapBasemap+". Error Code: "+e,"Code Error",e),document.getElementById("printMapLink").innerHTML="",document.getElementById("printLegendLink").innerHTML="";for(var t=0;t<c;t++)removeDrawItem()}function y(e){console.log("printing legend to "+e.url);try{window.open(e.url,"_blank")}catch(e){console.log("Can't open printout in new window. Use link provided.")}g&&(d.byId("print_button").set("label","Print"),document.getElementById("printLoading").style.display="none"),document.getElementById("printLegendLink").innerHTML="<a href='"+e.url+"' target='_blank'><span class='esri-icon-launch-link-external'></span> legend."+S.format.toLowerCase()+"</a>",g=!0}function m(e){d.byId("print_button").set("label","Print"),document.getElementById("printLoading").style.display="none",document.getElementById("printLegendLink").innerHTML="",document.getElementById("printMapLink").innerHTML="",e.details?alert("Error printing the legend: "+e+e.details,"Code Error"):alert("Error printing the legend","Code Error")}var u,c=0,g=!1,I="inline-block"==l.byId("printLegendCB").style.display;I||(g=!0),d.byId("print_button").set("label","Creating..."),document.getElementById("printLoading").style.display="inline-block",document.getElementById("printMapLink").innerHTML="",document.getElementById("printLegendLink").innerHTML="";var f,b,L,h,v,E=map.layers.items,k=[],x=0;for(u=0;u<E.length;u++)if(E[u].visible&&"topo"!=E[u].id&&"streets"!=E[u].id&&"hybrid"!=E[u].id){if(E[u].id.indexOf("drawgraphics")>0){if(E[u].graphics.length>1&&"point"==E[u].graphics[0].geometry.type&&!E[u].graphics[0].symbol.text){c++;var T=new r(E[u].graphics[0].geometry.x,E[u].graphics[0].geometry.y,map.spatialReference),w=new i(T),B=new s;B.id="drawgraphics"+drawGraphicsCounter,drawGraphicsCount.push(B.id),drawGraphicsCounter++,addLabel(w,E[u].graphics[1].symbol.text,B,"11pt")}continue}if(E[u].sublayers||E[u].layers){f=new a({title:E[u].title,layerId:E[u].title,subLayerIds:[]});var M,P,C,H,_=E[u];for(M=_.sublayers?_.sublayers.items:_.layers.items,b=0;b<M.length;b++)if(M[b].visible)if(M[b].sublayers||M[b].layers){for(M[b].sublayers?P=M[b].sublayers.items:M[b].layers&&(P=M[b].layers.items),L=0;L<P.length;L++)if(P[L].visible)if(P[L].sublayers||P[L].layers){for(P[L].sublayers?C=P[L].sublayers.items:P[L].layers&&(C=P[L].layers.items),h=0;h<C.length;h++)if(C[h].visible)if(C[h].sublayers||C[h].layers)for(H=C[h].sublayers?C[h].sublayers.items:C[h].layers.items,v=0;v<H.length;v++)H[v].visible&&(H[v].sublayers||H[v].layers?alert("add one more group layer traversal in print.js to handle nested groups."):H[v].layerId?(f.title=H[v].title,f.layerId=H[v].layerId,f.subLayerIds.push(H[v].layerId)):f.subLayerIds.push(H[v].id));else C[h].layerId?f.subLayerIds.push(C[h].layerId):f.subLayerIds.push(C[h].id)}else P[L].layerId?f.subLayerIds.push(P[L].layerId):f.subLayerIds.push(P[L].id)}else M[b].layerId?f.subLayerIds.push(M[b].layerId):f.subLayerIds.push(M[b].id);k.push(f),f=null,x++}else f=new a({title:E[u].title,layerId:E[u].id,subLayerIds:[]}),E[u].layerId&&(f.layerId=E[u].layerId),k.push(f),f=null,x++}var D=new n,S=new t,G=l.byId("orient"),O=l.byId("format");index=G.selectedIndex;var F=G.options[index].value,z=l.byId("size");index=z.selectedIndex;var W=z.options[index].value;if(S.exportOptions={dpi:dpi},"pdf"!=O.options[O.selectedIndex].value){var N;if(S.layout=app+" "+W+F,S.preserveScale=!0,g=!0,S.format=O.options[O.selectedIndex].value,"geopdf"!=S.format)N="none",S.exportOptions={dpi:dpi,width:parseInt(inchesWidth*dpi),height:parseInt(inchesHeight*dpi)};else if("geopdf"!=S.format||document.getElementById("printLegend").checked)N="Legend Letter "+F,S.format="pdf";else if(N="none",S.format="pdf",0==x)return alert("Printing of basemaps alone does not work. Please add map layers. From the menu, select 'Map Layers & Legend.'","Warning"),d.byId("print_button").set("label","Print"),document.getElementById("printLoading").style.display="none",document.getElementById("printMapLink").innerHTML="",void(document.getElementById("printLegendLink").innerHTML="");D.extraParameters={Georef_Info:"True",Legend_Template:N}}else I&&!document.getElementById("printLegend").checked&&(g=!0),S.preserveScale=!0,S.format=O.options[O.selectedIndex].value.toUpperCase(),W.indexOf("Letter")>-1?S.layout=W+"ANSI A "+F:S.layout=W+"ANSI B "+F;S.showAttribution=!1;var R=document.getElementById("printTitle").value;if("geopdf"==O.options[O.selectedIndex].value&&(R+=" (Geo PDF)"),I&&document.getElementById("printLegend").checked?S.layoutOptions={titleText:R,authorText:prtDisclaimer,legendLayers:k,customTextElements:[{Subtitle:document.getElementById("printSubTitle").value},{Legend:k}]}:S.layoutOptions={titleText:R,authorText:prtDisclaimer,legendLayers:[],customTextElements:[{Subtitle:document.getElementById("printSubTitle").value}]},R=null,D.view=view,D.template=S,e.execute(printServiceUrl,D).then(o).catch(p),startTim=Date.now(),"pdf"==O.options[O.selectedIndex].value&&I&&document.getElementById("printLegend").checked){var U=new n,j=new t;j.exportOptions={dpi:dpi},j.layout="Legend Letter "+F,j.format="PDF",j.layoutOptions={titleText:document.getElementById("printTitle").value,authorText:prtDisclaimer,legendLayers:k,customTextElements:[{Subtitle:document.getElementById("printSubTitle").value},{Legend:k}]},U.view=view,U.template=j,e.execute(printServiceUrl,U).then(y).catch(m)}})}var startTim,inchesWidth,inchesHeight,prtDisclaimer="",dpi=96;