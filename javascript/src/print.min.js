function printInit(){var e=createXMLhttpRequest(),t=app+"/PrintPdfWidget.xml?v="+ndisVer;e.onreadystatechange=function(){if(4===e.readyState&&200===e.status){var t=createXMLdoc(e);t.getElementsByTagName("disclaimer")[0]?prtDisclaimer=t.getElementsByTagName("disclaimer")[0].firstChild.nodeValue:alert("Missing tag, disclaimer, in "+app+"/PrintPdfWidget.xml file.","Data Error"),t.getElementsByTagName("helpvideo")[0]&&(document.getElementById("printVideo").innerHTML="<a target='help' href="+t.getElementsByTagName("helpvideo")[0].firstChild.nodeValue+">Click here to view help video.</a><br/><br/>")}else 404===e.status?(alert("Error: Missing PrintPdfWidget.aspx file in "+app+" directory.","Data Error"),hideLoading()):4===e.readyState&&500===e.status&&(alert("Missing PrintPdfWidget.aspx file. app="+app,"Data Error"),hideLoading())},e.open("GET",t,!0),e.send()}function grayOutLegend(e){require(["dojo/dom"],function(t){document.getElementById("printMapLink").innerHTML="",document.getElementById("printLegendLink").innerHTML="","geopdf"!=e.value&&"pdf"!=e.value&&t.byId("printLegend")?t.byId("printLegendCB").style.display="none":t.byId("printLegendCB").style.display="inline-block"})}function printMap(){require(["esri/rest/print","esri/rest/support/PrintTemplate","esri/rest/support/PrintParameters","esri/Graphic","esri/geometry/Point","esri/rest/support/LegendLayer","esri/layers/GraphicsLayer","dojo/dom","dijit/registry"],function(e,t,n,i,r,a,l,s,d){function o(e){var t,n,i=s.byId("format"),r=Date.now()-startTim,a=view.scale;a<9028?n="10k":a<36112?n="24k":a<72224?n="50k":a<144448?n="100k":a<288896?n="250k":a<577791?n="500k":a<1155582?n="1M":a<2311163?n="2M":a<4622325?n="4M":a<9244649&&(n="9M");var l=i.options[i.selectedIndex].value,o=s.byId("size").options[s.byId("size").selectedIndex].innerHTML+" "+l+" ";I&&document.getElementById("printLegend").checked&&(o+="legend ");var p=s.byId("size").options[s.byId("size").selectedIndex].innerHTML,m=Math.floor(r/1e3),y="";for(t=0;t<map.layers.items.length;t++)switch(map.layers.items[t]){case"Motor Vehicle Use Map":y+="M";break;case"Hunter Reference":y+="R";break;case"Game Species":y+="G";break;case"Fishing Info":y+="F";break;case"Reference":y+="R"}if(o+=y,console.log("Time to create map = "+m+" seconds for "+o+" "+n),"function"==typeof gtag&&gtag("event","print",{seconds:m,page_size:p,map_services:y,map_scale:n,map_type:l,basemap:mapBasemap}),"function"==typeof ga){var u="Print ";switch(l){case"pdf":u+="PDF";break;case"geopdf":u+="geoPDF";break;case"jpg":u+="JPG";break;case"geotiff":u+="geoTIFF";break;case"gif":u+="GIF"}var f={metric1:m,dimension2:p,dimension3:y,dimension4:n,dimension5:l},b=s.byId("size").options[s.byId("size").selectedIndex].innerHTML;ga("send","event",o,b,u,m,f)}if(console.log("printing to "+e.url),e.url.indexOf("tif")>-1||e.url.indexOf("svgz")>-1)document.getElementById("printMapLink").innerHTML="<a href='"+e.url+"' title='exported map file' target='_blank'> map."+S.format.toLowerCase()+"</a>";else{try{window.open(e.url,"_blank")}catch(e){console.log("Can't open printout in new window. Use link provided.")}document.getElementById("printMapLink").innerHTML="<a href='"+e.url+"' title='exported map file' target='_blank'><span class='esri-icon-launch-link-external'></span> map."+S.format.toLowerCase()+"</a>"}for(t=0;t<c;t++)removeDrawItem();g&&(d.byId("print_button").set("label","Print"),document.getElementById("printLoading").style.display="none"),g=!0}function p(e){d.byId("print_button").set("label","Print"),document.getElementById("printLoading").style.display="none",alert("Error printing with basemap, "+mapBasemap+". Error Code: "+e,"Code Error",e),document.getElementById("printMapLink").innerHTML="",document.getElementById("printLegendLink").innerHTML="";for(var t=0;t<c;t++)removeDrawItem()}function m(e){console.log("printing legend to "+e.url);try{window.open(e.url,"_blank")}catch(e){console.log("Can't open printout in new window. Use link provided.")}g&&(d.byId("print_button").set("label","Print"),document.getElementById("printLoading").style.display="none"),document.getElementById("printLegendLink").innerHTML="<a href='"+e.url+"' target='_blank'><span class='esri-icon-launch-link-external'></span> legend."+S.format.toLowerCase()+"</a>",g=!0}function y(e){d.byId("print_button").set("label","Print"),document.getElementById("printLoading").style.display="none",document.getElementById("printLegendLink").innerHTML="",document.getElementById("printMapLink").innerHTML="",e.details?alert("Error printing the legend: "+e+e.details,"Code Error"):alert("Error printing the legend","Code Error")}var u,c=0,g=!1,I="inline-block"==s.byId("printLegendCB").style.display;I||(g=!0),d.byId("print_button").set("label","Creating..."),document.getElementById("printLoading").style.display="inline-block",document.getElementById("printMapLink").innerHTML="<span class='esri-icon-loading-indicator esri-rotating'></span> map.pdf",document.getElementById("printLegendLink").innerHTML="",document.getElementById("printDiv").scrollIntoView({behavior:"smooth",block:"end"});var f,b,L,h,v,E=map.layers.items,k=[],w=0;for(u=0;u<E.length;u++)if(E[u].visible&&"topo"!=E[u].id&&"streets"!=E[u].id&&"hybrid"!=E[u].id){if(E[u].id.indexOf("drawgraphics")>0){if(E[u].graphics.length>1&&"point"==E[u].graphics[0].geometry.type&&!E[u].graphics[0].symbol.text){c++;var x=new r(E[u].graphics[0].geometry.x,E[u].graphics[0].geometry.y,map.spatialReference),T=new i(x),B=new l;B.id="drawgraphics"+drawGraphicsCounter,drawGraphicsCount.push(B.id),drawGraphicsCounter++,addLabel(T,E[u].graphics[1].symbol.text,B,"11pt")}continue}if(E[u].sublayers||E[u].layers){f=new a({title:E[u].title,layerId:E[u].id,subLayerIds:[]}),E[u].layerId&&(f.layerId=E[u].layerId);var M,P,C,H,D=E[u];for(M=void 0!==D.sublayers?D.sublayers.items:D.layers.items,b=0;b<M.length;b++)if(M[b].visible)if(M[b].sublayers||M[b].layers){for(M[b].sublayers?P=M[b].sublayers.items:M[b].layers&&(P=M[b].layers.items),L=0;L<P.length;L++)if(P[L].visible)if(P[L].sublayers||P[L].layers){for(P[L].sublayers?C=P[L].sublayers.items:P[L].layers&&(C=P[L].layers.items),h=0;h<C.length;h++)if(C[h].visible)if(C[h].sublayers||C[h].layers)for(H=C[h].sublayers?C[h].sublayers.items:C[h].layers.items,v=0;v<H.length;v++)H[v].visible&&(H[v].sublayers||H[v].layers?alert("add one more group layer traversal in print.js to handle nested groups."):void 0!==H[v].layerId?(f.title=H[v].title,f.layerId=H[v].layerId,f.subLayerIds.push(H[v].layerId)):f.subLayerIds.push(H[v].id));else void 0!==C[h].layerId?(f=null,k.push(new a({layerId:C[h].id,title:C[h].title}))):f.subLayerIds.push(C[h].id)}else void 0!==P[L].layerId?(f=null,k.push(new a({layerId:P[L].id,title:P[L].title}))):f.subLayerIds.push(P[L].id)}else void 0!==M[b].layerId?(f=null,k.push(new a({layerId:M[b].id,title:M[b].title}))):f.subLayerIds.push(M[b].id);f&&k.push(f),f=null,w++}else f=new a({title:E[u].title,layerId:E[u].id,subLayerIds:[]}),E[u].layerId&&(f.layerId=E[u].layerId),k.push(f),f=null,w++}var _=new n,S=new t,G=s.byId("orient"),O=s.byId("format");index=G.selectedIndex;var F=G.options[index].value,z=s.byId("size");index=z.selectedIndex;var N=z.options[index].value;if(S.exportOptions={dpi:dpi},"pdf"!=O.options[O.selectedIndex].value){var R;if(S.layout=app+" "+N+F,S.preserveScale=!0,g=!0,S.format=O.options[O.selectedIndex].value,"geopdf"!=S.format)R="none",S.exportOptions={dpi:dpi};else if("geopdf"!=S.format||document.getElementById("printLegend").checked)R="Legend Letter "+F,S.format="pdf";else if(R="none",S.format="pdf",0==w)return alert("Printing of basemaps alone does not work. Please add map layers. From the menu, select 'Map Layers & Legend.'","Warning"),d.byId("print_button").set("label","Print"),document.getElementById("printLoading").style.display="none",document.getElementById("printMapLink").innerHTML="",void(document.getElementById("printLegendLink").innerHTML="");_.extraParameters={Georef_Info:"True",Legend_Template:R}}else I&&!document.getElementById("printLegend").checked&&(g=!0),S.preserveScale=!0,S.format=O.options[O.selectedIndex].value.toUpperCase(),N.indexOf("Letter")>-1?S.layout=N+"ANSI A "+F:S.layout=N+"ANSI B "+F;S.showAttribution=!1;var U=document.getElementById("printTitle").value;if("geopdf"==O.options[O.selectedIndex].value&&(U+=" (Geo PDF)"),I&&document.getElementById("printLegend").checked?S.layoutOptions={titleText:U,authorText:prtDisclaimer,legendLayers:k,customTextElements:[{Subtitle:document.getElementById("printSubTitle").value},{Legend:k}]}:S.layoutOptions={titleText:U,authorText:prtDisclaimer,legendLayers:[],customTextElements:[{Subtitle:document.getElementById("printSubTitle").value}]},U=null,_.view=view,_.template=S,e.execute(printServiceUrl,_).then(o).catch(p),startTim=Date.now(),"pdf"==O.options[O.selectedIndex].value&&I&&document.getElementById("printLegend").checked){document.getElementById("printLegendLink").innerHTML="<span class='esri-icon-loading-indicator esri-rotating'></span> legend.pdf";var V=new n,j=new t;j.exportOptions={dpi:dpi},j.layout="Legend Letter "+F,j.format="PDF",j.layoutOptions={titleText:document.getElementById("printTitle").value,authorText:prtDisclaimer,legendLayers:k,customTextElements:[{Subtitle:document.getElementById("printSubTitle").value},{Legend:k}]},V.view=view,V.template=j,e.execute(printServiceUrl,V).then(m).catch(y)}})}var startTim,prtDisclaimer="",dpi=300;