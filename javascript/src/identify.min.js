function executeIdentify(e){identifyParams.geometry=e.mapPoint,identifyParams.width=view.width,identifyParams.height=view.height,identifyParams.mapExtent=view.extent,identifyParams.tolerance=1,document.getElementById("mapDiv").style.cursor="wait";for(var t=0;t<identifyLayerIds[identifyGroup].length;t++){var i=identifyLayerIds[identifyGroup][t].url;function a(t){t.length>0&&view.openPopup({features:t,location:e.mapPoint}),document.getElementById("mapDiv").style.cursor="auto"}identifyParams.layerIds=identifyLayerIds[identifyGroup][t].ids.slice(),identify.identify(i,identifyParams).then(function(e){const t=e.results;return t.map(function(e){let t=e.feature,i=e.layerName;t.attributes.layerName=i,t.popupTemplate={title:"<button>"+identifyGroup+"</button>"},t.popupTemplate.content="<b>"+i+"</b><br>";for(var a=0;a<identifyLayers[identifyGroup][i].displaynames.length;a++)""!==t.attributes[identifyLayers[identifyGroup][i].fields[a]]&&(t.popupTemplate.content+=identifyLayers[identifyGroup][i].displaynames[a]+": {"+identifyLayers[identifyGroup][i].fields[a]+"}<br>");t.popupTemplate.content+="<br><select id='id_group' name='id_group' style='margin: 5px;color:black;' onChange='changeIdentifyGroup(this)'>";for(var n=0;n<identifyGroups.length;n++)t.popupTemplate.content+="<option",identifyGroup==identifyGroups[n]&&(t.popupTemplate.content+=" selected"),t.popupTemplate.content+=">"+identifyGroups[n]+"</option>";return t.popupTemplate.content+="</select>",t})}).then(a)}}function readSettingsWidget(){var e=createXMLhttpRequest(),t=app+"/SettingsWidget.xml?v="+ndisVer;e.onreadystatechange=function(){if(4==e.readyState&&200==e.status)try{require(["dojo/dom","dijit/registry","dojo/query","dojo/dom-construct","dojo/on"],function(t,i,a,n,r){var s=createXMLdoc(e),l=getCookie("prj");settings=""!==l?{XYProjection:l}:{XYProjection:s.getElementsByTagName("xy_projection")[0].childNodes[0].nodeValue},document.getElementById("settings_xycoords_combo").value=settings.XYProjection,use_map_link=s.getElementsByTagName("use_map_link")[0]&&"true"==s.getElementsByTagName("use_map_link")[0].childNodes[0].nodeValue?1:0,use_map_link&&(document.getElementById("mapLinkBtn").style.display="block"),use_get_extent=s.getElementsByTagName("use_get_extent")&&"true"==s.getElementsByTagName("use_get_extent")[0].childNodes[0].nodeValue?1:0,use_get_extent&&(document.getElementById("showExtentBtn").style.display="block");var o=s.getElementsByTagName("use_gmus")[0]&&"true"==s.getElementsByTagName("use_gmus")[0].childNodes[0].nodeValue?1:0;o?(settings.useGMUs=!0,s.getElementsByTagName("gmu_url")[0]?settings.elkUrl=s.getElementsByTagName("gmu_url")[0].childNodes[0].nodeValue:alert("Missing tag: gmu_url in "+app+"/SettingsWidget.xml","Data Error"),s.getElementsByTagName("gmu_field")[0]?settings.elkField=s.getElementsByTagName("gmu_field")[0].childNodes[0].nodeValue:alert("Missing tag: gmu_field in "+app+"/SettingsWidget.xml","Data Error"),s.getElementsByTagName("sheep_gmu_url")[0]?settings.sheepUrl=s.getElementsByTagName("sheep_gmu_url")[0].childNodes[0].nodeValue:alert("Missing tag: sheep_gmu_url in "+app+"/SettingsWidget.xml","Data Error"),s.getElementsByTagName("sheep_gmu_field")[0]?settings.sheepField=s.getElementsByTagName("sheep_gmu_field")[0].childNodes[0].nodeValue:alert("Missing tag: sheep_gmu_field in "+app+"/SettingsWidget.xml","Data Error"),s.getElementsByTagName("goat_gmu_url")[0]?settings.goatUrl=s.getElementsByTagName("goat_gmu_url")[0].childNodes[0].nodeValue:alert("Missing tag: goat_gmu_url in "+app+"/SettingsWidget.xml","Data Error"),s.getElementsByTagName("goat_gmu_field")[0]?settings.goatField=s.getElementsByTagName("goat_gmu_field")[0].childNodes[0].nodeValue:alert("Missing tag: goat_gmu_field in "+app+"/SettingsWidget.xml","Data Error"),"Big Game GMU"==gmu?showGMUCombo(settings.elkUrl,settings.elkField):"Bighorn GMU"==gmu?showGMUCombo(settings.sheepUrl,settings.sheepField):"Goat GMU"==gmu&&showGMUCombo(settings.goatUrl,settings.goatField)):settings.useGMUs=!1;var d=s.getElementsByTagName("driving_directions")[0]&&"true"==s.getElementsByTagName("driving_directions")[0].childNodes[0].nodeValue?1:0;d&&(view.popup.actions=[{id:"directions",className:"esri-icon-directions2",title:"Get Directions"}]),s.getElementsByTagName("elevation")[0]&&s.getElementsByTagName("elevation")[0].firstChild.nodeValue&&(show_elevation="true"==s.getElementsByTagName("elevation")[0].firstChild.nodeValue?1:0),show_elevation&&s.getElementsByTagName("elevation_url")[0]&&(s.getElementsByTagName("elevation_url")[0].firstChild.nodeValue?elevation_url=s.getElementsByTagName("elevation_url")[0].firstChild.nodeValue:alert("Missing elevation_url tag in SettingsWidget.xml.","Data Error"),view.popup.actions.push({id:"elevation",className:"esri-icon-elevation",title:"Elevation: loading..."})),folder=s.getElementsByTagName("folder");for(var y=0;y<folder.length;y++){0==y&&(identifyGroup=folder[y].getAttribute("label")),identifyGroups.push(folder[y].getAttribute("label")),identifyLayerIds[identifyGroups[y]]=[];var u=folder[y].getElementsByTagName("layer");identifyLayers[identifyGroups[y]]={},folder[y].getElementsByTagName("desc")[0]&&(identifyLayers[identifyGroups[y]].desc=folder[y].getElementsByTagName("desc")[0].firstChild.nodeValue);for(var g="missing label",f=0;f<u.length;f++){u[f].getAttribute("label")?g=u[f].getAttribute("label"):alert("Error in "+app+"/SettingsWidget.xml. Missing label in folder: "+identifyGroups[y]+".","Data Error"),folder[y].getAttribute("id_vis_only")&&"true"==folder[y].getAttribute("id_vis_only").toLowerCase()&&(u[f].getElementsByTagName("vis_url")[0]&&u[f].getElementsByTagName("vis_id")[0]||alert("Error in "+app+"/SettingsWidget.xml. When vis_id_only is set in a folder, every layer in the folder must have a vis_id and vis_url tag for the layer that is in the map to check if it is visible or not. Missing vis_url and vis_id tags in folder: "+identifyGroups[y]+".","Data Error")),identifyLayers[identifyGroups[y]][g]={},"Wildfire Perimeters"===u[f].getAttribute("label")&&(u[f].getElementsByTagName("irwin_to_inciweb")&&u[f].getElementsByTagName("irwin_to_inciweb")[0]?irwin_to_inciweb_url=u[f].getElementsByTagName("irwin_to_inciweb")[0].childNodes[0].nodeValue:alert("Error in "+app+"/readSettingsWidget.xml. Missing irwin_to_inciweb tag in Wildfire Perimeters layer. This contains the report info."));var m=!1;if(u[f].getElementsByTagName("url")[0]&&u[f].getElementsByTagName("id")[0])for(var p=0;p<identifyLayerIds[identifyGroups[y]].length;p++)folder[y].getAttribute("id_vis_only")&&"true"==folder[y].getAttribute("id_vis_only").toLowerCase()&&identifyLayerIds[identifyGroups[y]][p].url==u[f].getElementsByTagName("url")[0].childNodes[0].nodeValue&&identifyLayerIds[identifyGroups[y]][p].vis_url==u[f].getElementsByTagName("vis_url")[0].childNodes[0].nodeValue&&identifyLayerIds[identifyGroups[y]][p].geometry==u[f].getElementsByTagName("geometry")[0].childNodes[0].nodeValue.toLowerCase()?(identifyLayerIds[identifyGroups[y]][p].ids.push(u[f].getElementsByTagName("id")[0].childNodes[0].nodeValue),identifyLayerIds[identifyGroups[y]][p].vis_ids.push(u[f].getElementsByTagName("vis_id")[0].childNodes[0].nodeValue),m=!0):identifyLayerIds[identifyGroups[y]][p].url==u[f].getElementsByTagName("url")[0].childNodes[0].nodeValue&&identifyLayerIds[identifyGroups[y]][p].geometry==u[f].getElementsByTagName("geometry")[0].childNodes[0].nodeValue.toLowerCase()&&(identifyLayerIds[identifyGroups[y]][p].ids.push(u[f].getElementsByTagName("id")[0].childNodes[0].nodeValue),m=!0);else alert("Error in "+app+"/SettingsWidget.xml. Missing url or id in folder: "+identifyGroups[y]+" for layer: "+g+".","Data Error");if(!m)if(u[f].getElementsByTagName("url")[0]&&u[f].getElementsByTagName("id")[0]){var c=null,h=[];folder[y].getAttribute("id_vis_only")&&"true"==folder[y].getAttribute("id_vis_only").toLowerCase()&&(c=u[f].getElementsByTagName("vis_url")[0].childNodes[0].nodeValue,h.push(u[f].getElementsByTagName("vis_id")[0].childNodes[0].nodeValue)),identifyLayerIds[identifyGroups[y]].push({url:u[f].getElementsByTagName("url")[0].childNodes[0].nodeValue,ids:new Array(u[f].getElementsByTagName("id")[0].childNodes[0].nodeValue),geometry:u[f].getElementsByTagName("geometry")[0].childNodes[0].nodeValue.toLowerCase(),id_vis_only:!(!folder[y].getAttribute("id_vis_only")||"true"!=folder[y].getAttribute("id_vis_only").toLowerCase()),vis_url:c,vis_ids:h})}else alert("Error in "+app+"/SettingsWidget.xml. Missing url or id in folder: "+identifyGroups[y]+" for layer: "+g+".","Data Error");u[f].getElementsByTagName("database")[0]?(u[f].getElementsByTagName("url")[0]?identifyLayers[identifyGroups[y]][g].url=u[f].getElementsByTagName("url")[0].childNodes[0].nodeValue:alert("Error in "+app+"/SettingsWidget.xml. Missing url in folder: "+identifyGroups[y]+" for layer: "+g+".","Data Error"),u[f].getElementsByTagName("id")[0]?identifyLayers[identifyGroups[y]][g].id=u[f].getElementsByTagName("id")[0].childNodes[0].nodeValue:alert("Error in "+app+"/SettingsWidget.xml. Missing id in folder: "+identifyGroups[y]+" for layer: "+g+".","Data Error"),u[f].getElementsByTagName("geometry")[0]?identifyLayers[identifyGroups[y]][g].geometry=u[f].getElementsByTagName("geometry")[0].childNodes[0].nodeValue:alert("Error in "+app+"/SettingsWidget.xml. Missing geometry in folder: "+identifyGroups[y]+" for layer: "+g+".","Data Error"),u[f].getElementsByTagName("fields")[0]?identifyLayers[identifyGroups[y]][g].fields=u[f].getElementsByTagName("fields")[0].childNodes[0].nodeValue.split(","):alert("Error in "+app+"/SettingsWidget.xml. Missing fields in folder: "+identifyGroups[y]+" for layer: "+g+".","Data Error"),u[f].getElementsByTagName("displaynames")[0]?identifyLayers[identifyGroups[y]][g].displaynames=u[f].getElementsByTagName("displaynames")[0].childNodes[0].nodeValue.split(","):alert("Error in "+app+"/SettingsWidget.xml. Missing displaynames in folder: "+identifyGroups[y]+" for layer: "+g+".","Data Error"),u[f].getElementsByTagName("position")[0]?identifyLayers[identifyGroups[y]][g].position=u[f].getElementsByTagName("position")[0].childNodes[0].nodeValue:identifyLayers[identifyGroups[y]][g].position=0,u[f].getElementsByTagName("database")[0]?identifyLayers[identifyGroups[y]][g].database=u[f].getElementsByTagName("database")[0].childNodes[0].nodeValue:alert("Error in "+app+"/SettingsWidget.xml. Missing database in folder: "+identifyGroups[y]+" for layer: "+g+".","Data Error"),u[f].getElementsByTagName("filename")[0]?identifyLayers[identifyGroups[y]][g].filename=u[f].getElementsByTagName("filename")[0].childNodes[0].nodeValue:alert("Error in "+app+"/SettingsWidget.xml. Missing filename in folder: "+identifyGroups[y]+" for layer: "+g+".","Data Error"),u[f].getElementsByTagName("one2one_fields")[0]&&u[f].getElementsByTagName("one2one_fields")[0].childNodes.length>0&&(identifyLayers[identifyGroups[y]][g].one2one_fields=u[f].getElementsByTagName("one2one_fields")[0].childNodes[0].nodeValue.split(",")),u[f].getElementsByTagName("one2one_display")[0]&&u[f].getElementsByTagName("one2one_display")[0].childNodes.length>0&&(identifyLayers[identifyGroups[y]][g].one2one_display=u[f].getElementsByTagName("one2one_display")[0].childNodes[0].nodeValue.split(",")),u[f].getElementsByTagName("one2many_fields")[0]&&u[f].getElementsByTagName("one2many_fields")[0].childNodes.length>0&&(identifyLayers[identifyGroups[y]][g].one2many_fields=u[f].getElementsByTagName("one2many_fields")[0].childNodes[0].nodeValue.split(","))):(u[f].getElementsByTagName("url")[0]?identifyLayers[identifyGroups[y]][g].url=u[f].getElementsByTagName("url")[0].childNodes[0].nodeValue:alert("Error in "+app+"/SettingsWidget.xml. Missing url in folder: "+identifyGroups[y]+" for layer: "+g+".","Data Error"),u[f].getElementsByTagName("id")[0]?identifyLayers[identifyGroups[y]][g].id=u[f].getElementsByTagName("id")[0].childNodes[0].nodeValue:alert("Error in "+app+"/SettingsWidget.xml. Missing id in folder: "+identifyGroups[y]+" for layer: "+g+".","Data Error"),u[f].getElementsByTagName("geometry")[0]?identifyLayers[identifyGroups[y]][g].geometry=u[f].getElementsByTagName("geometry")[0].childNodes[0].nodeValue:alert("Error in "+app+"/SettingsWidget.xml. Missing geometry in folder: "+identifyGroups[y]+" for layer: "+g+".","Data Error"),u[f].getElementsByTagName("fields")[0]?identifyLayers[identifyGroups[y]][g].fields=u[f].getElementsByTagName("fields")[0].childNodes[0].nodeValue.split(","):alert("Error in "+app+"/SettingsWidget.xml. Missing fields in folder: "+identifyGroups[y]+" for layer: "+g+".","Data Error"),u[f].getElementsByTagName("displaynames")[0]?identifyLayers[identifyGroups[y]][g].displaynames=u[f].getElementsByTagName("displaynames")[0].childNodes[0].nodeValue.split(","):alert("Error in "+app+"/SettingsWidget.xml. Missing displaynames in folder: "+identifyGroups[y]+" for layer: "+g+".","Data Error"),"Big Game GMU Boundaries"==g&&(identifyLayers[identifyGroups[y]]["Bighorn GMU"]={},identifyLayers[identifyGroups[y]]["Bighorn GMU"].url=settings.sheepUrl.slice(0,settings.sheepUrl.length-2),identifyLayers[identifyGroups[y]]["Bighorn GMU"].id=settings.sheepUrl.slice(settings.sheepUrl.length-1),identifyLayers[identifyGroups[y]]["Bighorn GMU"].geometry="polygon",identifyLayers[identifyGroups[y]]["Bighorn GMU"].fields=[settings.sheepField],identifyLayers[identifyGroups[y]]["Bighorn GMU"].displaynames=["GMU Number"],identifyLayers[identifyGroups[y]]["Goat GMU"]={},identifyLayers[identifyGroups[y]]["Goat GMU"].url=settings.goatUrl.slice(0,settings.goatUrl.length-2),identifyLayers[identifyGroups[y]]["Goat GMU"].id=settings.goatUrl.slice(settings.goatUrl.length-1),identifyLayers[identifyGroups[y]]["Goat GMU"].geometry="polygon",identifyLayers[identifyGroups[y]]["Goat GMU"].fields=[settings.goatField],identifyLayers[identifyGroups[y]]["Goat GMU"].displaynames=["GMU Number"]))}}})}catch(e){alert("Error reading "+app+"/SettingsWidget.xml in javascript/identify.js readSettingsWidget(): "+e.message,"Data Error",e),hideLoading("")}else 404===e.status?(alert("Error: Missing "+app+"/settingsWidget.xml file.","Data Error"),hideLoading()):4===e.readyState&&500===e.status&&(alert("Error reading "+app+"/settingsWidget.xml.","Code Error"),hideLoading())},e.open("GET",t,!0),e.send()}function doIdentify(e){showLoading(),"function"==typeof gtag&&gtag("event","widget_click",{widget_name:"Identify"}),numDatabaseCalls=0,processedDatabaseCalls=0,features=[],theEvt=e;for(var t=0;t<identifyGroups.length;t++)groupContent[identifyGroups[t]]=null;clickPoint=e.mapPoint,displayContent()}function setIdentifyHeader(){var e=document.getElementsByClassName("esri-popup__main-container")[0];if(e){title="<span style='float:left;text-overflow:ellipsis;'>Show: <select id='id_group' name='id_group' style='margin: 5px;color:black;' onChange='changeIdentifyGroup(this)'>";for(var t=0;t<identifyGroups.length;t++)title+="<option",identifyGroup==identifyGroups[t]&&(title+=" selected"),title+=">"+identifyGroups[t]+"</option>";title+="</select></span>",e=0===e.childNodes[0].childNodes[0].childNodes[0].innerHTML.indexOf("<h")?e.childNodes[0].childNodes[0].childNodes[0].childNodes[0]:e.childNodes[0].childNodes[0].childNodes[0],e.innerHTML=title}}function displayContent(){require(["esri/rest/query","esri/rest/support/Query","esri/rest/identify","dojo/promise/all"],function(e,t,i,a){try{if(identifyGroup.indexOf("Wildfire")>-1){view.closePopup(),view.popupEnabled=!0;try{view.popup.open({location:clickPoint,fetchFeatures:!0})}catch(e){return void alert("Problem trying to identify wildfire. "+e.message,"Warning")}var n=0;let e=setInterval(function(){n++,n<4&&document.getElementsByClassName("esri-popup__main-container")[0]?(setIdentifyHeader(),setIdentifyFooter(),clearInterval(e),hideLoading()):(view.popup.location=clickPoint,view.popup.title="Loading",view.popup.content="No Wildfire incidents at this location.",view.openPopup(),setIdentifyHeader(),setIdentifyFooter())},500);return}if(groupContent[identifyGroup])return view.popup.content=groupContent[identifyGroup],void hideLoading("");identifyParams.geometry=clickPoint,identifyParams.mapExtent=view.extent,identifyParams.width=view.width,identifyParams.height=view.height;for(var r=-1,s=[],l=0;l<identifyLayerIds[identifyGroup].length;l++){var o=identifyLayerIds[identifyGroup][l];if(o){var d;if(identifyParams.layerIds=o.ids.slice(),"polygon"!=o.geometry?view.scale<=36112?identifyParams.tolerance=25:view.scale<=288895?identifyParams.tolerance=20:identifyParams.tolerance=10:identifyParams.tolerance=1,o.id_vis_only?(identifyParams.layerOption="visible",d=o.vis_url,"/"==o.vis_url[o.vis_url.length-1]&&(d=o.vis_url.substr(0,o.vis_url.length-1)),r=!1):(r=!1,d=o.url),settings.elkUrl&&o.url==settings.elkUrl.slice(0,settings.elkUrl.lastIndexOf("/")+1)&&"Big Game GMU"!=gmu){var y=identifyParams.layerIds.indexOf(settings.elkUrl.slice(settings.elkUrl.lastIndexOf("/")+1));y>-1&&identifyParams.layerIds.splice(y,1)}0==identifyParams.layerIds.length&&(r=!0),r||s.push(i.identify(d,identifyParams).then(identifySuccess).catch(handleQueryError))}}if("GMU and Land Management"===identifyGroup&&("Bighorn GMU"==gmu?(identifyParams.tolerance=1,identifyParams.layerIds=[settings.sheepUrl.slice(settings.sheepUrl.lastIndexOf("/")+1)],s.push(i.identify(settings.sheepUrl.slice(0,settings.sheepUrl.lastIndexOf("/")+1),identifyParams).then(identifySuccess).catch(handleQueryError))):"Goat GMU"==gmu&&(identifyParams.tolerance=1,identifyParams.layerIds=[settings.goatUrl.slice(settings.goatUrl.lastIndexOf("/")+1)],s.push(i.identify(settings.goatUrl.slice(0,settings.goatUrl.lastIndexOf("/")+1),identifyParams).then(identifySuccess).catch(handleQueryError)))),s&&s.length>0){var u=a(s);u.then(handleQueryResults)}else numDatabaseCalls=0,processedDatabaseCalls=0,features=[],displayInfoWindow()}catch(e){alert("Problem trying to identify. Error message: "+e.message,"Warning")}})}function identifySuccess(e){return e.results}function handleQueryError(e){e.details?alert("Error in identify.js/doIdentify.  "+e.details+" "+e.message+" Check "+app+"/SettingsWidget.xml urls.","Data Error"):alert("Error in identify.js/doIdentify.  "+e.message+" Check "+app+"/SettingsWidget.xml urls.","Data Error"),hideLoading("")}function handleQueryResults(e){try{if(!e)return void alert("Error in identify.js/handleQueryResults. IdentifyTask returned null.","Data Error");var t="";for(e.forEach(function(e){e&&e.length>0&&e.forEach(function(e){void 0!==identifyLayers[identifyGroup][e.layerName]&&void 0!==identifyLayers[identifyGroup][e.layerName].database&&numDatabaseCalls++})}),index=0;XMLHttpRequestObjects.length>0;)XMLHttpRequestObjects.pop();var a;t="";e.forEach(function(e){e.length>0&&e.forEach(function(e){var n,r=e.feature;if(r.attributes.layerName=e.layerName,void 0!==identifyLayers[identifyGroup][e.layerName])if(void 0!==identifyLayers[identifyGroup][e.layerName].database)try{createMultiXMLhttpRequest();var s=app+"/"+identifyLayers[identifyGroup][e.layerName].database+"?v="+ndisVer+"&key="+e.feature.attributes[identifyLayers[identifyGroup][e.layerName].fields[0]];XMLHttpRequestObjects[index].open("GET",s,!0),XMLHttpRequestObjects[index].onreadystatechange=(n=index,function(){if(4==XMLHttpRequestObjects[n].readyState){if(200==XMLHttpRequestObjects[n].status){a=e.layerName+"</strong><div style='padding-left: 10px;'>";var i=createXMLdoc(XMLHttpRequestObjects[n]);for(y=0;y<identifyLayers[identifyGroup][e.layerName].displaynames.length;y++)if(y>0&&e.feature.attributes[identifyLayers[identifyGroup][e.layerName].fields[y]]&&" "!==e.feature.attributes[identifyLayers[identifyGroup][e.layerName].fields[y]]&&"Null"!==e.feature.attributes[identifyLayers[identifyGroup][e.layerName].fields[y]]&&""!==e.feature.attributes[identifyLayers[identifyGroup][e.layerName].fields[y]]&&("string"==typeof e.feature.attributes[identifyLayers[identifyGroup][e.layerName].fields[y]]&&"http"==e.feature.attributes[identifyLayers[identifyGroup][e.layerName].fields[y]].substring(0,4)?a+="<a href='"+e.feature.attributes[identifyLayers[identifyGroup][e.layerName].fields[y]]+"' target='_blank'>"+identifyLayers[identifyGroup][e.layerName].displaynames[y]+"</a>":"<a href"==e.feature.attributes[identifyLayers[identifyGroup][e.layerName].fields[y]].substring(0,7)&&-1==e.feature.attributes[identifyLayers[identifyGroup][e.layerName].fields[y]].indexOf("target")?a+=identifyLayers[identifyGroup][e.layerName].displaynames[y]+": "+e.feature.attributes[identifyLayers[identifyGroup][e.layerName].fields[y]].replace(">"," target='_blank'>"):a+=identifyLayers[identifyGroup][e.layerName].displaynames[y]+": "+e.feature.attributes[identifyLayers[identifyGroup][e.layerName].fields[y]],a+="<br/>"),identifyLayers[identifyGroup][e.layerName].position==y){if(void 0!==identifyLayers[identifyGroup][e.layerName].one2one_fields)for(j=0;j<identifyLayers[identifyGroup][e.layerName].one2one_fields.length;j++)if(i.getElementsByTagName(identifyLayers[identifyGroup][e.layerName].one2one_fields[j]).length>0){var r=i.getElementsByTagName(identifyLayers[identifyGroup][e.layerName].one2one_fields[j])[0];r.getElementsByTagName("linkname").length>0&&r.getElementsByTagName("linkurl").length>0?(a+=identifyLayers[identifyGroup][e.layerName].one2one_display[j]+": ",a+="<a href='"+r.getElementsByTagName("linkurl")[0].firstChild.nodeValue+"'>"+r.getElementsByTagName("linkname")[0].firstChild.nodeValue+"</a>",a+="<br/>"):r.childNodes.length>0&&(a+=identifyLayers[identifyGroup][e.layerName].one2one_display[j]+": ",a+=r.childNodes[0].nodeValue,a+="<br/>")}if(void 0!==identifyLayers[identifyGroup][e.layerName].one2many_fields)for(j=0;j<identifyLayers[identifyGroup][e.layerName].one2many_fields.length;j++){var l=i.getElementsByTagName(identifyLayers[identifyGroup][e.layerName].one2many_fields[j]);a+=identifyLayers[identifyGroup][e.layerName].displaynames[0]+":<ul style='margin-top: 0px; margin-bottom: 0px;'>";for(var o=0;o<l.length;o++)l[o].getElementsByTagName("linkname").length>0&&l[o].getElementsByTagName("linkurl").length>0?a+="<li><a href='"+l[o].getElementsByTagName("linkurl")[0].firstChild.nodeValue+"' target='_blank'>"+l[o].getElementsByTagName("linkname")[0].firstChild.nodeValue+"</a></li>":a+="<li>"+l[o].childNodes[0].nodeValue+"</li>";a+="</ul style='margin-bottom: 0px; margin-top: 0px;'>"}}a+="</div><br/>",processedDatabaseCalls++,-1==t.indexOf(a)&&(t+="<div><strong>"+a,groupContent[identifyGroup]=t,view.popup.content=t),features.push(e.feature)}else 404==XMLHttpRequestObjects[n].status?(alert("Identify failed. File not found: "+s,"Data Error"),processedDatabaseCalls=numDatabaseCalls,displayInfoWindow()):(alert("Identify failed for call to "+s+". Make sure it exists and does not have errors. Must be in the same directory as index.html or a lower directory. XMLHttpRequestObjects["+n+"].status was "+XMLHttpRequestObjects[n].status,"Data Error"),processedDatabaseCalls=numDatabaseCalls,displayInfoWindow());for(var d=!0,y=0;y<numDatabaseCalls;y++)if(!XMLHttpRequestObjects[y]||4!==XMLHttpRequestObjects[y].readyState){d=!1;break}d&&displayInfoWindow()}}),XMLHttpRequestObjects[index].send()}catch(t){alert("Identify on "+e.layerName+" failed with error: "+t.message+" in javascript/identify.js handleQueryResults().","Data Error"),console.log(t.message),hideLoading("")}else{a=e.layerName+"</strong><div style='padding-left: 10px;'>";var l=!0;for(i=0;i<identifyLayers[identifyGroup][e.layerName].displaynames.length;i++)e.feature.attributes[identifyLayers[identifyGroup][e.layerName].fields[i]]&&" "!==e.feature.attributes[identifyLayers[identifyGroup][e.layerName].fields[i]]&&"Null"!==e.feature.attributes[identifyLayers[identifyGroup][e.layerName].fields[i]]&&""!==e.feature.attributes[identifyLayers[identifyGroup][e.layerName].fields[i]]&&(l?l=!1:a+="<br/>","string"==typeof e.feature.attributes[identifyLayers[identifyGroup][e.layerName].fields[i]]&&"http"==e.feature.attributes[identifyLayers[identifyGroup][e.layerName].fields[i]].substring(0,4)?a+="<a href='"+e.feature.attributes[identifyLayers[identifyGroup][e.layerName].fields[i]]+"' target='_blank'>"+identifyLayers[identifyGroup][e.layerName].displaynames[i]+"</a>":a+=identifyLayers[identifyGroup][e.layerName].displaynames[i]+": "+e.feature.attributes[identifyLayers[identifyGroup][e.layerName].fields[i]]);a+="</div></div><br/>",-1==t.indexOf(a)&&(t+="<div><strong>"+a,groupContent[identifyGroup]=t,view.popup.content=t),features.push(e.feature)}})}),displayInfoWindow()}catch(e){alert(e.message+" in javascript/identify.js handleQueryResults().","Code Error",e),hideLoading("")}}function highlightFeature(e){require(["esri/graphic","esri/layers/GraphicsLayer"],function(t,i){var a;"polygon"===features[e].geometry.type?a=polySymbol:"point"===features[e].geometry.type?a=pointSymbol:"line"===features[e].geometry.type&&(a=lineSymbol);var n=newGraphicsLayer();n.id="identifygraphics";for(var r=0;r<features.length;r++)features[r].attributes.layerName==features[e].attributes.layerName&&n.add(new t(features[e].geometry,a));map.addLayer(n),n=null,a=null})}function removeHighlight(){map.getLayer("identifygraphics")&&map.removeLayer(map.getLayer("identifygraphics"))}function setIdentifyFooter(){var e=document.getElementsByClassName("esri-popup__main-container")[0];if(e){var t=e.childNodes[0];require(["esri/geometry/support/webMercatorUtils","esri/geometry/SpatialReference","esri/rest/support/ProjectParameters","esri/rest/geometryService","esri/request"],function(e,i,a,n,r){try{var s,l=document.getElementById("settings_xycoords_combo").value,o=document.getElementsByClassName("idFooter")[0];o&&o.remove(),o=document.createElement("div"),o.className="idFooter";var d=document.createElement("div");if("dd"===l)s=e.webMercatorToGeographic(clickPoint),d.innerHTML="Lat Long: "+s.y.toFixed(5)+" N, "+s.x.toFixed(5)+" W";else if("dms"===l)s=mappoint_to_dms(clickPoint,!0),d.innerHTML="Lat Long: "+s[0]+" N, "+s[1]+" W";else if("dm"===l)s=mappoint_to_dm(clickPoint,!0),d.innerHTML="Lat Long: "+s[0]+" N, "+s[1]+" W";else{var y=new i(Number(l)),u=new a({outSpatialReference:y,geometries:[clickPoint]});n.project(geometryService,u).then(e=>{var t;t=32612==y.wkid?"WGS84 UTM Zone 12N":32613==y.wkid?"WGS84 UTM Zone 13N":26912==y.wkid?"NAD83 UTM Zone 12N":26913==y.wkid?"NAD83 UTM Zone 13N":26712==y.wkid?"NAD27 UTM Zone 12N":26713==y.wkid?"NAD27 UTM Zone 13N":"unknown units",d.innerHTML=t+": "+e[0].x.toFixed(0)+", "+e[0].y.toFixed(0)}).catch(e=>{e.details?alert("Problem projecting point. "+e.message+" "+e.details[0],"Warning"):alert("Problem projecting point. "+e.message,"Warning")}),o.appendChild(d)}if(elevation_url){for(var g='{"xmin":'+view.extent.xmin+',"ymin":'+view.extent.ymin+',"xmax":'+view.extent.xmax+',"ymax":'+view.extent.ymax+',"spatialReference":{"wkid":102100,"latestWkid":102100}}',f=0,m=0;m<view.popup.actions.items.length;m++)if(view.popup.actions.items[m].title.indexOf("Elevation")>-1){f=m;break}var p=r(elevation_url+"/identify",{responseType:"json",query:{geometry:JSON.stringify(clickPoint),geometryType:"point",tolerance:"5",mapExtent:g,imageDisplay:view.width+","+view.height+",96",returnGeometry:!1,sr:"102100",f:"json"},responseType:"json"});p.then(function(e){var t=document.getElementsByClassName("idFooter")[0],i=document.createElement("div");if(0==e.data.results.length||isNaN(e.data.results[0].attributes["Pixel Value"]))return view.popup.actions.items[f].title="Elevation: data not available",i.innerHTML="Elevation: data not available",void t.appendChild(i);view.popup.actions.items[f].title="Elevation: "+Math.round(e.data.results[0].attributes["Pixel Value"])+" ft "+Math.round(.3048*e.data.results[0].attributes["Pixel Value"])+" m",i.innerHTML="Elevation: "+Math.round(e.data.results[0].attributes["Pixel Value"])+" ft "+Math.round(.3048*e.data.results[0].attributes["Pixel Value"])+" m",t.appendChild(i)},function(e){view.popup.actions.items[f].title="Elevation: data not available";var t=document.getElementsByClassName("idFooter")[0],i=document.createElement("div");i.innerHTML="Elevation: data not available",t.appendChild(i),hideLoading("")})}t.appendChild(o)}catch(e){alert(e.message+" in javascript/identify.js setIdentifyFooter().","Code Error",e)}})}}function changeIdentifyGroup(e){identifyGroup=e.options[e.selectedIndex].value,view.popup.content="<p align='center'>Loading...</p>",features=[],numDatabaseCalls=0,processedDatabaseCalls=0,displayContent()}function displayInfoWindow(){if(numDatabaseCalls==processedDatabaseCalls){if(numDatabaseCalls=0,processedDatabaseCalls=0,0==features.length){var e,t="";identifyLayerIds[identifyGroup][0].id_vis_only&&(t="visible "),identifyLayers[identifyGroup].desc?(e="<div><p style='font-style:italic;top:-15px;position:relative;'>"+identifyLayers[identifyGroup].desc+"</p>No "+t+identifyGroup+" at this point.<br/><br/></div>",view.popup.content=e,groupContent[identifyGroup]=e,e=null):(e="<div>No "+t+identifyGroup+" at this point.<br/><br/></div>",view.popup.content=e,groupContent[identifyGroup]=e,e=null)}view.openPopup(),setIdentifyHeader(),setIdentifyFooter(),hideLoading("")}}function getDirections(e){require(["esri/geometry/support/webMercatorUtils"],function(e){var t=e.webMercatorToGeographic(clickPoint),i="http://google.com/maps?output=classic&q="+t.y+","+t.x;window.open(i,"_blank")})}function zoomToPt(){var e=5;map.getLevel()>5&&(e=map.getLevel()),map.centerAndZoom(clickPoint,e)}var tasks,clickPoint,identifyGroup,theEvt,polySymbol,pointSymbol,lineSymbol,identifyParams=null,identify=null,features=[],numDatabaseCalls=0,processedDatabaseCalls=0,folder=[],identifyGroups=[],identifyLayers={},groupContent={},identifyLayerIds=[],show_elevation=!1,elevation_url=null,irwin_to_inciweb_url="",firstClick=!1,secondClick=!1,lastIdentifyTime=0;require(["esri/rest/support/IdentifyParameters","esri/rest/identify","esri/symbols/SimpleLineSymbol","esri/symbols/SimpleFillSymbol","esri/symbols/PictureMarkerSymbol","dojo/_base/Color"],function(e,t,i,a,n,r){identifyParams=new e,identifyParams.returnGeometry=!0,identifyParams.layerOption="all",identify=t,polySymbol=new a(a.STYLE_SOLID,new i(i.STYLE_SOLID,new r([255,0,0]),1),new r([125,125,125,.35])),pointSymbol=new n("assets/images/i_flag.png",40,40),lineSymbol=new i(i.STYLE_SOLID,new r([255,0,10]),1)});