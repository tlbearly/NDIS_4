function reportInit(){require(["dojo/dom","dijit/registry","dojo/sniff","dijit/form/Select","esri/layers/GraphicsLayer","esri/geometry/Circle","esri/symbols/SimpleMarkerSymbol","esri/symbols/SimpleLineSymbol","esri/symbols/SimpleFillSymbol","dojo/_base/Color","esri/Graphic","esri/layers/TileLayer","dijit/Dialog","esri/Map","dijit/form/Button","esri/graphicsUtils","esri/layers/MapImageLayer","esri/layers/FeatureLayer","esri/layers/VectorTileLayer","esri/rest/print","esri/rest/support/PrintTemplate","esri/rest/support/PrintParameters","esri/geometry/support/webMercatorUtils","esri/rest/support/Query","esri/tasks/QueryTask","dojo/promise/all","dojo/on","dojo/_base/array"],function(e,t,r,n,s,o,l,d,p,u,f,y,m,b,c,h,v,B,L,R,w,I,x,E,A,O,_,T){function M(e){return Math.round(e/Ne*72)}function S(){Fe=Ce,Pe=792-2*Ce,ke=612-Fe,Le=3060,Re=2175,mapWidthPts=M(Le),mapHeightPts=M(Re);new m({id:"reportPreviewDialog",style:{width:528*Le/Re+14+"px",height:"666px",overflow:"none"},title:"Resource Report Preview",content:"<div data-dojo-type='dijit/layout/ContentPane'><button id='openReportBtn1' data-dojo-type='dijit/form/Button' role='presentation' type='button'>Open Report</button><button id='saveReportBtn1' data-dojo-type='dijit/form/Button' role='presentation' type='button'>Save Report</button><button id='cancelBtn1' data-dojo-type='dijit/form/Button' role='presentation' type='button'>Cancel</button><span id='reportMsg1'></span></div><div id='reportPreview' style='width:100%;height:100%;'></div><div><button id='openReportBtn2' data-dojo-type='dijit/form/Button' role='presentation' type='button'>Open Report</button><button id='saveReportBtn2' data-dojo-type='dijit/form/Button' role='presentation' type='button'>Save Report</button><button id='cancelBtn2' data-dojo-type='dijit/form/Button' role='presentation' type='button'>Cancel</button><span id='reportMsg2'></span></div>"});var a=[{level:6,resolution:2445.98490512499,scale:9244648.868618},{level:7,resolution:1222.992452562495,scale:4622324.434309},{level:8,resolution:611.4962262813797,scale:2311162.217155},{level:9,resolution:305.74811314055756,scale:1155581.108577},{level:10,resolution:152.87405657041106,scale:577790.554289},{level:11,resolution:76.43702828507324,scale:288895.277144},{level:12,resolution:38.21851414253662,scale:144447.638572},{level:13,resolution:19.10925707126831,scale:72223.819286},{level:14,resolution:9.554628535634155,scale:36111.909643},{level:15,resolution:4.77731426794937,scale:18055.954822},{level:16,resolution:2.388657133974685,scale:9027.977411},{level:17,resolution:1.1943285668550503,scale:4513.988705},{level:18,resolution:.5971642835598172,scale:2256.994353},{level:19,resolution:.29858214164761665,scale:1128.497176}];if(we=new b("reportPreview",{showAttribution:!1,style:{width:Le+"px",height:Re+"px",overflow:"auto"},autoResize:!0,logo:!1,isRubberBandZoom:!0,isScrollWheelZoom:!0,isShiftDoubleClick:!0,displayGraphicsOnPan:!r("ie"),sliderStyle:"large",basemap:fe,minScale:9244649,extent:initExtent,lods:a}),Ie=new s,Ie.id="reportPreviewGraphicsLayer1",we.on("layers-add-result",function(e){try{for(var t=0;t<e.layers.length;t++)e.layers[t].error&&(!0,alert("Problem loading layer: "+e.layers[t].layer.url+". "+e.layers[t].error.message+" in javascript/resourceReport.js. Check "+app+"/ResourceReportWidget.xml","Data Error"))}catch(e){alert("Resource Report Error in reportMap.on(layers-add-result): "+e.message,"Code Error",e)}}),"point"===ve){for(var i=[],o=0;o<pe.length;o++)i.push({label:pe[o],value:parseInt(pe[o])});new n({id:"distCombo",value:de,sortByLabel:!1,labelAttr:"label",style:{width:"50px"},onChange:function(){de=this.get("value"),xe=" within "+this.get("value")+" miles of map click",N(),Se=" ("+this.get("value")+" "+ue+" buffer radius)"},options:i},"reportDistCbo"),document.getElementById("reportDistLabel").innerHTML=" "+ue+" buffer radius",xe=" within "+t.byId("distCombo").get("value")+" miles of map click",Se=" ("+t.byId("distCombo").get("value")+" "+ue+" buffer radius)",i=null}ye=new Draw(map,{showTooltips:!0}),ye.on("draw-end",P),document.getElementById(Be).addEventListener("click",function(e){W()}),t.byId("reportPrintBtn").on("click",z),t.byId("reportPrintBtn").set("disabled",!0),t.byId("reportCancelBtn").on("click",D),t.byId("reportCancelBtn").set("disabled",!0),t.byId("openReportBtn1").on("click",ee("open")),t.byId("saveReportBtn1").on("click",ee("save")),t.byId("openReportBtn2").on("click",ee("open")),t.byId("saveReportBtn2").on("click",ee("save")),t.byId("cancelBtn1").on("click",V),t.byId("cancelBtn2").on("click",V),e.byId("reportDiv").addEventListener("click",function(e){t.byId("reportDiv").open||D()})}function C(e){alert("WARNING: In "+app+"/ResourceReportWidget.xml file, required value missing for the "+e+".","Data Error")}function F(e){if(Te){We.clear(),Ie.clear();var t=new d(d.STYLE_SOLID,new u([0,0,0]),2),r=new p(p.STYLE_SOLID,t,new u([255,255,0,.1])),a=new p(p.STYLE_NULL,t),i=new f(e,r),n=new f(e,a);We.add(i),Ie.add(n),i=null,t=null,r=null,a=null,n=null}}function N(){if(Te){We.clear(),Ie.clear(),Me=new o({center:Te,geodesic:!0,radius:t.byId("distCombo").get("value"),radiusUnit:"esriMiles"});var e=new d(d.STYLE_SOLID,new u([0,0,0]),2),r=new p(p.STYLE_SOLID,e,new u([255,255,0,.1])),a=new p(p.STYLE_NULL,e),i=new f(Me,r),n=new f(Me,a);We.add(i),Ie.add(n);var s=new l(l.STYLE_CROSS,20,e,new u([0,0,0,1])),g=new f(Te,s);We.add(g),i=null,e=null,r=null,s=null,g=null,n=null}}function P(e){drawing=!1,ye.deactivate(),"polygon"===ve?(document.getElementById("reportPolyBtn").className="graphBtn",Te=e.geometry.getExtent().getCenter(),Me=e.geometry,F(e.geometry)):"point"===ve&&(document.getElementById("reportPtBtn").className="graphBtn",Te=e.geometry,N()),t.byId("reportPrintBtn").set("disabled",!1),t.byId("reportCancelBtn").set("disabled",!1),J()}function D(){document.getElementById(Be).className="graphBtn",drawing=!1,ye.deactivate(),We.clear(),Ie.clear(),t.byId("openReportBtn1").set("disabled",!1),t.byId("saveReportBtn1").set("disabled",!1),t.byId("openReportBtn2").set("disabled",!1),t.byId("saveReportBtn2").set("disabled",!1),t.byId("reportPrintBtn").set("disabled",!0),t.byId("reportCancelBtn").set("disabled",!0),Y()}function W(){t.byId("reportPrintBtn").set("disabled",!0),t.byId("reportCancelBtn").set("disabled",!0),Y(),"graphBtnSelected"!==document.getElementById(Be).className?(We.clear(),Ie.clear(),drawing=!0,"polygon"===ve?(document.getElementById("reportPolyBtn").className="graphBtnSelected",ye.activate(Draw.FREEHAND_POLYGON)):"point"===ve&&(document.getElementById("reportPtBtn").className="graphBtnSelected",ye.activate(Draw.POINT))):D()}function G(){T.forEach(le,function(e){e.remove()}),le=[]}function H(e){var r,a=e.layer;if((re.push(a),a.url&&a.url.toLowerCase().indexOf("mapserver")>-1)&&(null!=a.setVisibleLayers&&a.visibleLayers&&a.layerInfos)){var n=a.visibleLayers,s=a.layerInfos;for(j=0;j<a.visibleLayers.length;j++){for(var o=0;o<s.length;o++)if(a.visibleLayers[j]==s[o].id){k=o;break}do{if(hideGroupSublayers.indexOf(s[k].name)>-1&&s[k].subLayerIds)for(r=0;r<s[k].subLayerIds.length;r++)if(-1==n.indexOf(s[k].subLayerIds[r])&&n.push(s[k].subLayerIds[r]),"Big Game GMU"==s[s[k].subLayerIds[r]+1].name){var l=1;"Bighorn GMU"==gmu?l=2:"Goat GMU"==gmu&&(l=3),-1==n.indexOf(s[k].subLayerIds[r]+l)&&n.push(s[k].subLayerIds[r]+l)}else-1==n.indexOf(s[k].subLayerIds[r]+1)&&n.push(s[k].subLayerIds[r]+1);k=s[k].parentLayerId}while(-1!=k)}var d=new Array(0,1,2,3,4,5,6,7,8,9);for(r=0;r<s.length;r++){-1!=n.indexOf(s[r].id)?s[r].visible=!0:-1==s[r].parentLayerId||s[r].subLayerIds?s[r].visible=!1:s[r].name.substr(s[r].name.length-3,3).indexOf("GMU")>-1?s[r].name==gmu?(-1==n.indexOf(r)&&(s[r].visible=!0),d.indexOf(parseInt(s[s[r].parentLayerId].name.substr(0,1)))>-1&&-1==n.indexOf(s[r].parentLayerId)&&(s[s[r].parentLayerId].visible=!0)):s[r].visible=!1:1==s[r].defaultVisibility&&-1===n.indexOf(s[r].parentLayerId)&&d.indexOf(parseInt(s[s[r].parentLayerId].name.substr(0,1)))>-1&&(s[s[r].parentLayerId].visible=!0);var p=n.indexOf(s[r].id);p>-1&&s[r].subLayerIds&&n.splice(p,1)}a.setVisibleLayers(n.sort(function(e,t){return e-t}),!1)}a.spatialReference=map.spatialReference,a.refresh(),we.addLayer(a);var u=ie;for(i=0;i<te.length;i++)for(j=0;j<re.length;j++)te[i]==re[j].id&&(we.reorderLayer(re[j],u),u++);te.length==re.length&&(t.byId("openReportBtn1").set("disabled",!1),t.byId("saveReportBtn1").set("disabled",!1),t.byId("openReportBtn2").set("disabled",!1),t.byId("saveReportBtn2").set("disabled",!1))}function U(e){ae[e.target.id]<10?setTimeout(function(){q(map.getLayer(e.target.id))},500):10===ae[e.target.id]?(e.target.id.indexOf("Motor Vehicle")>-1||e.target.id.indexOf("Wildfire")>-1||e.target.id.indexOf("BLM")>-1?alert("While creating the report map, the external map service that provides "+e.target.id+" is experiencing problems.  This issue is out of CPW control. We will continue trying to load it. We apologize for any inconvenience.","External (Non-CPW) Map Service Error"):e.target.id.indexOf("layer")>-1?alert("While creating the report map, the basemap service is busy or not responding. We will continue trying to load it.","Data Error"):alert("While creating the report map, the "+e.target.id+" service is busy or not responding. We will continue trying to load it.","Data Error"),setTimeout(function(){q(map.getLayer(e.target.id))},500),t.byId("openReportBtn1").set("disabled",!1),t.byId("saveReportBtn1").set("disabled",!1),t.byId("openReportBtn2").set("disabled",!1),t.byId("saveReportBtn2").set("disabled",!1)):setTimeout(function(){q(map.getLayer(e.target.id))},1e3)}function q(e){if(t.byId("reportPreviewDialog").open){var r;if(ae[e.id]++,null===e.url&&e.graphics){r=new s({id:e.id,visible:e.visible}),r.id=e.id;var i=e.graphics;for(a=0;a<i.length;a++)g=i[a].clone(),r.add(g);return we.addLayer(r),re.push(r),i=null,void(te.length==re.length&&(t.byId("openReportBtn1").set("disabled",!1),t.byId("saveReportBtn1").set("disabled",!1),t.byId("openReportBtn2").set("disabled",!1),t.byId("saveReportBtn2").set("disabled",!1)))}if(e.url.toLowerCase().indexOf("mapserver")>-1){if(r=new v(e.url,{opacity:parseFloat(e.opacity),id:e.id,visible:e.visible}),e.visibleLayers){for(var n=[],o=0;o<e.visibleLayers.length;o++)n.push(parseInt(e.visibleLayers[o]));r.setVisibleLayers(n),n=null}}else e.url.toLowerCase().indexOf("featureserver")>-1?r=new B(e.url,{opacity:parseFloat(e.opacity),id:e.id,visible:e.visible}):alert("Unknown map layer type for "+e.url+" in "+app+"/config.xml","Data Error");r&&(le.push(_(r,"error",U)),le.push(_(r,"load",H)))}}function z(){"function"==typeof gtag&&gtag("event","widget_click",{widget_name:"Resource Report"}),document.getElementById("reportMsg1").innerHTML=je,document.getElementById("reportMsg2").innerHTML=je,t.byId("openReportBtn1").set("disabled",!0),t.byId("saveReportBtn1").set("disabled",!0),t.byId("openReportBtn2").set("disabled",!0),t.byId("saveReportBtn2").set("disabled",!0),we.setExtent(h.graphicsExtent(Ie.graphics),!0).then(function(){t.byId("reportPreviewDialog").set("title","Resource Report Preview "+Se),t.byId("reportPreviewDialog").show().then(function(){if(!oe){oe=!0;var e=we.on("extent-change",function(){we.centerAt(Te),e.remove()})}var r=[];for(te=[],re=[],ae=[],ie=0,we.removeAllLayers(),i=0;i<map.layerIds.length;i++)map_layer=map.getLayer(map.layerIds[i]),"layer_osm"==map.layerIds[i]?(osmLayer=new OpenStreetMapLayer,osmLayer.id="layer_osm",we.addLayer(osmLayer),osmLayer=null,ie++):map_layer.attributionDataUrl&&map_layer.attributionDataUrl.indexOf("OpenStreet")>-1?(osmLayer=new OpenStreetMapLayer,osmLayer.id="layer_osm",we.addLayer(osmLayer),osmLayer=null,ie++):map.layerIds[i].indexOf("layer")>-1&&1==map.getLayer(map.layerIds[i]).visibleAtMapScale&&(map.getLayer(map.layerIds[i]).url.indexOf("MapServer")>-1?basemap=new y(map.getLayer(map.layerIds[i]).url,{id:"basemap",visible:!0}):(basemap=new L(map.getLayer(map.layerIds[i]).url,{id:"basemap",visible:!0}),basemap.setStyle(map.getLayer(map.layerIds[i]).url)),"reference"==map_layer._basemapGalleryLayerType?basemap.id="reference":i>0&&(basemap.id="basemap"+i),basemap.spatialReference=map.spatialReference,basemap._basemapGalleryLayerType=map_layer._basemapGalleryLayerType,basemap.refresh(),we.addLayer(basemap),basemap=null,ie++);for(var a=map.getLayersVisibleAtScale(),i=0;i<a.length;i++)a[i].visible&&-1==a[i].id.indexOf("layer")&&(r.push(a[i]),te.push(a[i].id));for(i=0;i<r.length;i++)r[i].visible&&(ae[r[i].id]=0,q(r[i]));0==r.length&&(t.byId("openReportBtn1").set("disabled",!1),t.byId("saveReportBtn1").set("disabled",!1),t.byId("openReportBtn2").set("disabled",!1),t.byId("saveReportBtn2").set("disabled",!1))},function(){alert("Show map failed.","Warning")})},function(){alert("Set map extent failed.","Warning")})}function V(){G(),t.byId("reportPreviewDialog").hide()}function X(e,t){return e.replace(/([ :\-,\'\".;?\/()!@#$%^&*+=])/g,t)}function Y(){for(var e=0;e<Oe.length;e++){var r=t.byId(X(Oe[e].label+"Btn","_"));r.set("disabled",!0)}}function J(e){for(e=0;e<Oe.length;e++){var r=t.byId(X(Oe[e].label+"Btn","_"));r.set("disabled",!1)}}function Z(){Oe&&require(["dijit/form/Button"],function(e){var t=document.getElementById("downloadButtons");t.style.display="block";for(var r=0;r<Oe.length;r++){var a=X(Oe[r].label,"_"),i=a+"Btn",n=new e({label:Oe[r].label,id:i,onClick:function(e){var t=e.target.parentNode.innerText.replace("\n","");Q(t)}}).placeAt(t);n.set("disabled",!0)}})}function Q(e){ne=-1,e.indexOf("...")>-1&&(e=e.replace("...",""));for(var t=0;t<Oe.length;t++){var r=X(Oe[t].label,"_");if(document.getElementById(r+"Btn").innerText.indexOf("...")>-1){if(document.getElementById(r+"Btn").innerText.replace("...",""),Oe[t].label===e){ne=t;break}}else if(Oe[t].label===e){ne=t;break}}if(-1!=ne){e=X(Oe[ne].label,"_");document.getElementById(e+"Btn").innerText+="...";var a,i=[],n=[],s=[],o=[],l=Oe[ne].visOnly,d=Oe[ne].url;"/"!=d[d.length-1]&&(d+="/");for(var p=Oe[ne].ids.split(","),u=0;u<p.length;u++)if(p[u].indexOf("-")>-1){let e=p[u].split("-");for(a=parseInt(e[0]);a<parseInt(e[1])+1;a++)n.push(a)}else n.push(p[u]);var g="",f="";if(l)for(a=0;a<map.layerIds.length;a++)if(f=map.getLayer(map.layerIds[a]).url,"/"!=map.getLayer(map.layerIds[a]).url[map.getLayer(map.layerIds[a]).url.length-1]&&(f+="/"),d.toLowerCase()===f.toLowerCase()){g=map.layerIds[a];break}if(l&&""===g){var y="";for(a=0;a<map.layerIds.length;a++)y+=map.getLayer(map.layerIds[a]).url+"\n";return alert("Cannot find url: "+d+" In visible maps layers: "+y,"ResourceReportWidget.xml File Warning"),void(document.getElementById(e+"Btn").innerText=document.getElementById(e+"Btn").innerText.replace("...",""))}for(var m=0;m<n.length;m++){if(d="/"!=Oe[ne].url[Oe[ne].url.length-1]?Oe[ne].url+"/"+n[m]:Oe[ne].url+n[m],1==l){var b=!1;if(map.getLayer(g).visibleLayers.includes(parseInt(n[m]))&&(b=!0),!b)continue}o[m]=new A(d),s[m]=new E,s[m].geometry=Me,s[m].returnGeometry=!0,s[m].spatialRelationship=E.SPATIAL_REL_INTERSECTS,s[m].outFields=["*"],i.push(o[m].execute(s[m]))}i.length>0?(promises=O(i),promises.then(K),promises.otherwise($)):(alert("Download file for "+e+" was not created since the data is not currently visible.","Notice"),document.getElementById(e+"Btn").innerText=document.getElementById(e+"Btn").innerText.replace("...",""))}else alert("Download button "+e+" not found!")}function K(e){for(var t=[],r=!0,a=0;a<e.length;a++){0!=e[a].features.length&&(r=!1);for(var i=0;i<e[a].features.length;i++){var n=e[a].features[i],s=n.attributes;if("point"==n.geometry.type&&Me.contains(n.geometry)||"point"!=n.geometry.type){var o={};for(u=0;u<Oe[ne].displayfields.length;u++)"wgs84x"===Oe[ne].fields[u].toLowerCase()?o[Oe[ne].fields[u]]=n.geometry.x:"wgs84y"===Oe[ne].fields[u].toLowerCase()?o[Oe[ne].fields[u]]=n.geometry.y:o[Oe[ne].fields[u]]=s[Oe[ne].fields[u]];t.push(o),o=null}}}var l=X(Oe[ne].label,"_");if(r)alert("No data found for "+Oe[ne].label,"Notice");else{"descending"===Oe[ne].sortorder?t.sort(descendingSortMultipleArryOfObj(Oe[ne].sortfields)):t.sort(sortMultipleArryOfObj(Oe[ne].sortfields));var d="";for(u=0;u<Oe[ne].displayfields.length;u++)u==Oe[ne].displayfields.length-1?d+=Oe[ne].displayfields[u]+"\n":d+=Oe[ne].displayfields[u]+",";for(var p=0;p<t.length;p++)for(var u=0;u<Oe[ne].fields.length;u++)u==Oe[ne].fields.length-1?d+=t[p][Oe[ne].fields[u]]+"\n":d+=t[p][Oe[ne].fields[u]]+",";var g=new Blob([d],{type:"text/plain"});saveAs(g,l+".csv")}var f=document.getElementById(l+"Btn");f.innerText=f.innerText.replace("...","")}function $(e){alert("Error creating file to download. Message: "+e.message+" in ResourceReportWidget.xml at resourceReport.js, queryCSVFaultHandler")}function ee(e){return function(r){function a(e){var t,r,a,n;if(Ee.gameBoundaries&&(u+=f,De.setFontSize(16),De.setFont(b,"bold"),"polygon"===ve?De.text(Ce,u,"Location & Contact Information (at polygon center):"):De.text(Ce,u,"Location & Contact Information (at map click):"),u+=f,De.setFont(b,"normal"),De.setFontSize(y),De.text(Ce,u,"County:"),De.text(m,u,e[_].features[0].attributes.COUNTY),u+=f,De.text(Ce,u,"Game Mgt. Unit (GMU):"),De.text(m,u,e[_].features[0].attributes.GMUID.toString())),Ee.contactBoundaries&&(u+=f,De.text(Ce,u,"Sheriff Phone:"),De.text(m,u,e[L].features[0].attributes.Sheriff_FOPhone),u+=2*f,De.setFont(b,"bold"),De.text(Ce,u,"CPW"),De.setLineWidth(.5),De.line(Ce,u+1,Ce+27,u+1),u+=f,De.setFont(b,"normal"),De.setFontSize(y),De.text(Ce,u,"CPW Area:"),De.text(m,u,e[L].features[0].attributes.CDOW_Area),u+=f,De.text(Ce,u,"CPW District:"),De.text(m,u,e[L].features[0].attributes.CDOW_District),u+=f,De.text(Ce,u,"CPW Field Office:"),De.text(m,u,e[L].features[0].attributes.CDOW_FOName),u+=f,De.text(Ce,u,"CPW Field Office Address:"),De.text(m,u,e[L].features[0].attributes.CDOW_FOAddress),u+=f,De.text(Ce,u,"CPW Field Office City, Zip:"),De.text(m,u,e[L].features[0].attributes.CDOW_FOCity+", CO "+e[L].features[0].attributes.CDOW_FOZipcode),u+=f,De.text(Ce,u,"CPW Field Office Phone:"),De.text(m,u,e[L].features[0].attributes.CDOW_FOPhone),u+=2*f,De.setFont(b,"bold"),De.text(Ce,u,"BLM"),De.setLineWidth(.5),De.line(Ce,u+1,Ce+27,u+1),u+=f,De.setFont(b,"normal"),De.setFontSize(y),De.text(Ce,u,"BLM District:"),De.text(m,u,e[L].features[0].attributes.BLM_District),u+=f,De.text(Ce,u,"BLM Field Office:"),De.text(m,u,e[L].features[0].attributes.BLM_FOName),u+=f,De.text(Ce,u,"BLM Field Office Address:"),De.text(m,u,e[L].features[0].attributes.BLM_FOAddress),u+=f,De.text(Ce,u,"BLM Field Office City, Zip:"),De.text(m,u,e[L].features[0].attributes.BLM_FOCity+", CO "+e[L].features[0].attributes.BLM_FOZipcode),u+=f,De.text(Ce,u,"BLM Field Office Phone:"),De.text(m,u,e[L].features[0].attributes.BLM_FOPhone),e[L].features[0].attributes.USFS_FOName)){u+=2*f,De.setFont(b,"bold"),De.text(Ce,u,"USFS"),De.setLineWidth(.5),De.line(Ce,u+1,Ce+34,u+1),u+=f,De.setFont(b,"normal"),De.setFontSize(y),De.text(Ce,u,"Forest:"),De.text(m,u,e[L].features[0].attributes.NF_NG_NAME),u+=f,De.text(Ce,u,"Forest Field Office:");var s=De.setFontSize(y).splitTextToSize(e[L].features[0].attributes.USFS_FOName,390,{fontName:"arial",fontStyle:"normal"});De.text(m,u,s),s.length>1&&(u+=f),u+=f,De.text(Ce,u,"Forest Field Office Address:"),De.text(m,u,e[L].features[0].attributes.USFS_FOAddress),u+=f,De.text(Ce,u,"Forest Field Office City, Zip:"),De.text(m,u,e[L].features[0].attributes.USFS_FOCity+", CO "+e[L].features[0].attributes.USFS_FOZipcode),u+=f,De.text(Ce,u,"Forest Field Office Phone:"),De.text(m,u,e[L].features[0].attributes.USFS_FOPhone)}if(Ee.pointsOfInterest){t=[],r=[],a=[],n=[],ResMed=[],ResSheriff=[],ResLicAg=[],ResStPatrol=[],ResBLMOff=[],ResForOff=[],ResCPWOff=[],ResChamber=[],ResWelcome=[];for(var d=0;d<e[B].features.length;d++)feature=e[B].features[d],attr=e[B].features[d].attributes,Me.contains(feature.geometry)&&("campground"==attr.Type.toLowerCase()?"BLM"==attr.Manager?t.push({property:attr.CGPropertyName?attr.CGPropertyName:attr.CGPropertyName2,name:attr.Name,website:attr.URL1}):"CPW"==attr.Manager||"CDOW"==attr.Manager?r.push({property:attr.CGPropertyName?attr.CGPropertyName:attr.CGPropertyName2,name:attr.Name,website:attr.URL1}):"State Parks"==attr.Manager?a.push({property:attr.CGPropertyName?attr.CGPropertyName:attr.CGPropertyName2,name:attr.Name,website:attr.URL1}):"USFS"==attr.Manager&&n.push({property:attr.CGPropertyName?attr.CGPropertyName:attr.CGPropertyName2,name:attr.Name,website:attr.URL1}):"license agent"==attr.Type.toLowerCase()?ResLicAg.push({name:attr.Name,address:attr.Address,city:attr.City,phone:attr.Phone}):"medical"==attr.Type.toLowerCase()?ResMed.push({name:attr.Name,address:attr.Address,city:attr.City,phone:attr.Phone}):"sheriff"==attr.Type.toLowerCase()?ResSheriff.push({name:attr.Name,address:attr.Address,city:attr.City,phone:attr.Phone}):"state patrol"==attr.Type.toLowerCase()?ResStPatrol.push({name:attr.Name,address:attr.Address,city:attr.City,phone:attr.Phone}):"blm field office"==attr.Type.toLowerCase()?ResBLMOff.push({name:attr.Name,address:attr.Address,city:attr.City,phone:attr.Phone}):"forest service office"==attr.Type.toLowerCase()?ResForOff.push({name:attr.Name,address:attr.Address,city:attr.City,phone:attr.Phone}):"cdow office"==attr.Type.toLowerCase()||"cpw office"==attr.Type.toLowerCase()?ResCPWOff.push({name:attr.Name,address:attr.Address,city:attr.City,phone:attr.Phone}):"chamber of commerce"==attr.Type.toLowerCase()?ResChamber.push({name:attr.Name,address:attr.Address,city:attr.City,phone:attr.Phone}):"welcome center"==attr.Type.toLowerCase()&&ResWelcome.push({name:attr.Name,address:attr.Address,city:attr.City,phone:attr.Phone}));var g;(t.length>0||r.length>0||a.length>0||n.length>0)&&(t.sort(sortMultipleArryOfObj("property","name")),r.sort(sortMultipleArryOfObj("property","name")),a.sort(sortMultipleArryOfObj("property","name")),n.sort(sortMultipleArryOfObj("property","name")),l(),u=Fe+14,De.addPage(),De.setFontSize(16),De.setFont(b,"bold"),De.text(Ce,u,"Campsites"+xe+":"),De.setFontSize(y),u+=2*f,g=[],g.push({displayname:"Property",field:"property",width:200}),g.push({displayname:"Name",field:"name",width:200}),g.push({displayname:"Website",field:"website",width:Pe-400}),o("BLM",t,g),o("CPW",r,g),o("State Parks",a,g),o("USFS",n,g)),(ResChamber.length>0||ResBLMOff.length>0||ResCPWOff.length>0||ResForOff.length>0||ResLicAg.length>0||ResMed.length>0||ResSheriff.length>0||ResStPatrol.length>0||ResWelcome.length>0)&&(ResMed.sort(sortMultipleArryOfObj("city","name")),ResSheriff.sort(sortMultipleArryOfObj("city","name")),ResLicAg.sort(sortMultipleArryOfObj("city","name")),ResStPatrol.sort(sortMultipleArryOfObj("city","name")),ResBLMOff.sort(sortMultipleArryOfObj("city","name")),ResForOff.sort(sortMultipleArryOfObj("city","name")),ResCPWOff.sort(sortMultipleArryOfObj("city","name")),ResChamber.sort(sortMultipleArryOfObj("city","name")),ResWelcome.sort(sortMultipleArryOfObj("city","name")),l(),u=Fe+14,De.addPage(),De.setFontSize(16),De.setFont(b,"bold"),De.text(Ce,u,"Information resources"+xe+":"),u+=2*f,g=null,g=[],g.push({displayname:"Name",field:"name",width:(Pe-220)/2}),g.push({displayname:"Address",field:"address",width:(Pe-220)/2}),g.push({displayname:"City",field:"city",width:120}),g.push({displayname:"Phone",field:"phone",width:100}),o("Chamber of Commerce",ResChamber,g),o("BLM Office",ResBLMOff,g),o("CPW Office",ResCPWOff,g),o("Forest Service Office",ResForOff,g),o("License Agent",ResLicAg,g),o("Medical",ResMed,g),o("Sheriff",ResSheriff,g),o("State Patrol",ResStPatrol,g),o("Welcome Center",ResWelcome,g))}Ae.length>0?(Ee.gameBoundaries||Ee.contactBoundaries||Ee.pointsOfInterest?(l(),u=Fe+14,De.addPage()):u+=f,i(e)):(l(),p())}function i(e){function t(e){var t=0;Ee.gameBoundaries&&t++,Ee.contactBoundaries&&t++,Ee.pointsOfInterest&&t++,ge=0;for(var a=0;a<Ae.length;a++){if(Ae[a].database&&""!=Ae[a].database){createMultiXMLhttpRequest();for(var i=Ae[a].keyField,n="",s=0;s<e[t].features.length;s++)e[t].features[s].attributes[i]&&""!=e[t].features[0].attributes[i]&&(0==s?n=e[t].features[s].attributes[i]:n+=","+e[t].features[s].attributes[i]);if(""==n){if(ge++,_e==ge)return void r(e);t++;continue}var o=Ae[a].database+"?v="+ndisVer+"&key="+n;XMLHttpRequestObjects[index].open("POST",o,!0),XMLHttpRequestObjects[index].onreadystatechange=function(t){return function(){if(4==XMLHttpRequestObjects[t].readyState)if(200==XMLHttpRequestObjects[t].status){for(var a,i=createXMLdoc(XMLHttpRequestObjects[t]),n=-1,s=0;s<Ae.length;s++){var l=!1;if(e[s].features.length==i.getElementsByTagName("NewDataSet").length&&i.getElementsByTagName(Ae[s].keyField).length>0){for(var d=[],p=0;p<e[s].features.length;p++)i.getElementsByTagName("NewDataSet")[p].getElementsByTagName(Ae[s].keyField)[0]?d.push(i.getElementsByTagName("NewDataSet")[p].getElementsByTagName(Ae[s].keyField)[0].childNodes[0].nodeValue):d.push("undefined");for(l=!0,p=0;p<e[s].features.length;p++)if("undefined"!=d[p]&&d[p]!=e[s].features[p].attributes[Ae[s].keyField]){l=!1;break}}if(l){n=s;break}}if(-1==n)return void alert("Cannot find index for the XMLHttpRequest in javascript/resourceReport.js tableQuery(). ","Code Error");if(ge++,i.childNodes[0].innerHTML&&i.childNodes[0].innerHTML.indexOf("error")>-1)return alert("Resource report error in database lookup. URL="+o+". "+i.childNodes[0].innerHTML,"Data Error"),void(ge==_e&&r(e));if(i.childNodes[0].textContent&&i.childNodes[0].textContent.indexOf("error")>-1)return alert("Resource report error in database lookup. URL="+o+". "+i.childNodes[0].textContent,"Data Error"),void(ge==_e&&r(e));for(s=0;s<i.getElementsByTagName("NewDataSet").length;s++){var u=i.getElementsByTagName("NewDataSet")[s];if(0!=u.getElementsByTagName(Ae[n].keyField).length){if(u.getElementsByTagName(Ae[n].keyField)[0].childNodes[0].nodeValue!=e[n].features[s].attributes[Ae[n].keyField]&&alert("Resource report error in database lookup. Key fields do not match. "+u.getElementsByTagName(Ae[n].keyField)[0].childNodes[0].nodeValue+" != "+e[n].features[s].attributes[Ae[n].keyField],"Data Error"),Ae[n].one2one_fields&&""!=Ae[n].one2one_fields)for(a=0;a<Ae[n].one2one_fields.length;a++)u.getElementsByTagName(Ae[n].one2one_fields[a])[0]&&u.getElementsByTagName(Ae[n].one2one_fields[a])[0].childNodes[0]&&""!=u.getElementsByTagName(Ae[n].one2one_fields[a])[0].childNodes[0].nodeValue&&(e[n].features[s].attributes[Ae[n].one2one_fields[a]]=u.getElementsByTagName(Ae[n].one2one_fields[a])[0].childNodes[0].nodeValue.toString());if(Ae[n].one2many_fields&&""!=Ae[n].one2many_fields)for(a=0;a<Ae[n].one2many_fields.length;a++){for(var g=[],f=0;f<u.getElementsByTagName(Ae[n].filename).length;f++){var y=u.getElementsByTagName(Ae[n].filename)[f];y.getElementsByTagName(Ae[n].one2many_fields[a])[0]&&y.getElementsByTagName(Ae[n].one2many_fields[a])[0].childNodes[0]&&""!=y.getElementsByTagName(Ae[n].one2many_fields[a])[0].childNodes[0].nodeValue&&g.push(y.getElementsByTagName(Ae[n].one2many_fields[a])[0].childNodes[0].nodeValue.toString())}g.sort();for(var m=0;m<g.length;m++)0==m?e[n].features[s].attributes[Ae[n].one2many_fields[a]]="* "+g[m]:e[n].features[s].attributes[Ae[n].one2many_fields[a]]+="\n* "+g[m];g=null}}}_e==ge&&r(e)}else 404==XMLHttpRequestObjects[t].status?(alert("Resource Report database lookup failed. Too many resources found. Try a smaller area. Status 404: file not found or not able to process.","Warning"),ge==_e&&r(e),hideLoading()):(alert("Resource Report database lookup failed for URL="+XMLHttpRequestObjects[t].responseURL+". (Note IE does not report the URL please use Chrome or Firefox.) Make sure it exists and does not have errors. Must be on the same machine. Edit "+app+"/ResourceReportWidget.xml.","Data Error"),ge==_e&&r(e),hideLoading())}}(index),XMLHttpRequestObjects[index].send()}t++}}function r(e){var t=0;Ee.gameBoundaries&&t++,Ee.contactBoundaries&&t++,Ee.pointsOfInterest&&t++;for(var r=0;r<Ae.length;r++){Ae[r].title&&""!=Ae[r].title&&(l(),u=Fe+14,De.addPage(),De.setFontSize(16),De.setFont(b,"bold"),"list"===Ae[r].type?"polygon"===ve?De.text(Ce,u,Ae[r].title.replace("_distance_",de)+" (at polygon center)"):"point"===ve&&De.text(Ce,u,Ae[r].title.replace("_distance_",de)+" (at map click)"):De.text(Ce,u,Ae[r].title.replace("_distance_",de)),De.setFontSize(y),De.setFont(b,"normal"),u+=2*f);for(var a=[],i=[],n=0;n<Ae[r].displayfields.length;n++)i[n]=Ae[r].displayfields[n];for(var d=0;d<e[t].features.length;d++)if(feature=e[t].features[d],attr=feature.attributes,"point"==feature.geometry.type&&Me.contains(feature.geometry)||"point"!=feature.geometry.type){var g={};for(n=0;n<Ae[r].displayfields.length;n++)if(!i[n]&&attr[Ae[r].fields[n]]||attr[Ae[r].fields[n]]&&i[n].length<attr[Ae[r].fields[n]].toString().length)if(attr[Ae[r].fields[n]].toString().indexOf("\n")>-1)for(var m=attr[Ae[r].fields[n]].toString().split("\n"),c=0;c<m.length;c++)(!i[n]||i[n].length<m[c].length)&&(i[n]=m[c]);else i[n]=attr[Ae[r].fields[n]].toString();if(Ae[r].where_field&&""!=Ae[r].where_field){var h,v;switch("number"==Ae[r].where_type.toLowerCase()?(h=parseFloat(Ae[r].where_value),v=parseFloat(attr[Ae[r].where_field])):(h=Ae[r].where_value.toLowerCase(),v=attr[Ae[r].where_field].toLowerCase()),Ae[r].where_inequality){case"equal":if(v==h){for(n=0;n<Ae[r].displayfields.length;n++)g[Ae[r].fields[n]]=attr[Ae[r].fields[n]];a.push(g),g=null}break;case"not_equal":if(v!=h){for(n=0;n<Ae[r].displayfields.length;n++)g[Ae[r].fields[n]]=attr[Ae[r].fields[n]];a.push(g),g=null}break;case"less_than":if(v<h){for(n=0;n<Ae[r].displayfields.length;n++)g[Ae[r].fields[n]]=attr[Ae[r].fields[n]];a.push(g),g=null}break;case"greater_than":if(v>h){for(n=0;n<Ae[r].displayfields.length;n++)g[Ae[r].fields[n]]=attr[Ae[r].fields[n]];a.push(g),g=null}break;default:alert("Error in "+app+"/ResourceReportWidget.xml file in report tag, id="+Ae[r].id+" where_inequality must be: equal, not_equal, less_than, or greater_than.","Data Error")}}else{for(n=0;n<Ae[r].displayfields.length;n++)g[Ae[r].fields[n]]=attr[Ae[r].fields[n]];a.push(g),g=null}}var B=0,L=200;for(n=0;n<i.length;n++)i[n]=10+Math.round(De.getStringUnitWidth(i[n])*y/De.internal.scaleFactor),i[n]>L&&(i[n]=L),B+=i[n];var R=0;if(Pe>B){var w=Math.round((Pe-B)/i.length);for(n=0;n<i.length;n++)i[n]+=w,R+=i[n];R!=Pe&&(i[0]+=Pe-R)}else if(Pe<B){var I=Pe-B;for(n=0;n<i.length;n++)i[n]+=Math.round(i[n]/B*I),R+=i[n];R!=Pe&&(i[0]+=Pe-R)}var x=[];for(n=0;n<Ae[r].displayfields.length;n++)x.push({displayname:Ae[r].displayfields[n],field:Ae[r].fields[n],width:i[n]});a.length>0&&("descending"===Ae[r].sortorder?a.sort(descendingSortMultipleArryOfObj(Ae[r].sortfields)):a.sort(sortMultipleArryOfObj(Ae[r].sortfields)),"list"===Ae[r].type?s(Ae[r].subtitle,a,x):o(Ae[r].subtitle,a,x)),t++,i=null,x=null}l(),p()}if(De.setFontSize(16),De.setFont(b,"bold"),"list"===Ae[0].type?"polygon"===ve?De.text(Ce,u,Ae[0].title.replace("_distance_",de)+" (at polygon center)"):"point"===ve&&De.text(Ce,u,Ae[0].title.replace("_distance_",de)+" (at map click)"):De.text(Ce,u,Ae[0].title.replace("_distance_",de)),De.setFontSize(y),De.setFont(b,"normal"),Ae[0].title="",u+=2*f,_e>0){for(index=0;XMLHttpRequestObjects.length>0;)XMLHttpRequestObjects.pop();t(e)}else r(e)}function n(e){alert("Error message: "+e.message+" in ResourceReportWidget.xml at resourceReport.js, queryFaultHandler"),document.getElementById("reportMsg1").innerHTML="",document.getElementById("reportMsg2").innerHTML=""}function s(e,t,r){""!==e&&(De.setFont(b,"bold"),De.setFontSize(y),De.myText(Ce,u,e,{underline:!0}),u+=f),De.setFont(b,"normal");for(var a=0;a<r.length;a++)r[a].displayname&&(De.text(Ce,u,r[a].displayname+":"),De.text(m,u,t[0][r[a].field].toString()),u+=f);u+=f}function o(e,r,a){function i(){""!==e&&(De.setFont(b,"bold"),De.setFontSize(y),De.myText(Ce,u,e,{underline:!0}),u+=5),De.setFillColor(204,204,204),De.setDrawColor(0),De.rect(Ce,u,Pe,o,"FD");var t=Ce+4;De.setFont(b,"normal"),u+=f;for(var r=0;r<a.length;r++)a[r].displayname&&De.text(t,u,a[r].displayname),t+=a[r].width,r<a.length-1&&De.line(t-4,u-f,t-4,u+6);u+=o}try{var n,s;if(0==r.length)return;var o=20,d=[],p=[],g=[]
;for(g[0]=Ce,n=0;n<r.length;n++)for(d[n]=[],p[n]=1,s=0;s<a.length;s++)r[n][a[s].field]?(""!=r[n][a[s].field]?d[n][s]=De.setFontSize(y).splitTextToSize(r[n][a[s].field].toString(),a[s].width-8,{fontName:"arial",fontStyle:"normal"}):d[n][s]="",d[n][s].length>p[n]&&(p[n]=d[n][s].length)):d[n][s]="",0==n&&s+1<a.length&&(g[s+1]=g[s]+a[s].width);for(u+5+o+f*p[0]+o>ke-f&&(l(),u=Fe+14,De.addPage()),i(),n=0;n<r.length;n++){for(s=0;s<a.length;s++)0==s&&De.line(g[s],u-f,g[s],u+f*(p[n]-1)+o-f),De.text(g[s]+4,u,d[n][s]),De.line(g[s]+a[s].width,u-f,g[s]+a[s].width,u+f*(p[n]-1)+o-f);De.line(Ce,u+f*(p[n]-1)+o-f,Pe+Ce,u+f*(p[n]-1)+o-f),u+=f*p[n]+o-f,n<r.length-1&&u+f*p[n+1]+o-f>=ke-f&&(l(),u=Fe+14,De.addPage(),-1==e.indexOf("Continued")&&(e+=" - Continued"),i())}u+=f,d=null,g=null,p=null}catch(r){alert("Resource report error while creating table for "+e+". "+r.message,"Code Error",r),t.byId("openReportBtn1").set("disabled",!1),t.byId("saveReportBtn1").set("disabled",!1),t.byId("openReportBtn2").set("disabled",!1),t.byId("saveReportBtn2").set("disabled",!1)}}function l(){De.setFontSize(10),De.setFont(b,"normal"),De.text(368,ke-f,"page "+g),g++,De.setFontSize(y)}function d(){De.setFontSize(5),De.setFont(b,"normal"),De.text(Pe+Ce-30,ke-7,"page "+g),De.setFontSize(y)}function p(){function e(e){function r(){for(var e=De.output(),r=new ArrayBuffer(e.length),a=new Uint8Array(r),i=0;i<e.length;i++)a[i]=e.charCodeAt(i);var n=new Blob([a],{type:"application/pdf",encoding:"raw"});saveAs(n,"AtlasReport.pdf"),n=null,r=null,a=null,e=null,t.byId("openReportBtn1").set("disabled",!1),t.byId("saveReportBtn1").set("disabled",!1),t.byId("openReportBtn2").set("disabled",!1),t.byId("saveReportBtn2").set("disabled",!1)}function a(){var e=De.output("datauristring"),r="<iframe width='100%' height='100%' referrerPolicy='origin' src='"+e+"'></iframe>",a=window.open();if(!a)return alert("Failed to open PDF. Make sure popups are allowed.","Warning"),t.byId("openReportBtn1").set("disabled",!1),t.byId("saveReportBtn1").set("disabled",!1),t.byId("openReportBtn2").set("disabled",!1),t.byId("saveReportBtn2").set("disabled",!1),document.getElementById("reportMsg1").innerHTML="",void(document.getElementById("reportMsg2").innerHTML="");a.document.open(),a.document.write(r),a.document.title="Atlas Report",a.document.close(),t.byId("openReportBtn1").set("disabled",!1),t.byId("saveReportBtn1").set("disabled",!1),t.byId("openReportBtn2").set("disabled",!1),t.byId("saveReportBtn2").set("disabled",!1),document.getElementById("reportMsg1").innerHTML="",document.getElementById("reportMsg2").innerHTML=""}var i=new Image;i.onerror=function(){document.getElementById("reportMsg1").innerHTML=je,document.getElementById("reportMsg2").innerHTML=je,alert("Resource report cannot load image: "+i.src,"Code Error"),i=null,t.byId("openReportBtn1").set("disabled",!1),t.byId("saveReportBtn1").set("disabled",!1),t.byId("openReportBtn2").set("disabled",!1),t.byId("saveReportBtn2").set("disabled",!1)},i.onload=function(){try{De.addImage(i,"JPEG",0,0,792,612),i=null,d(),"save"==He?(r(),document.getElementById("reportMsg1").innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Downloaded PDF",document.getElementById("reportMsg2").innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Downloaded PDF"):navigator.sayswho.indexOf("IE")>-1|navigator.sayswho.indexOf("Edge")>-1?(r(),document.getElementById("reportMsg1").innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Download or Open PDF in pop-up. Make sure pop-ups are enabled.",document.getElementById("reportMsg2").innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Download or Open PDF in pop-up. Make sure pop-ups are enabled."):(a(),document.getElementById("reportMsg1").innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Opening PDF in pop-up. Make sure pop-ups are enabled.",document.getElementById("reportMsg2").innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Opening PDF in pop-up. Make sure pop-ups are enabled.")}catch(e){document.getElementById("reportMsg1").innerHTML=je,document.getElementById("reportMsg2").innerHTML=je,alert("Resource report generation Error in javascript/resourceReport.js printResult() img.onload. "+e.message,"Code Error",e)}},i.src=e.url,window.location.hostname.indexOf("ndis-2020-dev")>-1?(i.src="assets/images/testmap.jpg",alert("The image in the pdf is a placeholder. <a href='"+e.url+"' target='pdf_image'>Here is a link to the true image.</a>","Note for Test Site")):window.location.hostname.toLowerCase().indexOf("gisweb")>-1?i.src=e.url.replace("https","http"):-1===printServiceUrl.indexOf(window.location.hostname)&&alert("The fastmap url machine name or alias must match the printserviceurl in the ResourceReport.xml file.","Data Error")}function r(e){document.getElementById("reportMsg1").innerHTML=je,document.getElementById("reportMsg2").innerHTML=je,e.details?alert("Error creating resource report map: "+e+" Details: "+e.details,"Code Error",e):alert("Error printing resource report: "+e,"Code Error",e)}try{document.getElementById("reportMsg1").innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src='assets/images/loading.gif' width='20px' height='20px'/> Generating map image for report",document.getElementById("reportMsg2").innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src='assets/images/loading.gif' width='20px' height='20px'/> Generating map image for report",De.addPage();var a=new I,i=new w;i.exportOptions={dpi:Ne,outputSize:[3150,2400]},i.layout="Letter ANSI A Landscape",i.format="JPG",i.preserveScale=!0,i.showAttribution=!1,i.layoutOptions={legendLayers:[],titleText:be,authorText:he,customTextElements:[{Subtitle:ce}]},a.map=we,a.template=i,R.execute(printServiceUrl,a).then(e).catch(r)}catch(e){alert("Error creating map for resource report. "+e.message,"Code Error",e)}}if(Te){t.byId("openReportBtn1").set("disabled",!0),t.byId("saveReportBtn1").set("disabled",!0),t.byId("openReportBtn2").set("disabled",!0),t.byId("saveReportBtn2").set("disabled",!0),document.getElementById("reportMsg1").innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src='assets/images/loading.gif' width='20px' height='20px'/> Generating tables for report...",document.getElementById("reportMsg2").innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src='assets/images/loading.gif' width='20px' height='20px'/> Generating tables for report...",He=e,ke=612-Fe,De=null,De=new jsPDF("landscape","pt","letter"),De.onerror=function(){document.getElementById("reportMsg1").innerHTML=je,document.getElementById("reportMsg2").innerHTML=je,alert("Error generating PDF for resource report.","Code Error"),t.byId("openReportBtn1").set("disabled",!1),t.byId("saveReportBtn1").set("disabled",!1),t.byId("openReportBtn2").set("disabled",!1),t.byId("saveReportBtn2").set("disabled",!1)};var u=Fe+20,g=1,f=14,y=12,m=300,b="arial";De.setProperties({title:me,author:"Colorado Parks and Wildlife",keywords:"hunting, fishing, atlas, ndis"}),De.setFontSize(22),De.setFont(b,"bold"),De.text(Ce,u,me),u+=22,De.setFont(b,"normal"),De.setFontSize(y);var c={Jan:"January",Feb:"February",Mar:"March",Apr:"April",May:"May",Jun:"June",Jul:"July",Aug:"August",Sep:"September",Oct:"October",Nov:"November",Dec:"December"};Ge=new Date,Ge=Ge.toDateString(),Ge="0"==Ge.substr[8]?c[Ge.substr(4,3)]+" "+Ge.substr(9,1)+","+Ge.substr(Ge.length-5,Ge.length):c[Ge.substr(4,3)]+" "+Ge.substr(8,2)+","+Ge.substr(Ge.length-5,Ge.length),De.text(Ce,u,Ge),u+=f,"point"===ve?De.text(Ce,u,"X/Y at map click:"):"polygon"===ve&&De.text(Ce,u,"X/Y at polygon center:");var h=x.webMercatorToGeographic(Te);De.text(m,u,h.y.toFixed(5)+" N, "+-1*h.x.toFixed(5)+" W"),u+=f;var v,B,L,_,T=[],M=[],S=[],C=0;Ee.pointsOfInterest&&(M[C]=new A(Ee.pointsOfInterest.url),T[C]=new E,T[C].geometry=Me,T[C].returnGeometry=!0,T[C].spatialRelationship=E.SPATIAL_REL_INTERSECTS,T[C].outFields=["*"],S.push(M[C].execute(T[C])),B=C,C++),Ee.contactBoundaries&&(T[C]=new E,M[C]=new A(Ee.contactBoundaries.url),T[C].returnGeometry=!0,T[C].spatialRelationship=E.SPATIAL_REL_INTERSECTS,T[C].outFields=["*"],T[C].geometry=Te,S.push(M[C].execute(T[C])),L=C,C++),Ee.gameBoundaries&&(T[C]=new E,M[C]=new A(Ee.gameBoundaries.url),T[C].returnGeometry=!0,T[C].spatialRelationship=E.SPATIAL_REL_INTERSECTS,T[C].outFields=["*"],T[C].geometry=Te,S.push(M[C].execute(T[C])),_=C,C++);for(var F=0;F<Ae.length;F++)C,M[C]=new A(Ae[F].url),T[C]=new E,"list"===Ae[F].type?T[C].geometry=Te:T[C].geometry=Me,T[C].returnGeometry=!0,T[C].spatialRelationship=E.SPATIAL_REL_INTERSECTS,T[C].outFields=["*"],S.push(M[C].execute(T[C])),C++;S.length>0&&(v=O(S),v.then(a),v.otherwise(n))}}}var te,re,ae,ie,ne,se,oe=!1,le=[];try{var de,pe,ue,ge,fe,ye,me,be,ce,he,ve,Be,Le,Re,we,Ie,xe="",Ee={pointsOfInterest:null,contactBoundaries:null,gameBoundaries:null},Ae=[],Oe=[],_e=0,Te=null,Me=null,Se="",Ce=18,Fe=18,Ne=300,Pe=792-2*Ce,ke=612-Fe,De=new jsPDF("landscape","pt","letter"),je="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Adjust map boundaries. Click Open/Save Report when ready.",We=new s;We.id="reportGraphicsLayer1",map.addLayer(We);var Ge,He,Ue=createXMLhttpRequest(),qe=app+"/ResourceReportWidget.xml?v="+ndisVer;Ue.onerror=function(){alert("Error loading "+app+"/ResourceReportWidget.xml","Data Error")},Ue.onreadystatechange=function(){if(4==Ue.readyState)if(200==Ue.status){var e=createXMLdoc(Ue);e||alert("Missing "+app+"/ResourceReportWidget.xml file.","Data Error"),e.getElementsByTagName("reports")[0]&&alert("Warning: The reports tag has been renamed 'custom_reports'. Please fix this in "+qe,"Data Error");var t=e.getElementsByTagName("custom_reports")[0]&&e.getElementsByTagName("custom_reports")[0].getElementsByTagName("report")?e.getElementsByTagName("custom_reports")[0].getElementsByTagName("report"):null;e.getElementsByTagName("reportserviceurl")[0]&&alert("reportserviceurl tag is no longer used in ResourceReportWidget.xml"),e.getElementsByTagName("printserviceurl")[0]&&alert("printserviceurl tag is no longer used in ResourceReportWidget.xml"),fe=e.getElementsByTagName("basemapurl")[0]?e.getElementsByTagName("basemapurl")[0].firstChild.nodeValue:C("basemapurl tag"),me=e.getElementsByTagName("reporttitle")[0]?e.getElementsByTagName("reporttitle")[0].firstChild.nodeValue:C("reporttitle tag"),ve=e.getElementsByTagName("selectby")[0]?e.getElementsByTagName("selectby")[0].firstChild.nodeValue:"point";var r,a=e.getElementsByTagName("download_buttons")[0]&&e.getElementsByTagName("download_buttons")[0].getElementsByTagName("button")?e.getElementsByTagName("download_buttons")[0].getElementsByTagName("button"):null;if("polygon"===ve)Be="reportPolyBtn",document.getElementById("polyReport").style.display="block",document.getElementById("pointReport").style.display="none",de="";else if("point"===ve){Be="reportPtBtn";var n=e.getElementsByTagName("buffer")[0]?e.getElementsByTagName("buffer")[0]:C("buffer tag");de=n.getAttribute("default")?n.getAttribute("default"):C("default attribute of the buffer tag"),pe=n.getAttribute("list")?n.getAttribute("list").split(","):C("list attribute of the buffer tag"),ue=n.getAttribute("unitslabel")?n.getAttribute("unitslabel"):C("unitslabel attribute of the buffer tag"),document.getElementById("pointReport").style.display="block",document.getElementById("polyReport").style.display="none"}else alert("Error in ResourceReportWidget.xml file. selectby tag must be point or polygon. If tag is missing 'point' will be assumed.");if(e.getElementsByTagName("pointsofinterest")[0]&&(Ee.pointsOfInterest={url:e.getElementsByTagName("pointsofinterest")[0].getAttribute("url"),name:e.getElementsByTagName("pointsofinterest")[0].getAttribute("name")}),e.getElementsByTagName("contactinfo")[0]&&(Ee.contactBoundaries={url:e.getElementsByTagName("contactinfo")[0].getAttribute("url"),name:e.getElementsByTagName("contactinfo")[0].getAttribute("name")}),e.getElementsByTagName("gameunits")[0]&&(Ee.gameBoundaries={url:e.getElementsByTagName("gameunits")[0].getAttribute("url"),name:e.getElementsByTagName("gameunits")[0].getAttribute("name")}),t)for(i=0;i<t.length;i++)r={url:t[i].getAttribute("url")?t[i].getAttribute("url"):C("report tag, url attribute"),id:t[i].getAttribute("id")?t[i].getAttribute("id"):C("report tag, id attribute"),type:t[i].getAttribute("type")?t[i].getAttribute("type"):C("report tag, type attribute"),title:t[i].getAttribute("title")?t[i].getAttribute("title"):"",subtitle:t[i].getAttribute("subtitle")?t[i].getAttribute("subtitle"):"",displayfields:t[i].getAttribute("displayfields")?t[i].getAttribute("displayfields").split(","):C("report tag, displayfields attribute"),fields:t[i].getAttribute("fields")?t[i].getAttribute("fields").split(","):C("report tag, fields attribute"),where_field:t[i].getAttribute("where_field")?t[i].getAttribute("where_field"):"",where_inequality:t[i].getAttribute("where_inequality")?t[i].getAttribute("where_inequality"):"",where_value:t[i].getAttribute("where_value")?t[i].getAttribute("where_value"):"",where_type:t[i].getAttribute("where_type")?t[i].getAttribute("where_type"):"",sortfields:t[i].getAttribute("sortfields")?t[i].getAttribute("sortfields").split(","):t[i].getAttribute("fields").split(","),sortorder:t[i].getAttribute("sortorder")?t[i].getAttribute("sortorder"):"ascending",keyField:t[i].getAttribute("key")?t[i].getAttribute("key"):null,database:t[i].getAttribute("database")?t[i].getAttribute("database"):null,filename:t[i].getAttribute("filename")?t[i].getAttribute("filename"):null,one2one_fields:t[i].getAttribute("one2one_fields")?t[i].getAttribute("one2one_fields").split(","):null,one2one_display:t[i].getAttribute("one2one_display")?t[i].getAttribute("one2one_display").split(","):t[i].getAttribute("one2one_fields")?t[i].getAttribute("one2one_fields").split(","):null,one2many_fields:t[i].getAttribute("one2many_fields")?t[i].getAttribute("one2many_fields").split(","):null,one2many_display:t[i].getAttribute("one2many_display")?t[i].getAttribute("one2many_display").split(","):t[i].getAttribute("one2many_fields")?t[i].getAttribute("one2many_fields").split(","):null},Ae.push(r),r.database&&""!=r.database&&_e++,r=null;if(a){for(i=0;i<a.length;i++)r={visOnly:!!a[i].getAttribute("onlyIfVisible")&&a[i].getAttribute("onlyIfVisible")==="true".toLowerCase(),url:a[i].getAttribute("url")?a[i].getAttribute("url"):C("button tag, url attribute"),ids:a[i].getAttribute("ids")?a[i].getAttribute("ids"):C("button tag, ids attribute"),label:a[i].getAttribute("label")?a[i].getAttribute("label"):C("button tag, label attribute"),displayfields:a[i].getAttribute("displayfields")?a[i].getAttribute("displayfields").split(","):C("report tag, displayfields attribute"),fields:a[i].getAttribute("fields")?a[i].getAttribute("fields").split(","):C("report tag, fields attribute"),where_field:a[i].getAttribute("where_field")?a[i].getAttribute("where_field"):"",where_inequality:a[i].getAttribute("where_inequality")?a[i].getAttribute("where_inequality"):"",where_value:a[i].getAttribute("where_value")?a[i].getAttribute("where_value"):"",where_type:a[i].getAttribute("where_type")?a[i].getAttribute("where_type"):"",sortfields:a[i].getAttribute("sortfields")?a[i].getAttribute("sortfields").split(","):a[i].getAttribute("fields").split(","),sortorder:a[i].getAttribute("sortorder")?a[i].getAttribute("sortorder"):"ascending",keyField:a[i].getAttribute("key")?a[i].getAttribute("key"):null,database:a[i].getAttribute("database")?a[i].getAttribute("database"):null,filename:a[i].getAttribute("filename")?a[i].getAttribute("filename"):null,one2one_fields:a[i].getAttribute("one2one_fields")?a[i].getAttribute("one2one_fields").split(","):null,one2one_display:a[i].getAttribute("one2one_display")?a[i].getAttribute("one2one_display").split(","):a[i].getAttribute("one2one_fields")?a[i].getAttribute("one2one_fields").split(","):null,one2many_fields:a[i].getAttribute("one2many_fields")?a[i].getAttribute("one2many_fields").split(","):null,one2many_display:a[i].getAttribute("one2many_display")?a[i].getAttribute("one2many_display").split(","):a[i].getAttribute("one2many_fields")?a[i].getAttribute("one2many_fields").split(","):null},Oe.push(r),r.database&&""!=r.database&&_e++,r=null;Z()}be=e.getElementsByTagName("title")[0]?e.getElementsByTagName("title")[0].firstChild.nodeValue:C("title tag"),ce=e.getElementsByTagName("subtitle")[0]?e.getElementsByTagName("subtitle")[0].firstChild.nodeValue:C("subtitle tag"),he=e.getElementsByTagName("disclaimer")[0]?e.getElementsByTagName("disclaimer")[0].firstChild.nodeValue:C("disclaimer tag"),S()}else 404===Ue.status&&alert("File: "+app+"/ResourceReportWidget.xml not found.","Data Error")},Ue.open("GET",qe,!0),Ue.send(null),se=jsPDF.API,se.myText=function(e,t,r,a,i){a=a||{};var n,s=this.internal.getFontSize();n=i||this.internal.pageSize.width,txtWidth=this.getStringUnitWidth(r)*s/this.internal.scaleFactor,"center"==a.align?(e+=(n-txtWidth)/2,this.text(r,e,t)):"right"==a.align?(e+=n-(txtWidth+3),this.text(r,e,t)):1==a.underline&&(this.text(r,e,t),this.line(e,t+1,e+1.15*txtWidth,t+1))}}catch(e){alert(e.message+" in javascript/resourceReport.js reportInit.","Code Error",e)}})}