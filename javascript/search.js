var searchtoolbar;function searchInit(){try{var fishSpeciesGraphicalName="Fish species in known fishing spots";document.getElementById("searchLoadingImg").style.display="block";var configFile=app+"/SearchWidget.xml?v="+ndisVer;var xmlhttp=createXMLhttpRequest();xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4&&xmlhttp.status===200){var xmlDoc=createXMLdoc(xmlhttp);try{require(["dojo/dom","dijit/registry","dojo/_base/lang","dojo/mouse","dojo/_base/Color","dojo/store/Memory","dijit/form/ComboBox","dijit/form/Select","esri/toolbars/draw","esri/request","esri/tasks/query","esri/tasks/QueryTask","esri/graphic","esri/layers/GraphicsLayer","esri/urlUtils","esri/geometry/Point","esri/symbols/PictureMarkerSymbol","esri/symbols/SimpleLineSymbol","esri/symbols/SimpleFillSymbol","dojo/_base/declare","dgrid/OnDemandGrid","dgrid/extensions/DijitRegistry","dojo/domReady!"],function(dom,registry,lang,mouse,Color,Memory,ComboBox,Select,Draw,esriRequest,Query,QueryTask,Graphic,GraphicsLayer,urlUtils,Point,PictureMarkerSymbol,SimpleLineSymbol,SimpleFillSymbol,declare,OnDemandGrid,DijitRegistry){try{function searchDrawEnd(event){document.getElementById("searchMsg").innerHTML="Loading...";document.getElementById("searchMsg").style.display="block";document.getElementById("searchLoadingImg").style.display="block";drawing=false;searchtoolbar.deactivate();document.getElementById("searchpoint").className="graphBtn";document.getElementById("searchpolyline").className="graphBtn";document.getElementById("searchrectangle").className="graphBtn";document.getElementById("searchpolygon").className="graphBtn";document.getElementById("clearSearchGraphics").style.display="inline-block";var geom=event.geometry;queryFeaturesGraphical(geom);}
searchtoolbar=new Draw(map,{showTooltips:true});searchtoolbar.on("draw-end",searchDrawEnd);var graphicAC;var tabHeight="300px";var tabWithGridHeight="510px";var displayNames;var queryLayer;var queryFields;var queryTitleField;var queryLinkField;var queryLinkText;var widgetIcon="assets/images/i_pin.png";var graphicsLayer=new GraphicsLayer();var graphicsHLLayer=new GraphicsLayer();var graphicPointSym=new PictureMarkerSymbol(widgetIcon,30,30);graphicsLayer.symbol=graphicPointSym;map.addLayer(graphicsLayer);var graphicPointHLSym=new PictureMarkerSymbol(widgetIcon,40,40);graphicsHLLayer.symbol=graphicPointHLSym;var graphicLineSym=new SimpleLineSymbol(SimpleLineSymbol.STYLE_SOLID,new Color([255,0,0,0.8]),2);var graphicPolySym=new SimpleFillSymbol(SimpleLineSymbol.STYLE_SOLID,graphicLineSym,new Color([255,0,0,0.1]));var graphicLineHLSym=new SimpleLineSymbol(SimpleLineSymbol.STYLE_SOLID,new Color([255,255,0,0.8]),2);var graphicPolyHLSym=new SimpleFillSymbol(SimpleLineSymbol.STYLE_SOLID,graphicLineSym,new Color([255,255,0,0.5]));map.addLayer(graphicsHLLayer);var recAC;var layers=xmlDoc.getElementsByTagName("layer");var searchObj=[];var data=[];var fsGrid;var featureStore=new Memory({data:[]});var graphicFeatureStore=new Memory({data:[]});var tabToSelect;if(xmlDoc.getElementsByTagName("selectedtab")[0].childNodes[0].nodeValue=="0")tabToSelect="text_Pane";else tabToSelect="graphic_Pane";var zoomScale=72224;if(xmlDoc.getElementsByTagName("zoomscale")[0]&&xmlDoc.getElementsByTagName("zoomscale")[0].childNodes[0].nodeValue)
zoomScale=xmlDoc.getElementsByTagName("zoomscale")[0].childNodes[0].nodeValue;for(var i=0;i<layers.length;i++){var n="unknown";if(layers[i].getElementsByTagName("name")[0]&&layers[i].getElementsByTagName("name")[0].childNodes[0].nodeValue)
n=layers[i].getElementsByTagName("name")[0].childNodes[0].nodeValue;else{showWarning("name");}
searchObj[n]={name:n,url:layers[i].getElementsByTagName("url")[0].childNodes[0]?layers[i].getElementsByTagName("url")[0].childNodes[0].nodeValue:showWarning("url"),expression:layers[i].getElementsByTagName("expression")[0].childNodes[0]?layers[i].getElementsByTagName("expression")[0].childNodes[0].nodeValue:showWarning("expression"),graphicalexpression:layers[i].getElementsByTagName("graphicalexpression")[0].childNodes[0]?layers[i].getElementsByTagName("graphicalexpression")[0].childNodes[0].nodeValue:null,searchfield:layers[i].getElementsByTagName("searchfield")[0].childNodes[0]?layers[i].getElementsByTagName("searchfield")[0].childNodes[0].nodeValue:showWarning("searchfield"),textsearchlabel:layers[i].getElementsByTagName("textsearchlabel")[0].childNodes[0]?layers[i].getElementsByTagName("textsearchlabel")[0].childNodes[0].nodeValue:showWarning("textsearchlabel"),graphicalsearchlabel:layers[i].getElementsByTagName("graphicalsearchlabel")[0].childNodes[0]?layers[i].getElementsByTagName("graphicalsearchlabel")[0].childNodes[0].nodeValue:showWarning("graphicalsearchlabel"),fields:layers[i].getElementsByTagName("fields")[0].childNodes[0]?layers[i].getElementsByTagName("fields")[0].childNodes[0].nodeValue:showWarning("fields"),displayfields:layers[i].getElementsByTagName("displayfields")[0].childNodes[0]?layers[i].getElementsByTagName("displayfields")[0].childNodes[0].nodeValue:showWarning("displayfields"),sortfield:layers[i].getElementsByTagName("sortfield")[0]&&layers[i].getElementsByTagName("sortfield")[0].childNodes[0]?layers[i].getElementsByTagName("sortfield")[0].childNodes[0].nodeValue:"none",numericsort:layers[i].getElementsByTagName("numericsort")[0]&&layers[i].getElementsByTagName("numericsort")[0].childNodes[0]?layers[i].getElementsByTagName("numericsort")[0].childNodes[0].nodeValue:"false",titlefield:layers[i].getElementsByTagName("titlefield")[0]&&layers[i].getElementsByTagName("titlefield")[0].childNodes[0]?layers[i].getElementsByTagName("titlefield")[0].childNodes[0].nodeValue:showWarning("titlefield"),linkfield:layers[i].getElementsByTagName("linkfield")[0]&&layers[i].getElementsByTagName("linkfield")[0].childNodes[0]?layers[i].getElementsByTagName("linkfield")[0].childNodes[0].nodeValue:"",linktext:layers[i].getElementsByTagName("linktext")[0]&&layers[i].getElementsByTagName("linktext")[0].childNodes[0]?layers[i].getElementsByTagName("linktext")[0].childNodes[0].nodeValue:"unknown link",searchvalues:layers[i].getElementsByTagName("searchvalues")[0]&&layers[i].getElementsByTagName("searchvalues")[0].childNodes[0]?layers[i].getElementsByTagName("searchvalues")[0].childNodes[0].nodeValue:"",lookupsearchvalues:layers[i].getElementsByTagName("lookupsearchvalues")[0]&&layers[i].getElementsByTagName("lookupsearchvalues")[0].childNodes[0]?layers[i].getElementsByTagName("lookupsearchvalues")[0].childNodes[0].nodeValue:"",lookupfilename:layers[i].getElementsByTagName("lookupsearchvalues")[0]&&layers[i].getElementsByTagName("lookupsearchvalues")[0].childNodes[0]?layers[i].getElementsByTagName("lookupfilename")[0].childNodes[0]?layers[i].getElementsByTagName("lookupfilename")[0].childNodes[0].nodeValue:showWarning("lookupfilename"):null,lookupfield:layers[i].getElementsByTagName("lookupsearchvalues")[0]&&layers[i].getElementsByTagName("lookupsearchvalues")[0].childNodes[0]?layers[i].getElementsByTagName("lookupfield")[0].childNodes[0]?layers[i].getElementsByTagName("lookupfield")[0].childNodes[0].nodeValue:showWarning("lookupfield"):null,database:layers[i].getElementsByTagName("database")[0]&&layers[i].getElementsByTagName("database")[0].childNodes[0]?layers[i].getElementsByTagName("database")[0].childNodes[0].nodeValue:null,filename:layers[i].getElementsByTagName("database")[0]&&layers[i].getElementsByTagName("database")[0].childNodes[0]?layers[i].getElementsByTagName("filename")[0].childNodes[0]?layers[i].getElementsByTagName("filename")[0].childNodes[0].nodeValue:showWarning("filename"):null,database_field:layers[i].getElementsByTagName("database")[0]&&layers[i].getElementsByTagName("database")[0].childNodes[0]?layers[i].getElementsByTagName("database_field")[0].childNodes[0]?layers[i].getElementsByTagName("database_field")[0].childNodes[0].nodeValue:showWarning("database_field"):null,database_field_type:layers[i].getElementsByTagName("database")[0]&&layers[i].getElementsByTagName("database")[0].childNodes[0]?layers[i].getElementsByTagName("database_field_type")[0].childNodes[0]?layers[i].getElementsByTagName("database_field_type")[0].childNodes[0].nodeValue:showWarning("database_field_type"):null,graphical_database:layers[i].getElementsByTagName("database")[0]&&layers[i].getElementsByTagName("database")[0].childNodes[0]?layers[i].getElementsByTagName("graphical_database")[0].childNodes[0]?layers[i].getElementsByTagName("graphical_database")[0].childNodes[0].nodeValue:null:null,graphical_filename:layers[i].getElementsByTagName("graphical_database")[0]&&layers[i].getElementsByTagName("graphical_database")[0].childNodes[0]?layers[i].getElementsByTagName("graphical_filename")[0].childNodes[0]?layers[i].getElementsByTagName("graphical_filename")[0].childNodes[0].nodeValue:showWarning("graphical_filename"):null,graphical_db_fields:layers[i].getElementsByTagName("graphical_database")[0]&&layers[i].getElementsByTagName("graphical_database")[0].childNodes[0]?layers[i].getElementsByTagName("graphical_db_fields")[0].childNodes[0]?layers[i].getElementsByTagName("graphical_db_fields")[0].childNodes[0].nodeValue:showWarning("graphical_db_fields"):null,graphical_db_displayfields:layers[i].getElementsByTagName("graphical_database")[0]&&layers[i].getElementsByTagName("graphical_database")[0].childNodes[0]?layers[i].getElementsByTagName("graphical_db_displayfields")[0].childNodes[0]?layers[i].getElementsByTagName("graphical_db_displayfields")[0].childNodes[0].nodeValue:showWarning("graphical_db_displayfields"):null,graphical_db_sort:layers[i].getElementsByTagName("graphical_database")[0]&&layers[i].getElementsByTagName("graphical_database")[0].childNodes[0]?layers[i].getElementsByTagName("graphical_db_sort")[0].childNodes[0]?layers[i].getElementsByTagName("graphical_db_sort")[0].childNodes[0].nodeValue:showWarning("graphical_db_sort"):null};function showWarning(tag){var layerName=layers[i].getElementsByTagName("name")[0]&&layers[i].getElementsByTagName("name")[0].childNodes[0]?layers[i].getElementsByTagName("name")[0].childNodes[0].nodeValue:"undefined";alert("WARNING: In SearchWidget.xml file required value missing for tag: "+tag+", in layer: "+layerName+".","Data Error");document.getElementById("searchLoadingImg").style.display="none";}
featureStore.data.push({name:searchObj[n].name,id:i});if(searchObj[n].name.toLowerCase()=="fish species")
graphicFeatureStore.data.push({name:fishSpeciesGraphicalName,id:i});else
graphicFeatureStore.data.push({name:searchObj[n].name,id:i});}
var searchTextStore=new Memory({data:[{name:"Loading..."}]});var featureTypeCombo=new Select({id:"featureType",name:"feature",store:featureStore,value:featureStore.data[0].name,sortByLabel:false,labelAttr:"name",maxHeight:-1,style:{width:"250px"},onChange:function(){updateSearchTextStore(this.attr("displayedValue"));registry.byId("searchText").reset();}},"featureType");featureTypeCombo.startup();var featureTypeGraphicCombo=new Select({id:"featureTypeGraphic",name:"feature",store:graphicFeatureStore,value:graphicFeatureStore.data[0].name,sortByLabel:false,labelAttr:"name",maxHeight:-1,style:{width:"250px"},onChange:function(){updateSearchGraphicStore(this.attr("displayedValue"));}},"featureTypeGraphic");featureTypeGraphicCombo.startup();document.getElementById("graphicfeatures").innerHTML=graphicFeatureStore.data[0].name;var searchTextCombo=new ComboBox({id:"searchText",store:searchTextStore,autoComplete:false,searchAttr:searchObj[featureStore.data[0].name].searchfield,style:{width:"250px"},hasDownArrow:true,maxHeight:195,onClick:function(){if(featureTypeCombo.attr("displayedValue")=="GMUs"&&settings.useGMUs){if((gmu=="Big Game GMU"&&searchObj["GMUs"].titlefield!=settings.elkField)||(gmu=="Bighorn GMU"&&searchObj["GMUs"].titlefield!=settings.sheepField)||(gmu=="Goat GMU"&&searchObj["GMUs"].titlefield!=settings.goatField)){this.loadAndOpenDropDown();updateSearchTextStore("GMUs");}}},onChange:function(){setSelection()},onKeyUp:function(value){if([27,33,34,37,38,39,40].indexOf(value.keyCode)>-1)return;else if([13].indexOf(value.keyCode)>-1){setSelection(this.attr('displayedValue'));return;}
updateSearchTextStore(registry.byId("featureType").attr("displayedValue"));}},"searchText").startup();var sectionStore=new Memory({idProperty:"id",data:[]});for(i=0;i<37;i++){if(i==0)sectionStore.data.push({id:"",name:""});else if(i<10)sectionStore.data.push({id:"00"+i,name:"00"+i});else sectionStore.data.push({id:"0"+i,name:"0"+i});}
var sectionCombo=new Select({id:"searchSec",labelAttr:"name",style:{width:"50px",position:"relative",left:"13px",top:"-1px"},maxHeight:158,store:sectionStore},"searchSec");sectionCombo.startup();function updateSearchTextStore(id){try{clearSelection();registry.byId("searchText").set("placeHolder","");if(id==="Township Range"){document.getElementById("searchInput1").style.display="none";document.getElementById("searchInput2").style.display="block";document.getElementById("searchTwn").value="";document.getElementById("searchRng").value="";registry.byId("searchSec").attr("value","");registry.byId("searchBtn").set("disabled",false);return;}
if(id=="GMUs"&&settings.useGMUs){if(gmu=="Big Game GMU"){searchObj[id].fields=settings.elkField+",COUNTY";searchObj[id].displayfields="GMU,County";searchObj[id].titlefield=settings.elkField;searchObj[id].searchfield=settings.elkField;searchObj[id].expression=settings.elkField+" = [value]";searchObj[id].url=settings.elkUrl;}
else if(gmu=="Bighorn GMU"){searchObj[id].fields=settings.sheepField;searchObj[id].displayfields="Bighorn Sheep GMU";searchObj[id].titlefield=settings.sheepField;searchObj[id].searchfield=settings.sheepField;searchObj[id].expression=settings.sheepField+" = UPPER('[value]')";searchObj[id].url=settings.sheepUrl;}
else{searchObj[id].fields=settings.goatField;searchObj[id].displayfields="Mountain Goat GMU";searchObj[id].titlefield=settings.goatField;searchObj[id].searchfield=settings.goatField;searchObj[id].expression=settings.goatField+" = UPPER('[value]')";searchObj[id].url=settings.goatUrl;}}
document.getElementById("searchInput1").style.display="block";document.getElementById("searchInput2").style.display="none";document.getElementById("searchLabel").innerHTML=searchObj[id].textsearchlabel+" ";if(searchObj[id].searchvalues!=""){registry.byId("searchBtn").set("disabled",true);fillSearchValues(id);return;}
else if(searchObj[id].lookupsearchvalues!=""){registry.byId("searchBtn").set("disabled",true);fillLookupSearchValues(id);return;}
var attr=id;document.getElementById("searchLoadingImg").style.display="block";registry.byId("searchBtn").set("disabled",false);esri.config.defaults.io.proxyUrl="/proxy/DotNet/proxy.ashx";var expr;var userText=registry.byId("searchText").attr("displayedValue");if(searchObj[id].expression.indexOf("= UPPER('[value]')",0)>0)
{expr=searchObj[id].expression.replace("= UPPER('[value]')","LIKE UPPER('"+userText+"%')");}
else if(searchObj[id].expression.indexOf("LIKE UPPER('%[value]%')",0)>0)
{expr=searchObj[id].expression.replace("LIKE UPPER('%[value]%')","LIKE UPPER('"+userText+"%')");}
else
{expr=searchObj[id].expression.replace("= [value]","<> -1");}
var outflds=searchObj[id].searchfield;if(attr=="GMUs"&&(searchObj[attr].displayfields=="Mountain Goat GMU"||searchObj[attr].displayfields=="Bighorn Sheep GMU")){outflds+=",HUNTING";}
esriRequest({url:searchObj[id].url+"/query",content:{where:expr,returnGeometry:false,outFields:outflds,f:"json",returnDistinctValues:true,orderByFields:searchObj[id].searchfield},handleAs:'json'}).then(function(response){try{var dataArr=[];for(var i=0;i<response.features.length;i++){if(attr=="GMUs"&&(searchObj[attr].displayfields=="Mountain Goat GMU"||searchObj[attr].displayfields=="Bighorn Sheep GMU")){if(response.features[i].attributes["HUNTING"]!="YES")continue;}
var obj={};obj[searchObj[attr].searchfield]=response.features[i].attributes[searchObj[attr].searchfield];dataArr.push(obj);}
if(attr=="GMUs"&&(searchObj[attr].displayfields=="Mountain Goat GMU"||searchObj[attr].displayfields=="Bighorn Sheep GMU")){var result=[];var letter="S";if(searchObj[attr].displayfields=="Mountain Goat GMU")letter="G";dataArr.forEach(function(item){if(item[searchObj[attr].searchfield]!="OUT")
result.push(item[searchObj[attr].searchfield].substring(1));});result.sort(function(a,b){return a-b});var gmuArr=[];dataArr=null;dataArr=[];var obj;result.forEach(function(item){obj=new Object();obj[searchObj[attr].searchfield]=letter+item;dataArr.push(obj);obj=null;});result=null;gmuArr=null;obj=null;}
var searchTextStore=new Memory({data:dataArr});var searchTextCombo=registry.byId("searchText");searchTextCombo.set("store",searchTextStore);searchTextCombo.set("searchAttr",searchObj[attr].searchfield);dataArr=null;document.getElementById("searchLoadingImg").style.display="none";}
catch(e){alert("Feature Search query error: "+e.message+" in search.js/updateSearchTextStore query response. response="+response,"Code Error",e);document.getElementById("searchLoadingImg").style.display="none";}},function(err){document.getElementById("searchLoadingImg").style.display="none";alert("Feature Search query error: looking up feature type suggestions in javascript/search.js updateSearchTextStore(). "+
searchObj[attr].url+"/query?where="+expr+"&outfields="+searchObj[attr].searchfield
+" "+err.message,"Code Error",err);});}
catch(e){document.getElementById("searchLoadingImg").style.display="none";alert("Feature Search error: "+e.message+" in search.js/updateSearchTextStore.","Code Error",e);}}
function fillSearchValues(attr){document.getElementById("searchLoadingImg").style.display="block";var items=searchObj[attr].searchvalues.split(",");var dataArr=[];items.forEach(function(item){var obj={};obj[searchObj[attr].searchfield]=item.trim();dataArr.push(obj);});var searchTextStore=new Memory({data:dataArr});var searchTextCombo=registry.byId("searchText");searchTextCombo.set("store",searchTextStore);searchTextCombo.reset();searchTextCombo.set("searchAttr",searchObj[attr].searchfield);searchTextCombo.set("placeHolder","Select a "+searchObj[id].name);obj=null;dataArr=null;attr=null;items=null;document.getElementById("searchLoadingImg").style.display="none";}
function fillLookupSearchValues(id){document.getElementById("searchLoadingImg").style.display="block";var xmlhttp=createXMLhttpRequest();xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4&&xmlhttp.status===200){var xmlData=createXMLparser(xmlhttp.responseText.substr(xmlhttp.response.indexOf("?>")+2));var elements=xmlData.getElementsByTagName(searchObj[id].lookupfield);var dataArr=[];for(var i=0;i<elements.length;i++){var obj={};obj[searchObj[id].searchfield]=elements[i].childNodes[0].nodeValue;dataArr.push(obj);}
var searchTextStore=new Memory({data:dataArr});var searchTextCombo=registry.byId("searchText");searchTextCombo.set("store",searchTextStore);searchTextCombo.set("searchAttr",searchObj[id].searchfield);searchTextCombo.set("placeHolder","Select a "+searchObj[id].name);dataArr=null;document.getElementById("searchLoadingImg").style.display="none";}
else if(xmlhttp.status===404){alert("File: "+app+"/"+searchObj[id].lookupsearchvalues+" not found.","Data Error");document.getElementById("searchLoadingImg").style.display="none";}
else if(xmlhttp.readyState===4&&xmlhttp.status===500){alert("File: "+app+"/"+searchObj[id].lookupsearchvalues+" not found.","Data Error");document.getElementById("searchLoadingImg").style.display="none";}}
xmlhttp.open("GET",app+"/"+searchObj[id].lookupsearchvalues+"?v="+ndisVer,true);xmlhttp.send(null);}
function setSelection(){try{var userTypedTxt=registry.byId("searchText").get("value");var attr=registry.byId("featureType").attr("displayedValue");if(userTypedTxt==""&&attr!="Township Range")return;clearSelection();registry.byId("searchRemoveBtn").set("disabled",false);var expr;document.getElementById("searchLoadingImg").style.display="block";if(searchObj[attr].database){document.getElementById("searchMsg").innerHTML="Loading...";document.getElementById("searchMsg").style.display="block";var xmlhttp=createXMLhttpRequest();xmlhttp.open("POST",searchObj[attr].database+"?v="+ndisVer+"&key="+userTypedTxt,true);xmlhttp.send(null);xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState===4&&xmlhttp.status===200){var xmlData=createXMLparser(xmlhttp.responseText.substr(xmlhttp.response.indexOf("?>")+2));var elements=xmlData.getElementsByTagName(searchObj[attr].filename);if(elements.length==0){alert("No features found with that name. Please try again.","Warning");document.getElementById("searchLoadingImg").style.display="none";document.getElementById("searchMsg").style.display="none";return;}
expr=searchObj[attr].database_field+" IN (";for(var i=0;i<elements.length;i++){if(i>0)expr+=",";if(searchObj[attr].database_field_type.toUpperCase()=="STRING"){expr+="'"+elements[i].getElementsByTagName(searchObj[attr].database_field)[0].childNodes[0].nodeValue+"'";}
else
{expr+=elements[i].getElementsByTagName(searchObj[attr].database_field)[0].childNodes[0].nodeValue;}}
expr+=")";queryLayer=searchObj[attr].url;queryFields=searchObj[attr].fields;displayNames=searchObj[attr].displayfields.split(",");queryTitleField=searchObj[attr].titlefield;queryLinkField=searchObj[attr].linkfield.split(",");queryLinkText=searchObj[attr].linktext.split(",");queryTask=new QueryTask(searchObj[attr].url);var query=new Query();query.where=expr;query.outFields=searchObj[attr].fields.split(",");query.returnGeometry=true;query.outSpatialReference=map.spatialReference;queryTask.execute(query,function(results){if(results.features.length==0){document.getElementById("searchLoadingImg").style.display="none";alert("No features found with that name. Please try again.","Warning");document.getElementById("searchMsg").style.display="none";return;}
recAC=createRecordData(results,registry.byId("featureType").attr("displayedValue"));},function(error){alert("Error in javascript/search.js/setSelect/queryTask.execute "+error.message,"Code Error",error);document.getElementById("searchLoadingImg").style.display="none";document.getElementById("searchMsg").style.display="none";});}}
xmlhttp.onerror=function(){alert('There was an error looking up the data from '+searchObj[attr].database+'?key='+userTypedTxt,"Code Error");document.getElementById("searchLoadingImg").style.display="none";document.getElementById("searchMsg").style.display="none";}}
else{var queryExpr=searchObj[attr].expression;var expr;if(attr=="Township Range")
{document.getElementById("searchMsg").innerHTML="Loading...";document.getElementById("searchMsg").style.display="block";expr=queryExpr.replace("[value1]",parseInt(document.getElementById("searchTwn").value));expr=expr.replace("[value2]",registry.byId("nsRadioForm").attr("value").nsBtn);expr=expr.replace("[value3]",parseInt(document.getElementById("searchRng").value));expr=expr.replace("[value4]",registry.byId("ewRadioForm").attr("value").ewBtn);if(registry.byId("searchSec").get("value"))
expr=expr.replace("[value5]",parseInt(registry.byId("searchSec").get("value")));else
{var pos=expr.indexOf("AND SECTION");expr=expr.substring(0,pos);}
userTypedTxt=document.getElementById("searchTwn").value
+registry.byId("nsRadioForm").attr("value").nsBtn+document.getElementById("searchRng").value
+registry.byId("ewRadioForm").attr("value").ewBtn;if(registry.byId("searchSec").get("value"))userTypedTxt+=" Sec "+registry.byId("searchSec").get("value");document.getElementById("searchTwn").value="";document.getElementById("searchRng").value="";registry.byId("searchSec").attr("value","");}
else
{if(isNaN(Number(userTypedTxt))&&queryExpr.indexOf("= [value]")!=-1)
{registry.byId("searchText").set("value","");updatedList=false;var msg="Your search for "+userTypedTxt+" failed.  Only numbers are allowed.  Please try again.";alert(msg,"Warning");userTypedTxt="";document.getElementById("searchLoadingImg").style.display="none";document.getElementById("searchMsg").style.display="none";return;}
else if(userTypedTxt=="*")
{document.getElementById("searchMsg").innerHTML="Loading all features, please wait...";document.getElementById("searchMsg").style.display="block";if(queryExpr.indexOf("= UPPER('[value]')",0)>0)
{expr=queryExpr.replace("= UPPER('[value]')","<> ''");}
else if(queryExpr.indexOf("LIKE UPPER('%[value]%')",0)>0)
{expr=queryExpr.replace("LIKE UPPER('%[value]%')","<> ''");}
else
{expr=queryExpr.replace("= [value]","<> -1");}
registry.byId("searchText").set("value","");}
else
{document.getElementById("searchMsg").innerHTML="Loading...";document.getElementById("searchMsg").style.display="block";var quote=/'/g;userTypedTxt=userTypedTxt.replace(quote,"''");expr=queryExpr.replace("[value]",userTypedTxt);registry.byId("searchText").set("value","");}}
queryLayer=searchObj[attr].url;queryFields=searchObj[attr].fields;var strDisplayNames=searchObj[attr].displayfields;if(strDisplayNames!=null)
displayNames=searchObj[attr].displayfields.split(",");queryTitleField=searchObj[attr].titlefield;queryLinkField=searchObj[attr].linkfield.split(",");queryLinkText=searchObj[attr].linktext.split(",");if(queryLayer)
{queryTask=new QueryTask(queryLayer);var query=new Query();query.where=expr;var outflds=queryFields.split(",");if(attr=="GMUs"&&(searchObj[attr].displayfields=="Mountain Goat GMU"||searchObj[attr].displayfields=="Bighorn Sheep GMU")){outflds.push("HUNTING");}
query.outFields=outflds;query.returnGeometry=true;query.outSpatialReference=map.spatialReference;queryTask.execute(query,function(featureSet){if(featureSet.features.length==0){alert("No features found with that name. Please try again.","Warning");document.getElementById("searchLoadingImg").style.display="none";document.getElementById("searchMsg").style.display="none";return;}
createRecordData(featureSet,registry.byId("featureType").attr("displayedValue"));},function(error){alert("Error in javascript/search.js/setSelect/queryTask.execute, url="+queryLayer+". Where "+expr+". Error message: "+error.message,"Code Error",error);document.getElementById("searchLoadingImg").style.display="none";document.getElementById("searchMsg").style.display="none";});}}}
catch(e){alert(e.message+" in javascript/search.js/setSelection","Code Error",e);document.getElementById("searchLoadingImg").style.display="none";document.getElementById("searchMsg").style.display="none";}}
function makeLink(data){return data;}
function createRecordData(featureSet,attr){if(attr==fishSpeciesGraphicalName)attr="Fish species";document.getElementById("searchFound").innerHTML=featureSet.features.length;var displayFields=queryFields.split(",");var ave_char_width=6;var width={};for(var j=0;j<displayFields.length;j++)
width[displayFields[j]]=0;recAC=[];graphicAC=null;graphicAC=[];if(!queryTitleField)
queryTitleField=featureSet.displayFieldName;var itemList=[];var index=0;featureSet.features.forEach(function(gra)
{try{var obj=gra.attributes;if(attr!="GMUs"||gmu=="Big Game GMU"||obj["HUNTING"]=="YES"){var value;var title;var point=getGeomCenter(gra);var cols=new Array();var graInfoData={icon:widgetIcon,point:point,geometry:gra.geometry};var infoData={icon:widgetIcon,point:point,geometry:gra.geometry};var row=new Object();row.id=index++;for(j=0;j<displayFields.length;j++){if(obj[displayFields[j]]){if(displayFields[j]=="Acres")row[displayFields[j]]=obj[displayFields[j]].numberFormat(2);else row[displayFields[j]]=obj[displayFields[j]];if(queryLinkField.indexOf(displayFields[j])==-1&&(obj[displayFields[j]].toString().length+3)>width[displayFields[j]])
width[displayFields[j]]=obj[displayFields[j]].toString().length+3;if(width[displayFields[j]]>35&&obj[displayFields[j]].toString().indexOf(" ")>-1)width[displayFields[j]]=35;}}
itemList.push(row);row=null;var i=0;for(j=0;j<displayNames.length;j++)
{try{value=obj[displayFields[j]].toString();}catch(error){value="";}
if(displayFields[j].toUpperCase()==queryTitleField.toUpperCase())
{graInfoData.title=value;infoData.title=value;}
if(queryLinkField.indexOf(displayFields[j])>-1)
{var linkIndex=queryLinkField.indexOf(displayFields[j]);if((value!="")&&(value!=" ")&&(displayNames[j]!="key"))
{graInfoData.link=new Array();graInfoData.link.push(value);graInfoData.linktext=new Array();graInfoData.linktext.push(queryLinkText[linkIndex]);if(queryLinkText[linkIndex].length>0)
infoData[displayNames[j].replace(/ /g,"_")]="<a target=\"_blank\" href=\""+value+"\">"+queryLinkText[linkIndex]+"</a>";else
infoData[displayNames[j].replace(/ /g,"_")]=value;i++;}
else
{if(displayNames[j]!="key")i++;infoData[displayNames[j].replace(/ /g,"_")]="";}}
else
{if(displayNames[j]!="key")i++;if(displayNames!=null){if(displayNames[j]=="Acres")infoData[displayNames[j]]=Number(value).numberFormat(2);else infoData[displayNames[j].replace(/ /g,"_")]=value;}
else{if(displayFields[j]=="Acres")infoData[displayFields[j]]=Number(value).numberFormat(2);else infoData[displayFields[j]]=value;}}}
recAC.push(infoData);gra.attributes=graInfoData;switch(gra.geometry.type)
{case"point":{gra.symbol=graphicPointSym;break;}
case"polyline":{gra.symbol=graphicLineSym;break;}
case"polygon":{gra.symbol=graphicPolySym;break;}}
graphicsLayer.add(gra);graphicAC.push(gra);}
else{document.getElementById("searchFound").innerHTML=Number(document.getElementById("searchFound").innerHTML)-1;}}
catch(e){alert("Error in createRecordData search.js "+e.message,"Code Error",e);document.getElementById("searchLoadingImg").style.display="none";}});if(document.getElementById("searchFound").innerHTML=="0"){alert("No features found. Please try again.","Warning");document.getElementById("searchMsg").style.display="none";document.getElementById("searchTools").style.display="none";document.getElementById("searchGrid").style.display="none";document.getElementById("searchContent").style.height=tabHeight;document.getElementById("searchLoadingImg").style.display="none";return;}
graphicsLayer.id="searchLayer0";graphicsLayer.on("mouse-over",mouseOverGraphic);graphicsHLLayer.on("mouse-out",function(){graphicsHLLayer.clear();});var header={};for(i=0;i<displayNames.length;i++){var obj={label:displayNames[i],resizable:true};header[displayNames[i].replace(/ /g,"_")]=obj;if((header[displayNames[i].replace(/ /g,"_")].label.length+10)>width[displayFields[i]])
width[displayFields[i]]=header[displayNames[i].replace(/ /g,"_")].label.length+10;width[displayFields[i]]=width[displayFields[i]]*ave_char_width+"px"
if(queryLinkField.indexOf(displayFields[i])>-1)header[displayNames[i].replace(/ /g,"_")].formatter=makeLink;}
header.geometry={label:"geometry",width:"0px"};header.icon={label:"icon",width:"0px"};header.point={label:"point",width:"0px"};header.title={label:"title",width:"0px"};var gridDiv=dom.byId("searchGrid");if(gridDiv.childNodes.length>0)gridDiv.removeChild(gridDiv.childNodes[0]);fsGrid=new(declare([OnDemandGrid,DijitRegistry]))({columns:header,selectionMode:"single",cellNavigation:false});var sortFields=searchObj[attr].sortfield.split(",");for(var i=0;i<sortFields.length;i++)sortFields[i]=sortFields[i].replace(/ /g,"_");var numericSort={};var numericArr=searchObj[attr].numericsort.split(",");for(var i=0;i<sortFields.length;i++){numericSort[sortFields[i]]=numericArr[i];}
function multiColumnSort(arr,sf,numericSort){var s='';ns=numericSort;sf.forEach(function(f,idx){if(ns[f]=="true"){s+='if(parseInt(arguments[0].'+f+')-parseInt(arguments[1].'+f+')>0)return 1;';s+='else if(parseInt(arguments[0].'+f+')-parseInt(arguments[1].'+f+')==0)';s+=(idx<sf.length-1)?'{':'return 0';}
else{s+='if(arguments[0].'+f+'>arguments[1].'+f+')return 1;';s+='else if(arguments[0].'+f+'==arguments[1].'+f+')';s+=(idx<sf.length-1)?'{':'return 0';}});s+=Array(sf.length).join('}')+';return -1';return arr.sort(new Function(s));};multiColumnSort(recAC,sortFields,numericSort);for(i=0;i<displayFields.length;i++){fsGrid.styleColumn(displayNames[i].replace(/ /g,"_"),"width:"+width[displayFields[i]]);}
fsGrid.styleColumn("Acres","text-align: right;");fsGrid.styleColumn("geometry","display: none;");fsGrid.styleColumn("point","display: none;");fsGrid.styleColumn("icon","display: none;");fsGrid.styleColumn("title","display: none;");fsGrid.on(".dgrid-row:click",function(event){require(["esri/geometry/Extent"],function(Extent){var row=fsGrid.row(event);var column=fsGrid.column(event);var polyExt=row.data.geometry.getExtent();if(polyExt!=null)
{var ext=new Extent({"xmin":polyExt.xmin,"ymin":polyExt.ymin,"xmax":polyExt.xmax,"ymax":polyExt.ymax,"spatialReference":{"wkid":wkid}});map.setExtent(ext,true);}
else
{map.setScale(zoomScale);map.centerAt(row.data.point);}});});fsGrid.on(".dgrid-row:mouseout",function(event){graphicsHLLayer.clear();});fsGrid.on(".dgrid-row:mouseover",function(event){var row=fsGrid.row(event);graphicsHLLayer.clear();var gra=new Graphic(row.data.geometry);switch(gra.geometry.type)
{case"point":{gra.symbol=graphicPointHLSym;break;}
case"polyline":{gra.symbol=graphicLineHLSym;break;}
case"polygon":{gra.symbol=graphicPolyHLSym;break;}}
graphicsHLLayer.add(gra);addLabel(Graphic(row.data.point),row.data.title,graphicsHLLayer,"11pt")
gra=null;});document.getElementById("searchContent").style.height=tabWithGridHeight;width=null;document.getElementById("searchLoadingImg").style.display="none";document.getElementById("searchOpenBtn").style.display="none";document.getElementById("searchCloseBtn").style.display="inline-block";document.getElementById("searchTools").style.display="block";document.getElementById("searchGrid").style.display="block";document.getElementById("searchMsg").style.display="none";if(recAC&&recAC.length==1)
{var polyExt=recAC[0].geometry.getExtent();if(polyExt!=null)
{require(["esri/geometry/Extent"],function(Extent){var ext=new Extent({"xmin":polyExt.xmin,"ymin":polyExt.ymin,"xmax":polyExt.xmax,"ymax":polyExt.ymax,"spatialReference":{"wkid":wkid}});map.setExtent(ext,true);});}
else
{map.setScale(zoomScale);map.centerAt(recAC[0].point);}}
else if(displayNames[0]=="Township"){map.setScale(zoomScale);map.centerAt(recAC[0].point);}
else{require(["esri/graphicsUtils"],function(graphicsUtils){map.setExtent(graphicsUtils.graphicsExtent(featureSet.features),true);});}
if(registry.byId("FeatureSearchTabs").selectedChildWidget==registry.byId("graphic_Pane")&&searchObj[attr].graphical_db_fields&&searchObj[attr].graphical_db_fields!="")
{queryGraphicalDatabase(recAC,fsGrid,gridDiv,header);}
else{fsGrid.renderArray(recAC);gridDiv.appendChild(fsGrid.domNode);fsGrid.startup();}}
function mouseOverGraphic(event){graphicsHLLayer.clear();var gra=new Graphic(event.graphic.geometry);switch(gra.geometry.type)
{case"point":{gra.symbol=graphicPointHLSym;break;}
case"polyline":{gra.symbol=graphicLineHLSym;break;}
case"polygon":{gra.symbol=graphicPolyHLSym;break;}}
graphicsHLLayer.add(gra);addLabel(Graphic(event.graphic.attributes.point),event.graphic.attributes.title,graphicsHLLayer,"11pt")
gra=null;}
function getGeomCenter(gra){var pt;switch(gra.geometry.type)
{case"point":{pt=new Point(gra.geometry.x,gra.geometry.y,map.spatialReference);break;}
case"polyline":{var pl=gra.geometry;var pathCount=pl.paths.length;var pathIndex=parseInt((pathCount/2)-1);var midPath=new Array();midPath=pl.paths[pathIndex];var ptCount=midPath.length;var ptIndex=parseInt((ptCount/2)-1);pt=pl.getPoint(pathIndex,ptIndex);break;}
case"polygon":{pt=gra.geometry.getCentroid();break;}}
return pt;}
function updateSearchGraphicStore(){document.getElementById("graphicfeatures").innerHTML=registry.byId("featureTypeGraphic").attr("displayedValue");clearSelection();}
function queryFeaturesGraphical(geom){var queryGeom=geom;require(["esri/tasks/query","esri/tasks/QueryTask"],function(Query,QueryTask){var attr=registry.byId("featureTypeGraphic").attr("displayedValue");if(attr==fishSpeciesGraphicalName)attr="Fish species";if(attr=="GMUs"&&settings.useGMUs){if(gmu=="Big Game GMU"){searchObj[attr].fields=settings.elkField+",COUNTY";searchObj[attr].displayfields="GMU,County";searchObj[attr].titlefield=settings.elkField;searchObj[attr].searchfield=settings.elkField;searchObj[attr].expression=settings.elkField+" =[value]";searchObj[attr].url=settings.elkUrl;}
else if(gmu=="Bighorn GMU"){searchObj[attr].fields=settings.sheepField;searchObj[attr].displayfields="Bighorn Sheep GMU";searchObj[attr].titlefield=settings.sheepField;searchObj[attr].searchfield=settings.sheepField;searchObj[attr].expression=settings.sheepField+" = UPPER('[value]')";searchObj[attr].url=settings.sheepUrl;}
else{searchObj[attr].fields=settings.goatField;searchObj[attr].displayfields="Mountain Goat GMU";searchObj[attr].titlefield=settings.goatField;searchObj[attr].searchfield=settings.goatField;searchObj[attr].expression=settings.goatField+" = UPPER('[value]')";searchObj[attr].url=settings.goatUrl;}}
var querySpatialRel="esriSpatialRelIntersects";queryFields=searchObj[attr].fields;var strDisplayNames=searchObj[attr].displayfields;if(strDisplayNames!=null)
displayNames=searchObj[attr].displayfields.split(",");if(searchObj[attr].graphical_db_fields&&searchObj[attr].graphical_db_fields!="")
{queryFields+=","+searchObj[attr].database_field;displayNames.push("key");}
queryTitleField=searchObj[attr].titlefield;queryLinkField=searchObj[attr].linkfield.split(",");queryLinkText=searchObj[attr].linktext.split(",");queryExpr=searchObj[attr].graphical_expr;if(searchObj[attr].url)
{queryTask=new QueryTask(searchObj[attr].url);var query=new Query();if(queryExpr&&queryExpr!="")
query.where=queryExpr;query.geometry=queryGeom;var outflds=queryFields.split(",");if(attr=="GMUs"&&(searchObj[attr].displayfields=="Mountain Goat GMU"||searchObj[attr].displayfields=="Bighorn Sheep GMU")){outflds.push("HUNTING");}
query.outFields=outflds;query.returnGeometry=true;query.spatialRelationship=querySpatialRel;query.outSpatialReference=map.spatialReference;queryTask.execute(query,function(featureSet){try
{if(featureSet.features.length==0){alert("No features found in that location. Please try again.","Warning");document.getElementById("searchLoadingImg").style.display="none";document.getElementById("searchMsg").style.display="none";return;}
createRecordData(featureSet,registry.byId("featureTypeGraphic").attr("displayedValue"));}
catch(error)
{alert("Feature Search error in javascript/search.js/queryFeaturesGraphical queryTask execute. Error message: "+error.message,"Code Error",error);document.getElementById("searchLoadingImg").style.display="none";document.getElementById("searchMsg").style.display="none";}},function(error){alert("While using Graphical Feature Search there was a possible error in SearchWidget.xml file. Querying: "+searchObj[attr].url+" for field: "+searchObj[attr].fields+" "+error.message,"Data Error",error);document.getElementById("searchMsg").style.display="none";document.getElementById("searchLoadingImg").style.display="none";});}});}
function queryGraphicalDatabase(recAC,fsGrid,gridDiv,gridHeader){try{key="";for(var i=0;i<recAC.length;i++)
{if(i>0)key+=",";key+=recAC[i]["key"];}
var attr=registry.byId("featureTypeGraphic").attr("displayedValue");if(attr==fishSpeciesGraphicalName)attr="Fish species";var xmlhttp=createXMLhttpRequest();var url=searchObj[attr].graphical_database+"?v="+ndisVer+"&key="+key;xmlhttp.open("POST",url,true);xmlhttp.onerror=function(){alert('In Graphical Feature Search, there was an error looking up the data from '+searchObj[attr].graphical_database,"Code Error");document.getElementById("searchLoadingImg").style.display="none";document.getElementById("searchMsg").style.display="none";};xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState===4){if(xmlhttp.status===200){try{var xmlData=createXMLparser(xmlhttp.responseText.substr(xmlhttp.response.indexOf("?>")+2));var xml=xmlData.getElementsByTagName("NewDataSet");if(xml.length==0){alert("No features found with that name. Please try again.","Warning");document.getElementById("searchLoadingImg").style.display="none";document.getElementById("searchMsg").style.display="none";return;}
var field=searchObj[attr].graphical_db_fields.split(",");var header=searchObj[attr].graphical_db_displayfields.split(",");var width=new Array();var sort=searchObj[attr].graphical_db_sort.split(",");var j;for(var f=0;f<field.length;f++)
{width[f]=0;for(j=0;j<xml.length;j++)
{recAC[j][header[f]]="";var rec=xml[j].getElementsByTagName(searchObj[attr].graphical_filename);for(var i=0;i<rec.length;i++)
{if(i>0)recAC[j][header[f]]+=",";recAC[j][header[f]]+=rec[i].getElementsByTagName(field[f])[0].childNodes[0].nodeValue;if(recAC[j][header[f]].length>width[f])
width[f]=recAC[j][header[f]].length+3;if(header[f].length+10>width[f])width[f]=header[f].length+10;if(width[f]>35)width[f]=35;}}}
var ave_char_width=6;for(i=0;i<recAC.length;i++)
{delete(recAC[i]["key"]);for(f=0;f<field.length;f++)
{if(sort[f].toUpperCase()=="YES")
{var arr=new Array();if(recAC[i][header[f]]){arr=recAC[i][header[f]].split(",");arr.sort();recAC[i][header[f]]=arr.toString();arr=null;}
else recAC[i][header[f]]="";}}}
for(f=0;f<header.length;f++)
gridHeader[header[f]]={label:header[f],resizable:true};delete(gridHeader["key"]);fsGrid.set("columns",gridHeader);for(f=0;f<header.length;f++)
fsGrid.styleColumn(header[f],"width:"+width[f]*ave_char_width+"px");fsGrid.renderArray(recAC);gridDiv.appendChild(fsGrid.domNode);fsGrid.startup();width=null;gridHeader=null;header=null;}
catch(error){alert("Graphical Feature Search error: "+error.message+" in javascript/search.js/queryGraphicalDatabase.","Code Error",error);document.getElementById("searchLoadingImg").style.display="none";document.getElementById("searchMsg").style.display="none";}}
else if(xmlhttp.status===404){alert("Error: Missing "+searchObj[attr].graphical_database+" file in "+app+" directory.","Data Error");document.getElementById("searchLoadingImg").style.display="none";document.getElementById("searchMsg").style.display="none";}
else{alert('Graphical Feature Search Error: There was an error looking up the data from '+searchObj[attr].graphical_database+' Error message: '+xmlhttp.statusText,'Data Error');document.getElementById("searchLoadingImg").style.display="none";document.getElementById("searchMsg").style.display="none";}}};xmlhttp.send(null);}
catch(error){alert("Graphical Feature Search Error: "+error.message+" in javascript/search.js/queryGraphicalDatabase.","Code Error",error);document.getElementById("searchLoadingImg").style.display="none";document.getElementById("searchMsg").style.display="none";}}
function httpGraphicalFault(event)
{var sInfo="Error: ";var attr=registry.byId("featureTypeGraphic").attr("displayedValue");sInfo+=searchObj[attr].graphical_database;sInfo+=" file is missing from the application directory or there is a problem executing it.";alert(sInfo+" in javascript/search.js httpGraphicalFault","Code Error");document.getElementById("searchLoadingImg").style.display="none";}
function activateSearchTool(event){if(event.currentTarget.className=="graphBtnSelected"){searchGraphicExit();return;}
drawing=true;clearSelection();event.currentTarget.className="graphBtnSelected";if(event.currentTarget.id!="searchpoint")document.getElementById("searchpoint").className="graphBtn";if(event.currentTarget.id!="searchpolyline")document.getElementById("searchpolyline").className="graphBtn";if(event.currentTarget.id!="searchrectangle")document.getElementById("searchrectangle").className="graphBtn";if(event.currentTarget.id!="searchpolygon")document.getElementById("searchpolygon").className="graphBtn";require(["esri/toolbars/draw","dojo/i18n!esri/nls/jsapi"],function(Draw,bundle){if(event.currentTarget.id=="searchpoint"){bundle.toolbars.draw.addPoint="Click to select features at a point";searchtoolbar.activate(Draw.POINT);}
if(event.currentTarget.id=="searchpolyline")
searchtoolbar.activate(Draw.POLYLINE);if(event.currentTarget.id=="searchrectangle"){bundle.toolbars.draw.addShape="Press down to start and let go to finish";searchtoolbar.activate(Draw.RECTANGLE);}
if(event.currentTarget.id=="searchpolygon")searchtoolbar.activate(Draw.POLYGON);});}
function searchGraphicExit(){drawing=false;searchtoolbar.deactivate();document.getElementById("searchpoint").className="graphBtn";document.getElementById("searchpolyline").className="graphBtn";document.getElementById("searchrectangle").className="graphBtn";document.getElementById("searchpolygon").className="graphBtn";}
function clearSelection(){graphicsLayer.clear();graphicsHLLayer.clear();registry.byId("searchRemoveBtn").set("disabled",true);document.getElementById("clearSearchGraphics").style.display="none";document.getElementById("searchTools").style.display="none";document.getElementById("searchGrid").style.display="none";document.getElementById("searchContent").style.height=tabHeight;}
var tab=tabToSelect&&registry.byId(tabToSelect);if(tab)registry.byId("FeatureSearchTabs").selectChild(tab);registry.byId("FeatureSearchTabs").watch("selectedChildWidget",function(name,oval,nval){if(nval.title=="Text Search"){searchGraphicExit();}});dom.byId("searchDiv").addEventListener('click',function(event){if(!registry.byId("searchDiv").open){searchGraphicExit();}});registry.byId("searchBtn").on("click",setSelection);registry.byId("searchRemoveBtn").on("click",clearSelection);registry.byId("searchRemoveBtn").set("disabled",true);document.getElementById("clearSearchGraphics").style.display="none";document.getElementById("clearSearchGraphics").addEventListener('click',function(){clearSelection()});document.getElementById("searchpoint").addEventListener('click',function(event){activateSearchTool(event)});document.getElementById("searchpolyline").addEventListener('click',function(event){activateSearchTool(event)});document.getElementById("searchrectangle").addEventListener('click',function(event){activateSearchTool(event)});document.getElementById("searchpolygon").addEventListener('click',function(event){activateSearchTool(event)});updateSearchTextStore(featureStore.data[0].name);document.getElementById("searchLabel").innerHTML=searchObj[featureStore.data[0].name].textsearchlabel+" ";}
catch(e){alert("Error in javascript/search.js searchInit. "+e.message,"Code Error",e);document.getElementById("searchLoadingImg").style.display="none";}});}
catch(e){alert("Error in javascript/search.js searchInit. "+e.message,"Code Error",e);document.getElementById("searchLoadingImg").style.display="none";}}
else if(xmlhttp.status===404){alert("Error: Missing config.xml file in "+app+" directory.","Data Error");hideLoading();}
else if(xmlhttp.readyState===4&&xmlhttp.status===500){alert("Make sure your application name is correct on the URL. app="+app,"Warning");hideLoading();}};xmlhttp.open("GET",configFile,true);xmlhttp.send(null);}
catch(e){alert(e.message+" in javascript/search.js trying to read SearchWidget.xml file.","Code Error",e);document.getElementById("searchLoadingImg").style.display="none";}}